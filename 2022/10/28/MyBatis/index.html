<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MyBatis | Lost N Found</title><meta name="author" content="Guohao"><meta name="copyright" content="Guohao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文主要通过以下几个方面来系统的介绍 MyBatis 框架：  零、MyBatis简单介绍 一、搭建 MyBatis 环境 二、核心配置文件详解 三、MyBatis 中的基本增删改查 四、自定义映射 resultMap 五、动态 SQL 六、MyBatis 中的分页 七、MyBatis 的缓存机制 八、MyBatis 与 Spring 框架整合  参考资料：  哔哩哔哩：“尚硅谷” 2022 版">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis">
<meta property="og:url" content="https://dave0126.github.io/2022/10/28/MyBatis/index.html">
<meta property="og:site_name" content="Lost N Found">
<meta property="og:description" content="本文主要通过以下几个方面来系统的介绍 MyBatis 框架：  零、MyBatis简单介绍 一、搭建 MyBatis 环境 二、核心配置文件详解 三、MyBatis 中的基本增删改查 四、自定义映射 resultMap 五、动态 SQL 六、MyBatis 中的分页 七、MyBatis 的缓存机制 八、MyBatis 与 Spring 框架整合  参考资料：  哔哩哔哩：“尚硅谷” 2022 版">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png">
<meta property="article:published_time" content="2022-10-28T18:39:03.000Z">
<meta property="article:modified_time" content="2022-11-10T13:38:07.956Z">
<meta property="article:author" content="Guohao">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://dave0126.github.io/2022/10/28/MyBatis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: Guohao","link":"链接: ","source":"来源: Lost N Found","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MyBatis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-10 14:38:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Lost N Found" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-battery-full"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar-check"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-hashtag"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-circle"></i><span> 关于我</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/Dave0126"><i class="fa-fw fab fa-github"></i><span> Github</span></a></li><li><a class="site-page child" href="mailto:dave980126@outlook.com"><i class="fa-fw fas fa-envelope"></i><span> Mail</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Lost N Found</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-battery-full"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar-check"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-hashtag"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-circle"></i><span> 关于我</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/Dave0126"><i class="fa-fw fab fa-github"></i><span> Github</span></a></li><li><a class="site-page child" href="mailto:dave980126@outlook.com"><i class="fa-fw fas fa-envelope"></i><span> Mail</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MyBatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-28T18:39:03.000Z" title="发表于 2022-10-28 20:39:03">2022-10-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-10T13:38:07.956Z" title="更新于 2022-11-10 14:38:07">2022-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.8k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>本文主要通过以下几个方面来系统的介绍 MyBatis 框架：</p>
<ul>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E9%9B%B6%E3%80%81MyBatis%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D">零、MyBatis简单介绍</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E4%B8%80%E3%80%81%E6%90%AD%E5%BB%BA-MyBatis-%E7%8E%AF%E5%A2%83">一、搭建 MyBatis 环境</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E4%BA%8C%E3%80%81%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3">二、核心配置文件详解</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E4%B8%89%E3%80%81MyBatis-%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5">三、MyBatis 中的基本增删改查</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84-resultMap">四、自定义映射 resultMap</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E4%BA%94%E3%80%81%E5%8A%A8%E6%80%81-SQL">五、动态 SQL</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E5%85%AD%E3%80%81MyBatis-%E4%B8%AD%E7%9A%84%E5%88%86%E9%A1%B5">六、MyBatis 中的分页</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E4%B8%83%E3%80%81MyBatis-%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6">七、MyBatis 的缓存机制</a></li>
<li><a href="https://dave0126.github.io/2022/10/28/MyBatis/#%E5%85%AB%E3%80%81MyBatis-%E4%B8%8E-Spring-%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88">八、MyBatis 与 Spring 框架整合</a></li>
</ul>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1VP4y1c7j7">哔哩哔哩：“尚硅谷” 2022 版 MyBatis 入门教程</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html"><code>MyBatis</code> 官方中文开发文档</a></li>
<li>学习 MyBatis 框架时的练习代码 <a target="_blank" rel="noopener" href="https://github.com/Dave0126/MyBatis_Demo">GitHub : MyBatis_Demo</a></li>
</ul>
<span id="more"></span>
<h2 id="零-mybatis简单介绍"><a class="markdownIt-Anchor" href="#零-mybatis简单介绍"></a> 零、MyBatis简单介绍</h2>
<p>MyBatis 是一个基于 Java 的<u><em><strong>持久化框架</strong></em></u>，支持定制化 <code>SQL</code>（自行编写 <code>SQL</code> 语句维护数据库）、存储过程及高级映射。它几乎避免了所有的 JDBC 代码和获取结果集。</p>
<h3 id="与其他持久化层技术的对比"><a class="markdownIt-Anchor" href="#与其他持久化层技术的对比"></a> 与其他持久化层技术的对比</h3>
<ul>
<li>
<p>JDBC：<code>SQL</code> 语句于业务语句耦合度高，不易更改维护；代码冗长</p>
</li>
<li>
<p>JPA/Hibernate：操作便捷，开发效率高；但是因为 <code>SQL</code> 语句是自动生成的，不容易做特殊优化</p>
</li>
<li>
<p>MyBatis：轻量级，<code>SQL</code> 与 Java 编码解耦合，易于维护；开发效率稍逊于 Hibernate。</p>
</li>
</ul>
<h2 id="一-搭建-mybatis-环境"><a class="markdownIt-Anchor" href="#一-搭建-mybatis-环境"></a> 一、搭建 MyBatis 环境</h2>
<h3 id="1-开发环境"><a class="markdownIt-Anchor" href="#1-开发环境"></a> 1. 开发环境</h3>
<ul>
<li>IDE：<code>IntellJ IDEA ver.2021.3</code></li>
<li>构建工具：<code>Maven ver.3.8.5</code></li>
<li>JDK 版本：<code>jdk 1.8</code></li>
<li>MySQL 版本：<code>MySQL ver.8.0.28</code></li>
</ul>
<h3 id="2-使用-maven-构建项目"><a class="markdownIt-Anchor" href="#2-使用-maven-构建项目"></a> 2. 使用 Maven 构建项目</h3>
<ul>
<li>
<p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!-- Mybatis 核心 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!-- junit 测试 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!-- MySQL 驱动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-创建实体类与数据库表"><a class="markdownIt-Anchor" href="#3-创建实体类与数据库表"></a> 3. 创建实体类与数据库表</h3>
<h4 id="1-创建实体类"><a class="markdownIt-Anchor" href="#1-创建实体类"></a> (1) 创建实体类</h4>
<p>在 <code>MyBaits</code> 框架中，所有实体类我们都习惯性的将它们放在 <code>pojo</code> 这个包下。</p>
<p>例：<code>User.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name, String password, <span class="type">int</span> age, String gender, String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;<span class="keyword">return</span> password;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGender</span><span class="params">()</span> &#123;<span class="keyword">return</span> gender;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;<span class="keyword">return</span> email;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;<span class="built_in">this</span>.id = id;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;<span class="built_in">this</span>.password = password;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(String gender)</span> &#123;<span class="built_in">this</span>.gender = gender;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;<span class="built_in">this</span>.email = email;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-根据实体类创建数据库表结构"><a class="markdownIt-Anchor" href="#2-根据实体类创建数据库表结构"></a> (2) 根据实体类创建数据库表结构</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql mysql -h [数据库的主机名] -u [数据库用户名] -P [端口] -p</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database mybatis_test if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">default</span> charset utf8;</span><br><span class="line">use mybatis_test;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user (</span><br><span class="line">  id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  username <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;用户密码&#x27;</span>,</span><br><span class="line">  age <span class="type">int</span> comment <span class="string">&#x27;用户年龄&#x27;</span>,</span><br><span class="line">  gender <span class="type">varchar</span>(<span class="number">1</span>) comment <span class="string">&#x27;用户性别&#x27;</span>,</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;用户邮箱&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;test&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-创建-mybatis-核心配置文件"><a class="markdownIt-Anchor" href="#4-创建-mybatis-核心配置文件"></a> 4. 创建 MyBatis 核心配置文件</h3>
<ul>
<li>
<p>按照 <code>Maven</code> 的规范，该核心配置文件 <code>.xml</code> 存放的位置如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PROJECT_ROOT/src/main/resources</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>习惯上命名为 <code>mybatis-config.xml</code>，这个文件名仅仅只是建议，并非强制要求（整合 Spring之后，这个配置文件可以省略）。</p>
</li>
</ul>
<p>以下给出一个 <code>mybatis-config.xml</code> 模版：</p>
<blockquote>
<p><em><strong><u>注意 ：</u></strong></em></p>
<ol>
<li>在 <code>&lt;environments&gt;</code> 标签内设置连接数据库的环境时，我们使用了<u><em><strong>外挂的 <code>jdbc.properties</code> 文件来配置数据库连接的参数</strong></em></u>，所以我们需要将这个文件使用 <code>&lt;properties&gt;</code> 标签加载</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;需要设置别名的类的全类名，如&lt;fr.gdai.mybatis.pojo.User&gt;&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;别名&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 以包为单位，设置以类名作为别名，且不区分大小写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要设置别名的类所在的包，如&lt;fr.gdai.mybatis.pojo&gt;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 设置连接数据库的信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入单个文件: mappers/UserMapper.xml 文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;需要引入的映射文件，如&lt;fr/gdai/mybatis/mapper/xxxMapper.xml&gt;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 或 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要引入的映射文件所在包的名字，如&lt;fr.gdai.mybatis.mapper&gt;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>jdbc.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_test</span></span><br><span class="line"><span class="attr">jdbc.name</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>
<h3 id="5-配置并使用-log4j-日志"><a class="markdownIt-Anchor" href="#5-配置并使用-log4j-日志"></a> 5. 配置并使用 <code>log4j</code> 日志</h3>
<h4 id="1-添加-maven-依赖"><a class="markdownIt-Anchor" href="#1-添加-maven-依赖"></a> (1) 添加 <code>maven</code> 依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-配置-log4j-的配置文件"><a class="markdownIt-Anchor" href="#2-配置-log4j-的配置文件"></a> (2) 配置 <code>log4j</code> 的配置文件</h4>
<ul>
<li>
<p>按照 <code>Maven</code> 的规范，该配置文件 <code>log4j.xml</code> 存放的位置是应该如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PROJECT_ROOT/src/main/resources</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>日志的级别：从左到右打印的内容越来越详细</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FATAL(致命) &gt; ERROR(错误) &gt; WARN(警告) &gt; INFO(信息) &gt; DEBUG(调试) </span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>以下给出一个 <code>log4j.xml</code> 模版：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">log4j</span>:configuration <span class="keyword">SYSTEM</span> <span class="string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd HH:mm:ss,SSS&#125; %m (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-创建-mapper-接口"><a class="markdownIt-Anchor" href="#6-创建-mapper-接口"></a> 6. 创建 <code>mapper</code> 接口</h3>
<p><code>MyBatis</code> 中的 <code>mapper</code> 接口相当于以前的 <code>dao</code> 层。但是区别在于，<code>mapper</code> 仅仅是<u><em><strong>接口</strong></em></u>，<u><em><strong>不需要提供实现类</strong></em></u>，实现由 MyBatis 框架提供。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">  <span class="comment">// 添加用户信息  </span></span><br><span class="line">	<span class="type">int</span> <span class="title function_">insertUser</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-创建-mapper-接口的-xml-映射文件"><a class="markdownIt-Anchor" href="#7-创建-mapper-接口的-xml-映射文件"></a> 7. 创建 <code>mapper</code> 接口的 <code>.xml</code> 映射文件</h3>
<h4 id="1-对象关系映射"><a class="markdownIt-Anchor" href="#1-对象关系映射"></a> (1) 对象关系映射</h4>
<p>相关概念：<code>ORM (Object Relationship Mapping)</code> 对象关系映射。</p>
<ul>
<li>对象 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> Java 的<u><em><strong>实体类对象</strong></em></u></li>
<li>关系 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> 关系型数据库</li>
<li>映射 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> 二者之间的对应关系</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Java概念</th>
<th style="text-align:center">数据库概念</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">类</td>
<td style="text-align:center">表</td>
</tr>
<tr>
<td style="text-align:center">属性</td>
<td style="text-align:center">字段/列</td>
</tr>
<tr>
<td style="text-align:center">对象</td>
<td style="text-align:center">记录/行</td>
</tr>
</tbody>
</table>
<h4 id="2-xml-映射文件"><a class="markdownIt-Anchor" href="#2-xml-映射文件"></a> (2) <code>.xml</code> 映射文件</h4>
<ul>
<li>
<p><code>.xml</code> 映射文件用于<u><em><strong>编写 <code>SQL</code> 语句</strong></em></u> ，以<u><em><strong>访问、操作表中的数据</strong></em></u>；</p>
</li>
<li>
<p><code>.xml</code> 映射文件应该存放在如下目录（按照 <code>Maven</code> 的规范），同时需要与 <code>mapper</code> 接口<u><em><strong>处于同一包下</strong></em></u>（即 <code>mapper</code> 接口的<u><em><strong>全类名</strong></em></u>和映射文件的<u><em><strong>命名空间</strong></em></u> <code>namespace</code>保持<u><em><strong>一致</strong></em></u>）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PROJECT_ROOT/src/main/resources/</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>表所对应的<code>实体类的类名+Mapper.xml</code>，因此一个映射文件对应一个实体类，对应一张表的操作。例如：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">表名</th>
<th style="text-align:center">对应的实体类</th>
<th style="text-align:center">实体类的 <code>mapper</code> 接口</th>
<th style="text-align:center"><code>mapper</code>映射文件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>t_user</code></td>
<td style="text-align:center"><code>User.java</code></td>
<td style="text-align:center"><code>UserMapper.java</code></td>
<td style="text-align:center"><code>UserMapper.xml</code></td>
</tr>
</tbody>
</table>
<p>以下给出一个 <code>XxxMapper.xml</code> 模版：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;mapper接口的全类名&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;mapper接口的方法名&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- select * from ur_table --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;mapper接口里的方法名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;mapper接口里的方法名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    int insertUser();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">        insert into t_user values(null, &#x27;gdai&#x27;, &#x27;gdai&#x27;, 23, &#x27;男&#x27;, &#x27;gdai@gdai.com&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="8-与数据库建立连接并测试"><a class="markdownIt-Anchor" href="#8-与数据库建立连接并测试"></a> 8. 与数据库建立连接并测试</h3>
<h4 id="1-与数据库建立连接sqlsessionutils"><a class="markdownIt-Anchor" href="#1-与数据库建立连接sqlsessionutils"></a> (1) 与数据库建立连接：<code>SqlSessionUtils</code></h4>
<ul>
<li><code>SqlSession</code>：代表 <u><em><strong>Java 程序和数据库之间的会话</strong></em></u>（类比 <code>HttpSession</code> 是Java 程序和浏览器之间的会话）</li>
<li><code>SqlSessionFactory</code>：是“生产” <code>SqlSession</code> 的“工厂”</li>
</ul>
<p>了解了以上两点，我们就可以在如下目录内新建一个工具类 <code>SqlSessionUtils.java</code>（如下所示），通过调用<u><em><strong>静态方法</strong></em></u> <code>getSqlSession():SqlSession</code> 来获得一个 <code>SqlSession</code> 类（Java 程序和数据库之间的会话）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$PROJECT_ROOT/src/main/java/项目包名/utils</span><br></pre></td></tr></table></figure>
<p><code>SqlSessionUtils.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 加载 MyBatis 的核心配置文件 myBatis-config.xml</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span></span><br><span class="line">                    Resources.getResourceAsStream(<span class="string">&quot;myBatis-config.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 通过核心配置文件创建工厂类SqlSessionFactory</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">            <span class="comment">// 通过工厂类获取SqlSession, true为开启自动提交事务</span></span><br><span class="line">            sqlSession = sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-测试连接"><a class="markdownIt-Anchor" href="#2-测试连接"></a> (2) 测试连接</h4>
<p>a. <code>MyBatis</code> 自动通过<u><em><strong>代理模式</strong></em></u>创建 <code>XxxMapper</code> <u><em><strong>接口的代理实现类对象</strong></em></u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">XxxMapper</span> <span class="variable">xxxMapper</span> <span class="operator">=</span> sqlSession.getMapper(XxxMapper.class);</span><br></pre></td></tr></table></figure>
<p>b. 调用 <code>XxxMapper</code> 接口中的方法，就可以根据 <code>XxxMapper</code> 的<u><em><strong>全类名</strong></em></u>匹配 <code>.xml</code> 映射文件，通过<u><em><strong>调用的方法名</strong></em></u>匹配映射文件中的 <code>SQL</code> 标签 <code>&lt;id&gt;</code>，并执行标签中的 <code>SQL</code> 语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> xxxMapper._functions();</span><br></pre></td></tr></table></figure>
<p><code>insertUser()</code> 的完整演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> == userMapper.insertUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二-核心配置文件详解"><a class="markdownIt-Anchor" href="#二-核心配置文件详解"></a> 二、核心配置文件详解</h2>
<h3 id="0-标签的顺序"><a class="markdownIt-Anchor" href="#0-标签的顺序"></a> 0 标签的顺序</h3>
<p>核心配置文件中的标签<u><em><strong>必须按照固定的顺序</strong></em></u>：(有的标签可以不写，但顺序一定不能更改)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>, <span class="tag">&lt;<span class="name">settings</span>&gt;</span>,  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>, <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span>, <span class="tag">&lt;<span class="name">objectFactory</span>&gt;</span>, <span class="tag">&lt;<span class="name">objectWrapperFactory</span>&gt;</span>, <span class="tag">&lt;<span class="name">reflectorFactory</span>&gt;</span>, <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>, <span class="tag">&lt;<span class="name">environments</span>&gt;</span>, <span class="tag">&lt;<span class="name">databaseIdProvider</span>&gt;</span>, <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以下给出一个详细的核心配置文件 <code>mybatis-config.xml</code> 模版：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        MyBatis核心配置文件中，标签的顺序如下：</span></span><br><span class="line"><span class="comment">        properties?,settings?,typeAliases?,typeHandlers?,</span></span><br><span class="line"><span class="comment">        objectFactory?,objectWrapperFactory?,reflectorFactory?,</span></span><br><span class="line"><span class="comment">        plugins?,environments?,databaseIdProvider?,mappers?</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;properties文件名&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            typeAlias: 设置某个类的别名（因为每次使用全类名很麻烦）</span></span><br><span class="line"><span class="comment">            属性:</span></span><br><span class="line"><span class="comment">                type: 全类名</span></span><br><span class="line"><span class="comment">                alias: 缺省时为类名（不区分大小写）</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;需要设置别名的类的全类名，如&lt;fr.gdai.mybatis.pojo.User&gt;&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;别名&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 以包为单位，设置以类名作为别名，且不区分大小写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要设置别名的类所在的包，如&lt;fr.gdai.mybatis.pojo&gt;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    environments: 可配置多个连接数据库的环境</span></span><br><span class="line"><span class="comment">    属性:</span></span><br><span class="line"><span class="comment">        default: 设置默认使用的环境的id</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            environment: 配置某个具体的环境</span></span><br><span class="line"><span class="comment">            属性:</span></span><br><span class="line"><span class="comment">                id: 表示连接数据库环境的唯一标识</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                transactionManager: 设置事务管理的方式</span></span><br><span class="line"><span class="comment">                属性:</span></span><br><span class="line"><span class="comment">                    type=&quot;JDBC/MANAGE&quot;</span></span><br><span class="line"><span class="comment">                    JDBC: 表示在当前环境中，执行SQL时，使用的是JDBC中原生的事务管理方式，</span></span><br><span class="line"><span class="comment">                            事务的提交或回滚需要手动配置</span></span><br><span class="line"><span class="comment">                    MANAGE: 被管理，例如被Spring管理</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                dataSource: 配置数据源</span></span><br><span class="line"><span class="comment">                属性:</span></span><br><span class="line"><span class="comment">                    type=&quot;POOLED/UNPOOLED/JNDI&quot;</span></span><br><span class="line"><span class="comment">                    POOLED: 表示使用连接池缓存数据连接</span></span><br><span class="line"><span class="comment">                    UNPOOLED: 表示不使用连接池</span></span><br><span class="line"><span class="comment">                    JNDI: 表示使用上下文中的数据库</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 设置连接数据库的信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入单个文件: mappers/UserMapper.xml 文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;需要引入的映射文件，如&lt;fr/gdai/mybatis/mapper/xxxMapper.xml&gt;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 或 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            以包为单位引入映射文件</span></span><br><span class="line"><span class="comment">            要求</span></span><br><span class="line"><span class="comment">             1. mapper接口所在的包要和映射文件所在的包一致，即UserMapper.java与UserMapper.xml包路径相同</span></span><br><span class="line"><span class="comment">             2. mapper接口要与映射文件的名字一致</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要引入的映射文件所在包的名字，如&lt;fr.gdai.mybatis.mapper&gt;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-properties-标签"><a class="markdownIt-Anchor" href="#1-properties-标签"></a> 1 <code>&lt;properties&gt;</code> 标签</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;xxx.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>引入 <code>.properties</code> 文件，此时就可以 <code>$&#123;属性名&#125;</code> 的方式访问 <code>.properties</code> 文件中属性值。</p>
<ul>
<li><code>resource</code>：<code>.properties</code> 文件的地址</li>
</ul>
<p>注意 ⚠️：</p>
<p>需要注意不同的 <code>.properties</code> 文件中<u><em><strong>同名的属性名会冲突</strong></em></u></p>
<h3 id="2-settings-标签"><a class="markdownIt-Anchor" href="#2-settings-标签"></a> 2 <code>&lt;settings&gt;</code> 标签</h3>
<p>这是 <code>MyBatis</code> 中<u><em><strong>全局设置</strong></em></u>，它们会改变 <code>MyBatis</code> 的<u><em><strong>运行时行为</strong></em></u>。 下表描述了设置中常用的设置的含义、默认值等。详情跳转到 <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings"><code>MyBatis</code> 官方中文开发文档 - <code>settings</code></a>。</p>
<table>
<thead>
<tr>
<th style="text-align:left">设置名</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">有效值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>cacheEnabled</code></td>
<td style="text-align:left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td style="text-align:left"><code>true|false</code></td>
<td style="text-align:left"><code>true</code></td>
</tr>
<tr>
<td style="text-align:left"><code>lazyLoadingEnabled</code></td>
<td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态（<code>lazy | eager</code>）。</td>
<td style="text-align:left"><code>true|false</code></td>
<td style="text-align:left"><code>false</code></td>
</tr>
<tr>
<td style="text-align:left"><code>aggressiveLazyLoading</code></td>
<td style="text-align:left">当开启时，任何方法的调用都会加载该对象的所有属性。 否则，每个属性会按需加载</td>
<td style="text-align:left"><code>true|false</code></td>
<td style="text-align:left"><code>false</code></td>
</tr>
<tr>
<td style="text-align:left"><code>mapUnderscoreToCamelCase</code></td>
<td style="text-align:left">是否开启驼峰命名自动映射，即从经典数据库列名 <code>a_column</code> 映射到经典 Java 属性名 <code>aColumn</code>。</td>
<td style="text-align:left"><code>true|false</code></td>
<td style="text-align:left"><code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="3-typealiases-标签"><a class="markdownIt-Anchor" href="#3-typealiases-标签"></a> 3 <code>&lt;typeAliases&gt;</code> 标签</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;需要设置别名的类的全类名，如&lt;fr.gdai.mybatis.pojo.User&gt;&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;别名&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 以包为单位，设置改包下所有的类型都拥有默认的别名，即类名且不区分大小写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要设置别名的类所在的包，如&lt;fr.gdai.mybatis.pojo&gt;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>&lt;typeAlias&gt;</code>：设置某个具体的类型的别名</p>
<p>属性：</p>
<ul>
<li><code>type</code>：需要设置别名的类型的<u><em><strong>全类名</strong></em></u></li>
<li><code>alias</code>：设置此类型的别名，且别名不区分大小写。若<u><em><strong>不设置</strong></em></u>此属性，该类型拥有<u><em><strong>默认的别名，即类名</strong></em></u></li>
</ul>
</li>
<li>
<p><code>&lt;package&gt;</code>：以<u><em><strong>包为单位</strong></em></u>，设置改包下所有的类型都拥有<u><em><strong>默认的别名</strong></em></u>，即<u><em><strong>类名</strong></em></u>且不区分大小写</p>
<p>属性：</p>
<ul>
<li><code>name</code>：需要设置别名的类所在的<u><em><strong>包</strong></em></u></li>
</ul>
</li>
</ul>
<h4 id="mybatis-中默认的别名"><a class="markdownIt-Anchor" href="#mybatis-中默认的别名"></a> <code>MyBatis</code> 中默认的别名</h4>
<table>
<thead>
<tr>
<th style="text-align:center">别名</th>
<th style="text-align:center">映射的类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>_byte</code></td>
<td style="text-align:center"><code>byte</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_char</code> (since 3.5.10)</td>
<td style="text-align:center"><code>char</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_character</code> (since 3.5.10)</td>
<td style="text-align:center"><code>char</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_long</code></td>
<td style="text-align:center"><code>long</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_short</code></td>
<td style="text-align:center"><code>short</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_int</code></td>
<td style="text-align:center"><code>int</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_integer</code></td>
<td style="text-align:center"><code>int</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_double</code></td>
<td style="text-align:center"><code>double</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_float</code></td>
<td style="text-align:center"><code>float</code></td>
</tr>
<tr>
<td style="text-align:center"><code>_boolean</code></td>
<td style="text-align:center"><code>boolean</code></td>
</tr>
<tr>
<td style="text-align:center"><code>string</code></td>
<td style="text-align:center"><code>String</code></td>
</tr>
<tr>
<td style="text-align:center"><code>byte</code></td>
<td style="text-align:center"><code>Byte</code></td>
</tr>
<tr>
<td style="text-align:center"><code>char</code> (since 3.5.10)</td>
<td style="text-align:center"><code>Character</code></td>
</tr>
<tr>
<td style="text-align:center"><code>character</code> (since 3.5.10)</td>
<td style="text-align:center"><code>Character</code></td>
</tr>
<tr>
<td style="text-align:center"><code>long</code></td>
<td style="text-align:center"><code>Long</code></td>
</tr>
<tr>
<td style="text-align:center"><code>short</code></td>
<td style="text-align:center"><code>Short</code></td>
</tr>
<tr>
<td style="text-align:center"><code>int</code></td>
<td style="text-align:center"><code>Integer</code></td>
</tr>
<tr>
<td style="text-align:center"><code>integer</code></td>
<td style="text-align:center"><code>Integer</code></td>
</tr>
<tr>
<td style="text-align:center"><code>double</code></td>
<td style="text-align:center"><code>Double</code></td>
</tr>
<tr>
<td style="text-align:center"><code>float</code></td>
<td style="text-align:center"><code>Float</code></td>
</tr>
<tr>
<td style="text-align:center"><code>boolean</code></td>
<td style="text-align:center"><code>Boolean</code></td>
</tr>
<tr>
<td style="text-align:center"><code>date</code></td>
<td style="text-align:center"><code>Date</code></td>
</tr>
<tr>
<td style="text-align:center"><code>decimal</code></td>
<td style="text-align:center"><code>BigDecimal</code></td>
</tr>
<tr>
<td style="text-align:center"><code>bigdecimal</code></td>
<td style="text-align:center"><code>BigDecimal</code></td>
</tr>
<tr>
<td style="text-align:center"><code>biginteger</code></td>
<td style="text-align:center"><code>BigInteger</code></td>
</tr>
<tr>
<td style="text-align:center"><code>object</code></td>
<td style="text-align:center"><code>Object</code></td>
</tr>
<tr>
<td style="text-align:center"><code>date[]</code></td>
<td style="text-align:center"><code>Date[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>decimal[]</code></td>
<td style="text-align:center"><code>BigDecimal[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>bigdecimal[]</code></td>
<td style="text-align:center"><code>BigDecimal[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>biginteger[]</code></td>
<td style="text-align:center"><code>BigInteger[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>object[]</code></td>
<td style="text-align:center"><code>Object[]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>map</code></td>
<td style="text-align:center"><code>Map</code></td>
</tr>
<tr>
<td style="text-align:center"><code>hashmap</code></td>
<td style="text-align:center"><code>HashMap</code></td>
</tr>
<tr>
<td style="text-align:center"><code>list</code></td>
<td style="text-align:center"><code>List</code></td>
</tr>
<tr>
<td style="text-align:center"><code>arraylist</code></td>
<td style="text-align:center"><code>ArrayList</code></td>
</tr>
<tr>
<td style="text-align:center"><code>collection</code></td>
<td style="text-align:center"><code>Collection</code></td>
</tr>
<tr>
<td style="text-align:center"><code>iterator</code></td>
<td style="text-align:center"><code>Iterator</code></td>
</tr>
</tbody>
</table>
<h3 id="9-environments-标签"><a class="markdownIt-Anchor" href="#9-environments-标签"></a> 9 <code>&lt;environments&gt;</code> 标签</h3>
<h4 id="91-environments"><a class="markdownIt-Anchor" href="#91-environments"></a> 9.1 <code>&lt;environments&gt;</code></h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>&lt;environments&gt;</code>：设置<u><em><strong>多个</strong></em></u>连接数据库的环境</p>
<p>属性：</p>
<ul>
<li><code>default</code>：设置默认使用的环境的 <code>&lt;environment&gt; id</code></li>
</ul>
</li>
</ul>
<h4 id="92-environment"><a class="markdownIt-Anchor" href="#92-environment"></a> 9.2 <code>&lt;environment&gt;</code></h4>
<ul>
<li><code>&lt;environment&gt;</code>：设置<u><em><strong>具体</strong></em></u>的连接数据库的环境信息
<ul>
<li>属性：<code>id</code>：设置<u><em><strong>环境的唯一标识</strong></em></u>，可通过 <code>&lt;environments&gt;</code> 标签中的 <code>default</code> 设置某一个环境的id，表示默认使用的环境</li>
<li><code>&lt;transactionManager&gt;</code>：设置<u><em><strong>事务管理方式</strong></em></u>
<ul>
<li>属性：<code>type</code>：设置事务管理方式，<code>type=&quot;JDBC|MANAGED&quot;</code>
<ol>
<li><code>type=&quot;JDBC&quot;</code>：设置当前环境的<u><em><strong>事务管理都必须手动处理</strong></em></u></li>
<li><code>type=&quot;MANAGED&quot;</code>：设置事务被管理，例如 Spring 来管理</li>
</ol>
</li>
</ul>
</li>
<li><code>&lt;dataSource&gt;</code>：设置数据源
<ul>
<li>属性：<code>type</code>：设置数据源的类型，<code>type=&quot;POOLED|UNPOOLED|JNDI&quot;</code>
<ol>
<li><code>type=&quot;POOLED&quot;</code>：使用<u><em><strong>数据库连接池</strong></em></u>，即会将创建的连接进行缓存，下次使用可以从缓存中直接获取，不需要重新创建</li>
<li><code>type=&quot;UNPOOLED&quot;</code>：不使用数据库连接池，即每次使用连接都需要重新创建</li>
<li><code>type=&quot;JNDI&quot;</code>：调用<u><em><strong>上下文中的数据源</strong></em></u></li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="11-mappers-标签"><a class="markdownIt-Anchor" href="#11-mappers-标签"></a> 11 <code>&lt;mappers&gt;</code> 标签</h3>
<blockquote>
<p>注意 ⚠️：</p>
<p>当<u><em><strong>以包为单位</strong></em></u>，将包下所有的映射文件引入核心配置文件时<u><em><strong>需要保证</strong></em></u></p>
<ol>
<li><code>mapper</code> 接口和 <code>mapper</code> 映射文件<u><em><strong>必须在相同的包下</strong></em></u></li>
<li><code>mapper</code> 接口要和 <code>mapper</code> 映射文件的<u><em><strong>名字一致</strong></em></u></li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--引入映射文件--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;XxxMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     以包为单位，将包下所有的映射文件引入核心配置文件</span></span><br><span class="line"><span class="comment">     注意：</span></span><br><span class="line"><span class="comment">1. 此方式必须保证mapper接口和mapper映射文件必须在相同的包下</span></span><br><span class="line"><span class="comment">2. mapper接口要和mapper映射文件的名字一致</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先，我们需要告诉 MyBatis 到哪里去找到这些语句。可以使用如下方法：</p>
<ol>
<li>
<p><u><em><strong>相对于类路径</strong></em></u>的资源引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;相对路径/XxxMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>完全限定资源定位符（包括 <code>file:///</code> 形式的 URL）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///绝对路径/XxxMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>类名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;全类名.XxxMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>包名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要引入的映射文件所在包的名字&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="三-mybatis-中的基本使用"><a class="markdownIt-Anchor" href="#三-mybatis-中的基本使用"></a> 三、MyBatis 中的基本使用</h2>
<p>在 MyBatis 框架中，我们需要做<u><em><strong>数据持久层</strong></em></u>（<code>DAO</code>）即可。可以通过两种方式实现：</p>
<ol>
<li>注解（以注解的形式在接口中配置 <code>SQL</code>）</li>
<li>配置文件（将 <code>SQL</code> 配置在与接口对应的 <code>.xml</code> 文件中）</li>
</ol>
<blockquote>
<p><u><strong>注意 ⚠️：</strong></u>在以后的实验代码中，我会将注释和配置文件悉数给出，后不再另做说明*</p>
</blockquote>
<h3 id="0-简单查询"><a class="markdownIt-Anchor" href="#0-简单查询"></a> 0 简单查询</h3>
<h4 id="01-查询返回一个实体类对象"><a class="markdownIt-Anchor" href="#01-查询返回一个实体类对象"></a> 0.1 查询返回一个实体类对象</h4>
<p>如果查询出的数据只有<u><em><strong>一条</strong></em></u>，可以通过</p>
<ol>
<li><u><em><strong>实体类对象</strong></em></u>接收</li>
<li><u><em><strong>List 集合</strong></em></u>接收</li>
<li><u><em><strong>Map 集合</strong></em></u>接收，结果以<u><em><strong>属性名</strong></em></u>为 <code>key</code>，<u><em><strong>属性值</strong></em></u>为 <code>value</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user where id=1&quot;)</span></span><br><span class="line">  User <span class="title function_">getUserById1</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user where id=1&quot;)</span></span><br><span class="line">  List&lt;User&gt; <span class="title function_">getUserById1InList</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user where id=1&quot;)</span></span><br><span class="line">  Map&lt;String, Object&gt; <span class="title function_">getUserById1InMap</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1   User getUserById1();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user where id=1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2   List&lt;User&gt; getUserById1InList();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById1InList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user where id=1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3   Map&lt;String, Object&gt; getUserById1InMap()--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById1InMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user where id=1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="02-查询返回实体类集合"><a class="markdownIt-Anchor" href="#02-查询返回实体类集合"></a> 0.2 查询返回实体类集合</h4>
<p>如果查询出的数据有<u><em><strong>多条</strong></em></u>，一定不能用实体类对象接收，会抛异常 <code>TooManyResultsException</code>，可以通过：</p>
<ol>
<li>
<p><u><em><strong>实体类类型</strong></em></u>的 <u><em><strong>List 集合</strong></em></u>接收</p>
</li>
<li>
<p><u><em><strong>Map 类型</strong></em></u>的 <u><em><strong>List 集合</strong></em></u>接收</p>
</li>
<li>
<p>在 <code>mapper</code> 接口的方法上添加 <code>@MapKey</code> 注解（将某一个属性作为 <code>Map</code> 类型的集合的 <code>key</code>）</p>
<p>形如：<code>&#123;&#123;1=&#123;id=1,name=gdai&#125;, &#123;2=&#123;id=2,name=tom&#125;&#125;&#125;</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user&quot;)</span></span><br><span class="line">  List&lt;User&gt; <span class="title function_">getAllUsersInList</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user&quot;)</span></span><br><span class="line">  List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">getAllUsersInListMap</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Select(&quot;select * from t_user&quot;)</span></span><br><span class="line">  <span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">  Map&lt;String, Map&lt;String, Object&gt;&gt; <span class="title function_">getAllUsersInMapMap</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1   List&lt;User&gt; getAllUsers();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2   List&lt;Map&lt;String, Object&gt;&gt; getAllUsersInListMap();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsersInListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3   Map&lt;String, Map&lt;String, Object&gt;&gt; getAllUsersInMapMap();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsersInMapMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><u><em><strong>注意 ⚠️</strong></em></u>：</p>
<ol>
<li>查询的标签 <code>&lt;select&gt;</code> 必须设置属性 <code>resultType</code> 或 <code>resultMap</code>，用于设置实体类和数据库表的映射关系
<ul>
<li><code>resultType</code>：自动映射，用于属性名和表中<u><em><strong>字段名一致</strong></em></u>的情况</li>
<li><code>resultMap (@Results(@Result() ...))</code>：自定义映射，用于<u><em><strong>一对多或多对一</strong></em></u>或<u><em><strong>字段名和属性名不一致</strong></em></u>的情况</li>
</ul>
</li>
<li>当查询的数据为多条时，不能使用实体类作为返回值，只能使用集合，否则会抛出异常 <code>TooManyResultsException</code>；但是若查询的数据只有一条，可以使用实体类或集合作为返回值</li>
</ol>
<h3 id="1-获取参数值的两种方式重点"><a class="markdownIt-Anchor" href="#1-获取参数值的两种方式重点"></a> 1 获取参数值的两种方式（重点）</h3>
<ul>
<li><code>MyBatis</code> 获取参数值的两种方式：<code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code>
<ul>
<li><code>$&#123;&#125;</code> 的本质就是<u><em><strong>字符串拼接</strong></em></u>，若为<u><em><strong>字符串类型</strong></em></u>或<u><em><strong>日期类型</strong></em></u>的字段进行赋值时，需要<u><em><strong>手动加单引号</strong></em></u>；</li>
<li><code>#&#123;&#125;</code> 的本质就是<u><em><strong>占位符赋值</strong></em></u>，不需要<u><em><strong>手动加单引号</strong></em></u>，但是在<a href>如下特殊 <code>SQL</code> 操作时</a>，<u><em><strong>需要分情况讨论</strong></em></u>。</li>
</ul>
</li>
</ul>
<h3 id="2-单个字面量类型的参数"><a class="markdownIt-Anchor" href="#2-单个字面量类型的参数"></a> 2 单个字面量类型的参数</h3>
<ul>
<li>
<p>若 <code>mapper</code> 接口中的方法<u><em><strong>参数为单个的字面量</strong></em></u>类型，此时可以使用 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> 以任意的名称（最好见名识意）获取参数的值。</p>
<p><u><em><strong>注意⚠️</strong></em></u>： <code>$&#123;&#125;</code> 需要手动加单引号</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 根据用户名查询用户信息（单字面量）</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User getUserByUsername(String username);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from t_user where username = #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User getUserByUsername(String username);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span>  </span><br><span class="line">	select * from t_user where username = &#x27;$&#123;username&#125;&#x27;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserByUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserByUsername(<span class="string">&quot;gdai&quot;</span>);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-多个字面量类型的参数"><a class="markdownIt-Anchor" href="#3-多个字面量类型的参数"></a> 3 多个字面量类型的参数</h3>
<h4 id="31-mybatis-默认提供的-map-集合"><a class="markdownIt-Anchor" href="#31-mybatis-默认提供的-map-集合"></a> 3.1 <code>MyBatis</code> 默认提供的 <code>Map</code> 集合</h4>
<ul>
<li>
<p>若 <code>mapper</code> 接口中的<u><em><strong>方法参数为多个</strong></em></u>时，此时 <code>MyBatis</code> 会<u><em><strong>自动</strong></em></u>将这些参数放在一个 <u><em><strong>Map 集合</strong></em></u>：</p>
<ol>
<li>以 <code>arg0, arg1, ...</code> 为<u><em><strong>键</strong></em></u>，以参数为<u><em><strong>值</strong></em></u>；</li>
<li>以 <code>param1, param2, ...</code>为<u><em><strong>键</strong></em></u>，以参数为<u><em><strong>值</strong></em></u>；</li>
</ol>
</li>
<li>
<p>因此只需要通过 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> 访问 <code>Map</code> 集合的<u><em><strong>键</strong></em></u>就可以<u><em><strong>获取相对应的值</strong></em></u>，注意 <code>$&#123;&#125;</code> 需要<u><em><strong>手动加单引号</strong></em></u>。</p>
</li>
<li>
<p>使用 <code>arg</code> 或者 <code>param</code> 都行，要注意的是，<code>arg</code> 是从 <code>arg0</code> 开始的，<code>param</code>是从 <code>param1</code> 开始的</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 验证登陆（两个字面量）</span></span><br><span class="line">    <span class="comment">// @Select(&quot;select * from t_user where username = #&#123;param1&#125; and password = #&#123;param2&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_user where username = #&#123;arg0&#125; and password = #&#123;arg1&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectUserByIdAndPassword</span><span class="params">(String username, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User selectUserByUsernameAndPassword(String username,String password);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByUsernameAndPassword&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span>  </span><br><span class="line">	select * from t_user where username = #&#123;arg0&#125; and password = #&#123;arg1&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User selectUserByUsernameAndPassword(String username,String password);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByUsernameAndPassword&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from t_user where username = &#x27;$&#123;param1&#125;&#x27; and password = &#x27;$&#123;param2&#125;&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectUserByUsernameAndPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserByIdAndPassword(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-手动创建-map-集合"><a class="markdownIt-Anchor" href="#32-手动创建-map-集合"></a> 3.2 手动创建 <code>Map</code> 集合</h4>
<ul>
<li>上面我们使用了 <code>MyBatis</code> 默认提供的 <code>Map</code> 集合，我们也可以<u><em><strong>手动创建 <code>Map</code> 集合</strong></em></u>，将这些数据放在 <code>Map</code> 中只需要通过 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> 访问 <code>Map</code> 集合的<u><em><strong>键</strong></em></u>就可以<u><em><strong>获取相对应的值</strong></em></u>，注意 <code>$&#123;&#125;</code> 需要<u><em><strong>手动加单引号</strong></em></u>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 当mapper接口的方法参数有多个时，我们可以手动将这些参数存储在Map中</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectUserByUsernameAndPassword</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User selectUserByUsernameAndPassword(Map&lt;String,Object&gt; map);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByUsernameAndPassword&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectUserByUsernameAndPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;gdai&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">  </span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserByUsernameAndPassword(map);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-实体类类型的参数"><a class="markdownIt-Anchor" href="#4-实体类类型的参数"></a> 4 实体类类型的参数</h3>
<ul>
<li>若 <code>mapper</code> 接口中的方法<u><em><strong>参数为实体类对象</strong></em></u>时此时可以使用 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> ，通过<u><em><strong>访问实体类对象中的属性名获取属性值</strong></em></u>，注意 <code>$&#123;&#125;</code> 需要手动加单引号.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 当mapper接口方法的参数是实体类类型参数时</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into t_user values(#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;gender&#125;, #&#123;email&#125;)&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUserByEntity</span><span class="params">(User u1)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int insertUserByEntity(User u1);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserByEntity&quot;</span>&gt;</span></span><br><span class="line">  insert into t_user values(#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;gender&#125;, #&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertUserByEntity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>,<span class="string">&quot;tom&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">22</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;tom@tom.com&quot;</span>);</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        userMapper.insertUserByEntity(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-使用-param-标识参数"><a class="markdownIt-Anchor" href="#5-使用-param-标识参数"></a> 5 使用 <code>@Param</code> 标识参数</h3>
<ul>
<li>
<p>通过 <code>@Param</code> <u><em><strong>注解</strong></em></u>标识 <code>mapper</code> <u><em><strong>接口中的方法参数</strong></em></u>，此时，<code>MyBatis</code> 会<u><em><strong>自动</strong></em></u>将这些参数放在一个 <u><em><strong>Map 集合</strong></em></u>：</p>
<ol>
<li>以 <code>@Param</code> 注解的 <code>value</code> 属性值为<u><em><strong>键</strong></em></u>，以参数为<u><em><strong>值</strong></em></u>；</li>
<li>以 <code>param1, param2, ...</code>为<u><em><strong>键</strong></em></u>，以参数为<u><em><strong>值</strong></em></u>；</li>
</ol>
</li>
<li>
<p>因此只需要通过 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> 访问 <code>Map</code> 集合的<u><em><strong>键</strong></em></u>就可以<u><em><strong>获取相对应的值</strong></em></u>，注意 <code>$&#123;&#125;</code> 需要<u><em><strong>手动加单引号</strong></em></u>。</p>
</li>
<li>
<p>使用 <code>@Param</code> 注解的 <code>value</code> 或者 <code>param</code> 都行，推荐使用 <code>@Param</code> 注解的 <code>value</code></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 使用@Param注解来命名MyBatis自动提供的Map对象的key</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectUserByAnnotation</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                                <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    User selectUserByAnnotation(@Param(&quot;username&quot;) String username, @Param(&quot;password&quot;) String password);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAnnotation&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line">        <span class="comment">&lt;!-- select * from t_user where username = #&#123;param1&#125; and password = #&#123;param2&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectUserByAnnotation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserByAnnotation(<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-mybatis-的增删改"><a class="markdownIt-Anchor" href="#6-mybatis-的增删改"></a> 6 MyBatis 的增删改</h3>
<h4 id="61-添加"><a class="markdownIt-Anchor" href="#61-添加"></a> 6.1 添加</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int insertUser();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">	insert into t_user values(null,&#x27;admin&#x27;,&#x27;123456&#x27;,23,&#x27;男&#x27;,&#x27;12345@qq.com&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="62-删除"><a class="markdownIt-Anchor" href="#62-删除"></a> 6.2 删除</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int deleteUser();--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span>&gt;</span></span><br><span class="line">     delete from t_user where id = 6</span><br><span class="line"> <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="63-修改"><a class="markdownIt-Anchor" href="#63-修改"></a> 6.3 修改</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int updateUser();--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span>&gt;</span></span><br><span class="line">     update t_user set username = &#x27;张三&#x27; where id = 5</span><br><span class="line"> <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="7-特殊sql的执行"><a class="markdownIt-Anchor" href="#7-特殊sql的执行"></a> 7. 特殊SQL的执行</h3>
<h4 id="71-模糊查询"><a class="markdownIt-Anchor" href="#71-模糊查询"></a> 7.1 模糊查询</h4>
<p>模糊查询的 <code>SQL</code> 语句形如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%g%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>我们可以看到，在语句中我们需要传入的参数是 <code>&quot;g&quot;</code> 这个字符串，当我们使用</p>
<ul>
<li><code>#&#123;&#125;</code> 时，在执行SQL语句时会转化为 <code>'%?%'</code>，此时模糊查询的内容就变成了 <code>&quot;?&quot;</code></li>
<li><code>$&#123;&#125;</code> 时，我们应该使用这个占位符， <code>$&#123;&#125;</code> 所转化的字符是 <code>g</code></li>
<li>或者直接使用 <code>SQL</code> 中的 <code>concat()</code> 函数，进行字符串拼接</li>
<li>或者直接使用 <code>select * from t_user where name like &quot;%&quot;#&#123;&#125;&quot;%&quot;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_user where username like &#x27;%$&#123;username&#125;%&#x27;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">selectUserByNameLike</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--		List&lt;User&gt; selectUserByNameLike(@Param(&quot;username&quot;) String name);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByNameLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--select * from t_user where username like &#x27;%$&#123;username&#125;%&#x27;--&gt;</span>  </span><br><span class="line">	<span class="comment">&lt;!--select * from t_user where username like concat(&#x27;%&#x27;,#&#123;username&#125;,&#x27;%&#x27;)--&gt;</span>  </span><br><span class="line">	select * from t_user where username like &quot;%&quot;#&#123;username&#125;&quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>其中 <code>select * from t_user where username like &quot;%&quot;#&#123;username&#125;&quot;%&quot;</code> 是最常用的</li>
</ul>
<h4 id="72-批量删除"><a class="markdownIt-Anchor" href="#72-批量删除"></a> 7.2 批量删除</h4>
<p>只能使用 <code>$&#123;&#125;</code>，如果使用 <code>#&#123;&#125;</code>，则解析后的 <code>SQL</code> 语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="string">&#x27;1,2,3&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这样是将 <code>'1,2,3'</code> 看做是一个整体，只有 <code>id</code> 为 <code>'1,2,3'</code>的数据会被删除。</p>
<p>正确的语句应该是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from t_user where id in ($&#123;ids&#125;)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteMore</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String ids)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteMore&quot;</span>&gt;</span></span><br><span class="line">	delete from t_user where id in ($&#123;ids&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMore</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">	<span class="type">SQLMapper</span> <span class="variable">sqlMapper</span> <span class="operator">=</span> sqlSession.getMapper(SQLMapper.class);</span><br><span class="line">	<span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlMapper.deleteMore(<span class="string">&quot;1,2,3,8&quot;</span>);</span><br><span class="line">	System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="73-动态设置表名"><a class="markdownIt-Anchor" href="#73-动态设置表名"></a> 7.3 动态设置表名</h4>
<ul>
<li>只能使用 <code>$&#123;&#125;</code>，因为<u><em><strong>表名不能加单引号</strong></em></u></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from $&#123;tableName&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUserByTable</span><span class="params">(<span class="meta">@Param(&quot;tableName&quot;)</span> String tableName)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;User&gt; getUserByTable(@Param(&quot;tableName&quot;) String tableName);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByTable&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">	select * from $&#123;tableName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="74-添加功能获取自增的主键"><a class="markdownIt-Anchor" href="#74-添加功能获取自增的主键"></a> 7.4 添加功能获取自增的主键</h4>
<p>如果我们在数据库表的创建时使用了<u><em><strong>主键自增</strong></em></u>（<code>auto_increment</code>），那么我们在<u><em><strong>创建一个实体类对象并将其持久化到数据库</strong></em></u>的过程中就<u><em><strong>不需要为其设置主键</strong></em></u>（即 <code>id=null</code>）。但是我们在<u><em><strong>实体类</strong></em></u>中依然要获得数据库为对象自动分配的这个<u><em><strong>主键</strong></em></u>，我们就可以使用以下功能：</p>
<ul>
<li>在 <code>mapper.xml</code> 中设置两个属性 <code>(@Options)</code>：
<ul>
<li><code>useGeneratedKeys = &quot;true | false&quot;</code>：标识是否使用了主键的自动生成</li>
<li><code>keyProperty=&quot;_filed&quot;</code>：将获取的自增的主键放在对象的某个<u><em><strong>属性</strong></em></u> (<code>_filed</code>) 中</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;insert into t_user values (null,#&#123;username&#125;,#&#123;password&#125;,#&#123;age&#125;,#&#123;sex&#125;,#&#123;email&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--void insertUser(User user);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">	insert into t_user values (null,#&#123;username&#125;,#&#123;password&#125;,#&#123;age&#125;,#&#123;sex&#125;,#&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">	<span class="type">SQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SQLMapper.class);</span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;123@321.com&quot;</span>);</span><br><span class="line">	mapper.insertUser(user);</span><br><span class="line">	System.out.println(user);</span><br><span class="line">  </span><br><span class="line">	<span class="comment">// 输出</span></span><br><span class="line">  <span class="comment">// user&#123;id=10, username=&#x27;tom&#x27;, password=&#x27;123&#x27;, age=23, sex=&#x27;男&#x27;, email=&#x27;123@321.com&#x27;&#125;</span></span><br><span class="line">  <span class="comment">// 自增主键存放到了user的id属性中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四-自定义映射-resultmap"><a class="markdownIt-Anchor" href="#四-自定义映射-resultmap"></a> 四、自定义映射 <code>resultMap</code></h2>
<p>我们之前在查询部分说过：</p>
<blockquote>
<p>查询的标签 <code>&lt;select&gt;</code> 必须设置属性 <code>resultType</code> 或 <code>resultMap</code>，用于设置实体类和数据库表的映射关系</p>
<ul>
<li><code>resultType</code>：自动映射，用于属性名和表中<u><em><strong>字段名一致</strong></em></u>的情况</li>
<li><code>resultMap (@Results(@Result() ...))</code>：自定义映射，用于<u><em><strong>一对多或多对一</strong></em></u>或<u><em><strong>字段名和属性名不一致</strong></em></u>的情况</li>
</ul>
</blockquote>
<p>如果当前字段名与属性名不一致或一对多的关系映射时，我们需要使用 <code>resultMap</code> 用来<u><em><strong>自定义映射关系</strong></em></u>。</p>
<p>在此之前，我们要先准备实验环境：两个实体类（员工类 <code>Emp</code> 和部门类 <code>Dept</code>）和与之相对应的表（<code>t_emp</code> 和 <code>t_dept</code>）</p>
<p><code>Emp.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer empId;</span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line">    <span class="keyword">private</span> Integer empAge;</span><br><span class="line">    <span class="keyword">private</span> String empGender;</span><br><span class="line">    <span class="keyword">private</span> String empEmail;</span><br><span class="line">    <span class="keyword">private</span> Dept dept;</span><br><span class="line">  <span class="comment">// 省略getter，setter以及构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>t_emp</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_emp(</span><br><span class="line">    emp_id     <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    emp_name   <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">null</span>,</span><br><span class="line">    emp_age    <span class="type">int</span>         <span class="keyword">null</span>,</span><br><span class="line">    emp_gender <span class="type">varchar</span>(<span class="number">1</span>)  <span class="keyword">null</span>,</span><br><span class="line">    emp_email  <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">    dept_id    <span class="type">int</span>         <span class="keyword">null</span></span><br><span class="line">) comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;gdai&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;gdai@gdai.com&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;tom&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;tom@tom.com&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;enzo&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;enzo@enzo.com&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;theo&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;男&#x27;</span>, empEmail<span class="operator">=</span><span class="string">&#x27;theo@theo.com&#x27;</span>, dept<span class="operator">=</span><span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;amina&#x27;</span>, <span class="number">22</span>, <span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;amina@amina.com&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_emp <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;clement&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;clement@clement.com&#x27;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><code>Dept.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dept</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer deptId;</span><br><span class="line">    <span class="keyword">private</span> String deptName;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 省略getter，setter以及构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>t_dept</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_dept(</span><br><span class="line">    dept_id   <span class="type">int</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">null</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_dept <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;enseeiht&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_dept <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;tbs&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_dept <span class="keyword">values</span>(<span class="keyword">null</span>, <span class="string">&#x27;tgu&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="1-字段名与属性名不一致"><a class="markdownIt-Anchor" href="#1-字段名与属性名不一致"></a> 1 字段名与属性名不一致</h3>
<p>我们先从一个例子开始讲起：我们先不做任何修改，按照之前的方法尝试获得结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有的员工信息</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getAllEmp</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getAllEmp(); 此时因为数据库字段名与类中的属性名不同，所以无法匹配 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllEmp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">empMapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line">    List&lt;Emp&gt; empList = empMapper.getAllEmp();</span><br><span class="line">    <span class="keyword">for</span> (Emp e:empList) &#123;</span><br><span class="line">        System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们进行测试的话，并不会报错，但是无法得到相对应的实体类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[1105 17:31:00 870 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt;  Preparing: select * from t_emp</span><br><span class="line">[1105 17:31:00 885 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt; Parameters: </span><br><span class="line">[1105 17:31:00 904 DEBUG] [main] mapper.EmpMapper.getAllEmp - &lt;==      Total: 6</span><br><span class="line">null</span><br><span class="line">null</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>我们可以看到，在 <code>Emp</code> 类与表 <code>t_emp</code> 中，<u><em><strong>实体类的属性名与表的字段名</strong></em></u>因为<u><em><strong>不同的命名规范</strong></em></u>而不同（<code>empId</code> 与 <code>emp_id</code>），所以我们需要<u><em><strong>自定义映射关系来讲他们一一联系起来</strong></em></u>。这里我们一共三种方法：</p>
<h4 id="11-为sql字段设置别名"><a class="markdownIt-Anchor" href="#11-为sql字段设置别名"></a> 1.1 为（<code>SQL</code>）字段设置别名</h4>
<p>我们在 <code>SQL</code> 中可以为最后的查询结果设置别名，这样就可以解决实体类的属性名与表的字段名不一致的问题：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 方法1：使用SQL中别名as的方法解决 --&gt;</span></span><br><span class="line">  select emp_id empId, emp_name empName, emp_age empAge, emp_gender empGender, emp_email empEmail from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select emp_id empId, emp_name empName, emp_age empAge, emp_gender empGender, emp_email empEmail from t_emp&quot;)</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getAllEmp</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>测试结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[1105 17:33:59 093 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt;  Preparing: select emp_id empId, emp_name empName, emp_age empAge, emp_gender empGender, emp_email empEmail from t_emp</span><br><span class="line">[1105 17:33:59 107 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt; Parameters: </span><br><span class="line">[1105 17:33:59 125 DEBUG] [main] mapper.EmpMapper.getAllEmp - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>问题解决。</p>
<h4 id="12-修改全局配置"><a class="markdownIt-Anchor" href="#12-修改全局配置"></a> 1.2 修改全局配置</h4>
<p>在之前<a href>核心配置文件</a>中介绍过 <a href><code>&lt;settings&gt;</code> 标签</a>，其中的 <code>mapUnderscoreToCamelCase</code> 选项可以<u><em><strong>设置是否开启驼峰命名自动映射</strong></em></u>，即从经典数据库字段名 <code>a_column</code> 映射到经典 Java 属性名 <code>aColumn</code>。</p>
<p><u><em><strong>注意 ⚠️</strong></em></u>：数据库字段名与 Java 属性的驼峰命名必须符合规范，且按照规则对应。</p>
<p><code>mybatis-config.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>mapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getAllEmp(); 已设置全局配置 mapUnderscoreToCamelCase = true --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 方法2：在MyBatis核心设置中使用全剧配置标签开启自动映射 --&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_emp&quot;)</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getAllEmp</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>测试结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[1105 17:33:59 093 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt;  Preparing: select * from t_emp</span><br><span class="line">[1105 17:33:59 107 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt; Parameters: </span><br><span class="line">[1105 17:33:59 125 DEBUG] [main] mapper.EmpMapper.getAllEmp - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>问题解决。</p>
<h4 id="13-resultmap-results-自定义映射关系"><a class="markdownIt-Anchor" href="#13-resultmap-results-自定义映射关系"></a> 1.3 <code>resultMap (@Results)</code> 自定义映射关系</h4>
<p>此时，我们就不能使用默认的自动映射 <code>resultType</code>，而需要改用 <code>resultMap</code>：</p>
<p><code>&lt;resultMap&gt; (@Results)</code> 标签：设置自定义映射</p>
<p>属性：</p>
<ul>
<li><code>id (id)</code>：表示自定义映射<code>&lt;resultMap&gt;</code> 的<u><em><strong>唯一标识</strong></em></u>，不能重复</li>
<li><code>type</code>：查询的数据<u><em><strong>要映射的实体类</strong></em></u>的类型</li>
<li><code>(value&#123;...&#125;)</code>：以注解的形式配置映射关系<code>(@Result)</code></li>
</ul>
<p>子标签 <code>(@Reslut)</code>：</p>
<ul>
<li><code>&lt;id&gt; (id=true)</code>：设置<u><em><strong>主键</strong></em></u>的映射关系</li>
<li><code>&lt;result&gt;</code>：设置普通字段的映射关系
<ul>
<li><code>property</code>：设置映射关系中<u><em><strong>实体类中的属性名</strong></em></u></li>
<li><code>column</code>：设置映射关系中<u><em><strong>表中的字段名</strong></em></u></li>
</ul>
</li>
</ul>
<p><u><em><strong>注意 ⚠️</strong></em></u>：即使字段名和属性名一致的属性也要映射，也就是<u><em><strong>全部属性都要列出来</strong></em></u>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法3：使用resultMap来自定义映射关系，如下所示 --&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_emp&quot;)</span></span><br><span class="line"><span class="meta">@Results( id=&quot;empResultMap&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">        @Result (id = true, property=&quot;empId&quot;, column=&quot;emp_id&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empName&quot;, column=&quot;emp_name&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empAge&quot;, column=&quot;emp_age&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empGender&quot;, column=&quot;emp_gender&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empEmail&quot;, column=&quot;emp_email&quot;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getAllEmp</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>测试结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[1105 17:33:59 093 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt;  Preparing: </span><br><span class="line">		select * from t_emp</span><br><span class="line">[1105 17:33:59 107 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt; Parameters: </span><br><span class="line">[1105 17:33:59 125 DEBUG] [main] mapper.EmpMapper.getAllEmp - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>问题解决。</p>
<h3 id="2-多对一关系映射"><a class="markdownIt-Anchor" href="#2-多对一关系映射"></a> 2 多对一关系映射</h3>
<p>在处理<u><em><strong>多对一</strong></em></u>关系时，需要在<u><em><strong>多的一端</strong></em></u>创建一个<u><em><strong>一的实体对象</strong></em></u>；相同的，需要在<u><em><strong>一的一端</strong></em></u>创建一个<u><em><strong>多的实体对象集合</strong></em></u>。使用员工类 <code>Emp</code> 和部门类 <code>Dept</code> 来举例：</p>
<blockquote>
<p><u><em><strong>多个员工</strong></em></u>对应着<u><em><strong>一个部门</strong></em></u>，所以在这段关系里，员工是多、部门为一。</p>
</blockquote>
<p>我们需要在员工类 <code>Emp</code> 里添加属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dept dept;</span><br></pre></td></tr></table></figure>
<p>在部门类 <code>Dept</code> 里添加属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Emp&gt; emps;</span><br></pre></td></tr></table></figure>
<p>但是这些信息并不存储在同一张表里，那么，我们如何描述这种<u><em><strong>多对一</strong></em></u>关系映射呢？</p>
<p>一共有三种方法：</p>
<h4 id="21-级联属性赋值"><a class="markdownIt-Anchor" href="#21-级联属性赋值"></a> 2.1 级联属性赋值</h4>
<p>如果我们需要查询<u>“所有的员工信息及其<strong>部门信息</strong>”</u>，那么就意味着我们不仅需要查找员工表，还要查找部门表。在 <code>SQL</code> 中，我们可以使用<u><em><strong>外连接来实现多表查询</strong></em></u>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有的员工信息及其部门信息</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getAllEmpAndDept</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>我们仍然需要自定义映射 <code>resultMap</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法一：级联属性赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_Cascade&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 处理多对一的关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id&quot;)</span></span><br><span class="line"><span class="meta">@Results( id=&quot;empAndDeptResultMap_Many2One_Cascade&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">        @Result (id = true, property=&quot;empId&quot;, column=&quot;emp_id&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empName&quot;, column=&quot;emp_name&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empAge&quot;, column=&quot;emp_age&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empGender&quot;, column=&quot;emp_gender&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;empEmail&quot;, column=&quot;emp_email&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;dept.deptId&quot;, column=&quot;dept_id&quot;),</span></span><br><span class="line"><span class="meta">        @Result (property=&quot;dept.deptName&quot;, column=&quot;dept_name&quot;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getAllEmpAndDept</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>这里处理多对一关系时，</p>
<ul>
<li>
<p><code>property=&quot;dept.deptId&quot;</code>：设置映射关系中<u><em><strong>实体类中的属性名</strong></em></u></p>
</li>
<li>
<p><code>column=&quot;dept_id</code>：设置映射关系中<u><em><strong>表中的字段名</strong></em></u></p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getAllEmpAndDept();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_Cascade&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllEmpAndDept</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">empMapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line">    List&lt;Emp&gt; empList = empMapper.getAllEmpAndDept();</span><br><span class="line">    <span class="keyword">for</span> (Emp e:empList) &#123;</span><br><span class="line">        System.out.println(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1105 18:25:25 939 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt;  Preparing:</span><br><span class="line">		select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">[1105 18:25:25 952 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt; Parameters: </span><br><span class="line">[1105 18:25:25 972 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, </span><br><span class="line">	dept=Dept&#123;deptId=3, deptName=&#x27;tgu&#x27;&#125;&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;,</span><br><span class="line">	dept=Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;&#125;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>我们可以看到，部门表中的信息 <code>dept</code> 也存在与实体类中了。</p>
<h4 id="22-association-one-标签"><a class="markdownIt-Anchor" href="#22-association-one-标签"></a> 2.2 <code>&lt;association&gt; (@One)</code> 标签</h4>
<blockquote>
<p><u><em><strong>注意 ⚠️</strong></em></u>：使用注解 <code>@One</code> 时，详见下一小节：分步查询</p>
</blockquote>
<p>我们也可以使用 <code>&lt;association&gt;</code> 标签专门处理<u><em><strong>多对一</strong></em></u>的映射关系：</p>
<p><code>&lt;association&gt;</code>：处理多对一的映射关系</p>
<ul>
<li><code>property</code>：需要处理多对一映射关系的<u><em><strong>属性名</strong></em></u></li>
<li><code>javaType</code>：对应 <code>property</code> 的实体类的<u><em><strong>类型</strong></em></u>，通过反射获得对应对象。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法二：Association 标签映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_Association&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getAllEmpAndDept();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_Association&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1105 18:25:25 939 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt;  Preparing:</span><br><span class="line">		select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">[1105 18:25:25 952 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt; Parameters: </span><br><span class="line">[1105 18:25:25 972 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, </span><br><span class="line">	dept=Dept&#123;deptId=3, deptName=&#x27;tgu&#x27;&#125;&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;,</span><br><span class="line">	dept=Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;&#125;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="23-分步查询"><a class="markdownIt-Anchor" href="#23-分步查询"></a> 2.3 分步查询</h4>
<h5 id="思想"><a class="markdownIt-Anchor" href="#思想"></a> 思想</h5>
<p>以上两种方法都是基于一条（左/右）<u><em><strong>外连接</strong></em></u>的 <code>SQL</code> 来实现多表查询，即</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">left</span> <span class="keyword">join</span> t_dept <span class="keyword">on</span> t_emp.dept_id <span class="operator">=</span> t_dept.dept_id</span><br></pre></td></tr></table></figure>
<p>其中，外连接的条件是 <code>t_emp.dept_id = t_dept.dept_id</code>。</p>
<p>那么我们可以将这条 <code>SQL</code> 分开，<u><em><strong>分成两个部分</strong></em></u>，从而实现相同的功能：</p>
<ol>
<li>
<p>我们先在 <code>t_emp</code> 表中查询所有的员工信息；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>然后将查询结果中的 <code>t_emp.dept_id</code> 字段作为查询条件，在 <code>t_dept</code> 表中查询部门信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dept <span class="keyword">where</span> dept_id<span class="operator">=</span>员工表查询结果;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>基于这个思路，我们可以通过 <code>&lt;association&gt;</code> 标签实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">select</span>=<span class="string">&quot;&quot;</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>property</code>：需要处理多对一映射关系的<u><em><strong>属性名</strong></em></u></li>
<li><code>select</code>：设置<u><em><strong>分布查询的 <code>SQL</code> 的唯一标识</strong></em></u>（<code>XxxMapper</code> 接口的<code>全限定类名.方法名</code>）</li>
<li><code>column</code>：设置<u><em><strong>分步查询的条件</strong></em></u>，也即两表查询时的“纽带”（相同的部分，主/外键）</li>
</ul>
<h5 id="操作"><a class="markdownIt-Anchor" href="#操作"></a> 操作</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法三：分布查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_ByStep&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 第 2 步查询 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;fr.gdai.mybatis.mapper.DeptMapper.getDeptByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getAllEmpAndDept();--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第 1 步查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMap_Many2One_StepByStep&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_emp where emp_id = #&#123;empId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Results( id=&quot;empAndDeptResultMap_Many2One_StepByStep&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">    @Result (id = true, property=&quot;empId&quot;, column=&quot;emp_id&quot;),</span></span><br><span class="line"><span class="meta">    @Result (property=&quot;empName&quot;, column=&quot;emp_name&quot;),</span></span><br><span class="line"><span class="meta">    @Result (property=&quot;empAge&quot;, column=&quot;emp_age&quot;),</span></span><br><span class="line"><span class="meta">    @Result (property=&quot;empGender&quot;, column=&quot;emp_gender&quot;),</span></span><br><span class="line"><span class="meta">    @Result (property=&quot;empEmail&quot;, column=&quot;emp_email&quot;),</span></span><br><span class="line"><span class="meta">    @Result (javaType = Dept.class, property=&quot;dept&quot;, column=&quot;dept_id&quot;,</span></span><br><span class="line"><span class="meta">             one=@One(select = &quot;fr.gdai.mybatis.mapper.DeptMapper.getDeptByDeptId&quot;)),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">Emp <span class="title function_">getEmpAndDeptStepByStep</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> <span class="type">int</span> empId)</span>;</span><br></pre></td></tr></table></figure>
<p>以下为<u><em><strong>第 2 步查询</strong></em></u>的部分：</p>
<p><code>fr.gdai.mybatis.mapper.DeptMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 通过deptId查询部门</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_dept where dept_id = #&#123;deptId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Results( id = &quot;deptResultMap&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">            @Result(id = true, property=&quot;deptId&quot;, column=&quot;dept_id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(property=&quot;deptName&quot;, column=&quot;dept_name&quot;),</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    Dept <span class="title function_">getDeptByDeptId</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> <span class="type">int</span> deptId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DeptMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    Dept getDeptBtDeptId(@Param(&quot;deptId&quot;) int deptId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptBtDeptId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_dept where dept_id = #&#123;deptId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1105 18:25:25 939 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt;  Preparing:</span><br><span class="line">		select * from t_emp left join t_dept on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">[1105 18:25:25 952 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - ==&gt; Parameters: </span><br><span class="line">[1105 18:25:25 972 DEBUG] [main] mapper.EmpMapper.getAllEmpAndDept - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, </span><br><span class="line">	dept=Dept&#123;deptId=3, deptName=&#x27;tgu&#x27;&#125;&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;,</span><br><span class="line">	dept=Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;&#125;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h5 id="优点"><a class="markdownIt-Anchor" href="#优点"></a> 优点</h5>
<ol>
<li>（模块化、解耦）可以将多个 <code>SQL</code> 语句通过这种方式组合起来，从而实现复杂的功能；</li>
<li>延迟加载，可以实现按需加载，获取的数据是什么，就只会执行相应的 <code>SQL</code>
<ul>
<li><code>lazyLoadingEnabled</code>：延迟加载的全局开关。当<u><em><strong>开启时</strong></em></u>，所有关联对象都会<u><em><strong>延迟加载</strong></em></u></li>
<li><code>aggressiveLazyLoading</code>：当<u><em><strong>开启时</strong></em></u>，任何方法的调用都会<u><em><strong>加载该对象的所有属性</strong></em></u>。 否则，每个属性会按需加载</li>
<li><u><em><strong>当开启全局的延迟加载</strong></em></u>后，可通过 <code>association</code> 和 <code>collection</code> 中的 <code>fetchType</code> 属性设置当前的分步查询是否使用延迟加载，<code>fetchType=&quot;lazy(默认，延迟加载)|eager(立即加载)&quot;</code></li>
</ul>
</li>
</ol>
<h3 id="3-一对多关系映射"><a class="markdownIt-Anchor" href="#3-一对多关系映射"></a> 3 一对多关系映射</h3>
<p>在<a href>本章第 2 节</a>中，我们提到：</p>
<blockquote>
<p>在处理<u><em><strong>多对一</strong></em></u>关系时，需要在<u><em><strong>多的一端</strong></em></u>创建一个<u><em><strong>一的实体对象</strong></em></u>；相同的，需要在<u><em><strong>一的一端</strong></em></u>创建一个<u><em><strong>多的实体对象集合</strong></em></u>。</p>
</blockquote>
<p>相应的，我们在“多的一端”部门类 <code>Dept</code> 里添加属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Emp&gt; emps;</span><br></pre></td></tr></table></figure>
<p>与多对一关系映射相似，一对多关系映射也有多种方法：</p>
<h4 id="31-collection-many-标签"><a class="markdownIt-Anchor" href="#31-collection-many-标签"></a> 3.1 <code>&lt;collection&gt; (@Many)</code> 标签</h4>
<blockquote>
<p><u><em><strong>注意 ⚠️</strong></em></u>：使用注解 <code>@Many</code> 时，详见下一小节：分步查询</p>
</blockquote>
<p>与 <code>&lt;association&gt;</code> 标签专门处理多对一的映射关系类似，<code>&lt;collection&gt;</code> 标签专门处理<u><em><strong>一对多的映射关系</strong></em></u>。</p>
<p><code>&lt;collection&gt;</code> 标签：用来处理一对多的映射关系</p>
<ul>
<li><code>property</code>：需要处理多对一映射关系的<u><em><strong>实体类集合属性名</strong></em></u></li>
<li><code>ofType</code>：对应 <code>property</code> 的<u><em><strong>集合中存储的数据的类型</strong></em></u></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得指定部门以及部门中所有员工的信息</span></span><br><span class="line">Dept <span class="title function_">getDeptAndEmpsByDeptId</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> <span class="type">int</span> deptId)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法一：collection 处理一对多的映射关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptAndEmpsResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    Dept getDeptAndEmpByDeptId(@Param(&quot;deptId&quot;) int deptId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpsByDeptId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptAndEmpsResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_dept left join t_emp on t_dept.dept_id = t_emp.dept_id where t_dept.dept_id = #&#123;deptId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptAndEmpsByDeptId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DeptMapper</span> <span class="variable">deptMapper</span> <span class="operator">=</span> sqlSession.getMapper(DeptMapper.class);</span><br><span class="line">    System.out.println(deptMapper.getDeptAndEmpsByDeptId(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1105 19:46:22 221 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptId - ==&gt;  Preparing: select * from t_dept left join t_emp on t_dept.dept_id = t_emp.dept_id where t_dept.dept_id = ?</span><br><span class="line">[1105 19:46:22 236 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptId - ==&gt; Parameters: 1(Integer)</span><br><span class="line">[1105 19:46:22 259 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptId - &lt;==      Total: 4</span><br><span class="line">Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;, emps=</span><br><span class="line">[Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;, </span><br><span class="line">Emp&#123;empId=3, empName=&#x27;enzo&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;enzo@enzo.com&#x27;, dept=null&#125;, </span><br><span class="line">Emp&#123;empId=4, empName=&#x27;theo&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;theo@theo.com&#x27;, dept=null&#125;, </span><br><span class="line">Emp&#123;empId=6, empName=&#x27;clement&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;clement@clement.com&#x27;, dept=null&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-分步查询"><a class="markdownIt-Anchor" href="#32-分步查询"></a> 3.2 分步查询</h4>
<h5 id="思想-2"><a class="markdownIt-Anchor" href="#思想-2"></a> 思想</h5>
<p>相同的，对于一对多的关系映射，我们依然可以将“外连接”的 <code>SQL</code> 拆分成多步来执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 左外连接</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dept <span class="keyword">left</span> <span class="keyword">join</span> t_emp <span class="keyword">on</span> t_dept.dept_id <span class="operator">=</span> t_emp.dept_id</span><br></pre></td></tr></table></figure>
<p>那么我们可以将这条 <code>SQL</code> 分开，<u><em><strong>分成两个部分</strong></em></u>，从而实现相同的功能：</p>
<ol>
<li>
<p>我们先在 <code>t_dept</code> 表中查询所有的部门信息；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dept;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>然后将查询结果中的 <code>t_dept.dept_id</code> 字段作为查询条件，在 <code>t_emp</code> 表中查询部门信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_emp <span class="keyword">where</span> dept_id<span class="operator">=</span>部门表查询结果;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>与之前一致。基于这个思路，我们可以通过 <code>&lt;collection&gt;</code> 标签实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">select</span>=<span class="string">&quot;&quot;</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>property</code>：需要处理多对一映射关系的<u><em><strong>属性名</strong></em></u></li>
<li><code>select</code>：设置<u><em><strong>分布查询的 <code>SQL</code> 的唯一标识</strong></em></u>（<code>XxxMapper</code> 接口的<code>全限定类名.方法名</code>）</li>
<li><code>column</code>：设置<u><em><strong>分步查询的条件</strong></em></u>，也即两表查询时的“纽带”（相同的部分，主/外键）</li>
</ul>
<h5 id="操作-2"><a class="markdownIt-Anchor" href="#操作-2"></a> 操作</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptAndEmpsResultMapByStep&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;fr.gdai.mybatis.mapper.EmpMapper.getEmpsListByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    Dept getDeptAndEmpsByDeptId(@Param(&quot;deptId&quot;) int deptId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpsByDeptId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptAndEmpsResultMapByStep&quot;</span>&gt;</span></span><br><span class="line">        select * from t_dept where dept_id = #&#123;deptId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_dept where dept_id = #&#123;deptId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Results( id=&quot;deptAndEmpResultMap_One2Many_Step&quot;, value=&#123;</span></span><br><span class="line"><span class="meta">    @Result(id = true, property=&quot;deptId&quot;, column=&quot;dept_id&quot;),</span></span><br><span class="line"><span class="meta">    @Result(property=&quot;deptName&quot;, column=&quot;dept_name&quot;),</span></span><br><span class="line"><span class="meta">    @Result(property = &quot;emps&quot;,</span></span><br><span class="line"><span class="meta">            column = &quot;dept_id&quot;,</span></span><br><span class="line"><span class="meta">            javaType = List.class,</span></span><br><span class="line"><span class="meta">            many = @Many(select = &quot;fr.gdai.mybatis.mapper.EmpMapper.getEmpsListByDeptId&quot;)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">Dept <span class="title function_">getDeptAndEmpsByDeptIdStep</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> <span class="type">int</span> deptId)</span>;</span><br></pre></td></tr></table></figure>
<p>以下为<u><em><strong>第 2 步查询</strong></em></u>的部分：</p>
<p><code>fr.gdai.mybatis.mapper.EmpMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 根据dept_id查询员工信息</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_emp where dept_id = #&#123;DeptId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;empResultMap&quot;)</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getEmpsListByDeptId</span><span class="params">(<span class="meta">@Param(&quot;DeptId&quot;)</span> <span class="type">int</span> DeptId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/EmpMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empGender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empEmail&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getEmpsListByDeptId(@Param(&quot;DeptId&quot;) int DeptId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsListByDeptId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp where dept_id = #&#123;DeptId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[1106 15:56:19 033 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptIdStep - ==&gt;  Preparing: select * from t_dept where dept_id = ?</span><br><span class="line">[1106 15:56:19 052 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptIdStep - ==&gt; Parameters: 1(Integer)</span><br><span class="line">[1106 15:56:19 066 DEBUG] [main] mapper.EmpMapper.getEmpsListByDeptId - ====&gt;  Preparing: select * from t_emp where dept_id = ?</span><br><span class="line">[1106 15:56:19 066 DEBUG] [main] mapper.EmpMapper.getEmpsListByDeptId - ====&gt; Parameters: 1(Integer)</span><br><span class="line">[1106 15:56:19 067 DEBUG] [main] mapper.EmpMapper.getEmpsListByDeptId - &lt;====      Total: 4</span><br><span class="line">[1106 15:56:19 068 DEBUG] [main] mapper.DeptMapper.getDeptAndEmpsByDeptIdStep - &lt;==      Total: 1</span><br><span class="line">Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;, emps=[</span><br><span class="line">	Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;,</span><br><span class="line">	Emp&#123;empId=3, empName=&#x27;enzo&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;enzo@enzo.com&#x27;, dept=null&#125;,</span><br><span class="line">	Emp&#123;empId=4, empName=&#x27;theo&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;theo@theo.com&#x27;, dept=null&#125;,</span><br><span class="line">	Emp&#123;empId=6, empName=&#x27;clement&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;clement@clement.com&#x27;, dept=null&#125;</span><br><span class="line">]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="优点-2"><a class="markdownIt-Anchor" href="#优点-2"></a> 优点</h5>
<ol>
<li>（模块化、解耦）可以将多个 <code>SQL</code> 语句通过这种方式组合起来，从而实现复杂的功能；</li>
<li>延迟加载，可以实现按需加载，获取的数据是什么，就只会执行相应的 <code>SQL</code>
<ul>
<li><code>lazyLoadingEnabled</code>：延迟加载的全局开关。当<u><em><strong>开启时</strong></em></u>，所有关联对象都会<u><em><strong>延迟加载</strong></em></u></li>
<li><code>aggressiveLazyLoading</code>：当<u><em><strong>开启时</strong></em></u>，任何方法的调用都会<u><em><strong>加载该对象的所有属性</strong></em></u>。 否则，每个属性会按需加载</li>
<li><u><em><strong>当开启全局的延迟加载</strong></em></u>后，可通过 <code>association</code> 和 <code>collection</code> 中的 <code>fetchType</code> 属性设置当前的分步查询是否使用延迟加载，<code>fetchType=&quot;lazy(默认，延迟加载)|eager(立即加载)&quot;</code></li>
</ul>
</li>
</ol>
<h2 id="五-动态-sql"><a class="markdownIt-Anchor" href="#五-动态-sql"></a> 五、动态 <code>SQL</code></h2>
<p>Mybatis 框架的动态 <code>SQL</code> 技术是一种<u><em><strong>根据特定条件动态拼装 <code>SQL</code> 语句</strong></em></u>的功能，它存在的意义是为了解决拼接 <code>SQL</code> 语句字符串时的痛点问题。</p>
<blockquote>
<p>举一个简单的例子，当我们想在一个<u><em><strong>员工管理页面</strong></em></u> 中检索<u><em><strong>符合条件的员工</strong></em></u>，通常会有如下所示的下拉列表。如果我们<u><em><strong>选择了其中的值</strong></em></u>，相应地，<code>SQL</code> 的语句也应该为此<u><em><strong>动态地做出改变</strong></em></u>。</p>
<table align="center">
 <tr>
  <td align="center">
   <form name="gender">
      <label>性别：</label>
      <select>
        <option value="null">null</option>
        <option value="male">男</option>
        <option value="female">女</option>
      </select>
    </form>
  </td>
  <td align="center">
   <form name="age">
年龄: <input type="text" name="age" value placeholder="输入年龄">
  </form></td>
   <td align="center">
   <form name="dept">
      <label>部门：</label>
      <select>
        <option value="null">null</option>
        <option value="1">enseeiht</option>
        <option value="2">tbs</option>
        <option value="3">tgu</option>
      </select>
    </form>
  </td>
   <td align="center"><input type="button" value="搜索"></td>
 </tr>
</table>
</blockquote>
<h3 id="1-if-标签"><a class="markdownIt-Anchor" href="#1-if-标签"></a> 1 <code>&lt;if&gt;</code> 标签</h3>
<h4 id="11-思路"><a class="markdownIt-Anchor" href="#11-思路"></a> 1.1 思路</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;结果返回类型&quot;</span>&gt;</span></span><br><span class="line">        select * from table where 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;param != null and param != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and table_param = #&#123;param&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>&lt;if&gt;</code> 标签可通过 <code>test</code> 属性（即传递过来的数据 <code>param</code>）的表达式进行判断。若表达式的结果为 <code>true</code>，则标签中的<u><em><strong>内容会执行</strong></em></u>；反之标签中的内容不会执行</p>
</li>
<li>
<p>在 <code>where</code> 后面添加一个<u><em><strong>恒成立条件</strong></em></u> <code>1=1</code>，这个恒成立条件并不会影响查询的结果</p>
<ul>
<li>
<p>这个 <code>1=1</code> 可以用来拼接 <code>and</code> 语句，例如：当 <code>param</code> 为 <code>null</code> 时，可以使 <code>SQL</code> 语句不会被拼接为如下所示而报错</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 错误的SQL语法</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 加入1=1后</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="12-操作"><a class="markdownIt-Anchor" href="#12-操作"></a> 1.2 操作</h4>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// &lt;if&gt;标签实现若干条件查询</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getEmpByConditions</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getEmpByConditionsIfLabel(Emp emp);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByConditionsIfLabel&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp where 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_name = #&#123;empName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empAge != null and empAge != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_age = #&#123;empAge&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empGender != null and empGender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_gender = #&#123;empGender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empEmail != null and empEmail != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_email = #&#123;empEmail&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByConditionsIfLabel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">        <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">        List&lt;Emp&gt; result = mapper.getEmpByConditionsIfLabel(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;gdai&quot;</span>, <span class="number">24</span>, <span class="string">&quot;男&quot;</span>,<span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1106 17:33:45 501 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsIfLabel - ==&gt;  Preparing: select * from t_emp where 1=1 and emp_name = ? and emp_age = ? and emp_gender = ?</span><br><span class="line">[1106 17:33:45 520 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsIfLabel - ==&gt; Parameters: gdai(String), 24(Integer), 男(String)</span><br><span class="line">[1106 17:33:45 534 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsIfLabel - &lt;==      Total: 1</span><br><span class="line">[Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;]</span><br></pre></td></tr></table></figure>
<h3 id="2-where-标签"><a class="markdownIt-Anchor" href="#2-where-标签"></a> 2 <code>&lt;where&gt;</code> 标签</h3>
<h4 id="21-思路"><a class="markdownIt-Anchor" href="#21-思路"></a> 2.1 思路</h4>
<p>从上一节 <code>&lt;if&gt;</code> 标签中我们可以发现，在 <code>SQL</code> 语句中，<code>where</code> 是写死在 <code>SQL</code> 语句中的，无论是否有条件，<code>where</code> 子句都会执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span></span><br></pre></td></tr></table></figure>
<p>此时我们思考，能不能使 <code>where</code> 标签也动态生成呢？我们引入 <code>where</code> 标签。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;结果返回类型&quot;</span>&gt;</span></span><br><span class="line">        select * from table</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;param != null&quot;</span>&gt;</span></span><br><span class="line">                and table_字段 = #&#123;param&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;where&gt;</code> 和 <code>&lt;if&gt;</code> 一般<u><em><strong>结合使用</strong></em></u>：
<ul>
<li>若 <code>&lt;where&gt;</code> 标签中的 <code>&lt;if&gt;</code> 条件都<u><em><strong>不满足</strong></em></u>，则 <code>&lt;where&gt;</code> 标签没有任何功能，即不会添加 <code>where</code> 关键字</li>
<li>若 <code>&lt;where&gt;</code> 标签中的 <code>&lt;if&gt;</code> 条件<u><em><strong>满足</strong></em></u>，则 <code>&lt;where&gt;</code> 标签会自动<u><em><strong>添加 <code>where</code> 关键字</strong></em></u>，并将条件<u><em><strong>前方多余的<code>and/or</code>去掉</strong></em></u></li>
</ul>
</li>
</ul>
<p><u><em><strong>注意 ⚠️</strong></em></u>：<code>where</code> 标签不能去掉条件后多余的 <code>and/or</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这种用法是错误的，只能去掉条件前面的and/or，条件后面的不行--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;param != null&quot;</span>&gt;</span></span><br><span class="line">                table_字段 = #&#123;param&#125; and</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="22-操作"><a class="markdownIt-Anchor" href="#22-操作"></a> 2.2 操作</h4>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// &lt;where&gt;标签实现若干条件查询</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getEmpByConditionsWhereLabel</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getEmpByConditionsWhereLabel(Emp emp);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByConditionsWhereLabel&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_name = #&#123;empName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empAge != null and empAge != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_age = #&#123;empAge&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empGender != null and empGender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_gender = #&#123;empGender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empEmail != null and empEmail != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and emp_email = #&#123;empEmail&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByConditionsWhereLabel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    List&lt;Emp&gt; result = mapper.getEmpByConditionsWhereLabel(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;gdai&quot;</span>, <span class="number">24</span>, <span class="string">&quot;男&quot;</span>,<span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1106 18:07:08 215 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsWhereLabel - ==&gt;  Preparing: select * from t_emp WHERE emp_name = ? and emp_age = ? and emp_gender = ?</span><br><span class="line">[1106 18:07:08 228 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsWhereLabel - ==&gt; Parameters: gdai(String), 24(Integer), 男(String)</span><br><span class="line">[1106 18:07:08 245 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsWhereLabel - &lt;==      Total: 1</span><br><span class="line">[Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;]</span><br></pre></td></tr></table></figure>
<h3 id="3-trim-标签"><a class="markdownIt-Anchor" href="#3-trim-标签"></a> 3 <code>&lt;trim&gt;</code> 标签</h3>
<h4 id="31-思路"><a class="markdownIt-Anchor" href="#31-思路"></a> 3.1 思路</h4>
<p><code>&lt;trim&gt;</code> 标签是一个更通用的，用于<u><em><strong>添加或者去掉指定的字符</strong></em></u>的标签。可以将其视为 <code>&lt;where&gt;</code> 标签更泛化的标签。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;结果返回类型&quot;</span>&gt;</span></span><br><span class="line">    select * from table</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;param != null&quot;</span>&gt;</span></span><br><span class="line">            and table_字段 = #&#123;param&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>属性说明：</p>
<ul>
<li><code>prefix</code>（添加前缀）：<code>&lt;trim&gt;</code> 标签体中是整个字符串拼串后的结果，是<u><em><strong>给拼串后的整个字符串加一个前缀</strong></em></u>。</li>
<li><code>suffix</code>（添加后缀）：<code>suffix</code> 给<u><em><strong>拼串后的整个字符串加一个后缀</strong></em></u>。</li>
<li><code>prefixOverrides</code>（前缀覆盖）： 在 <code>&lt;trim&gt;</code> 标签中的内容的<u>前面去掉某些内容</u> （<u><em><strong>去掉前缀</strong></em></u>）</li>
<li><code>suffixOverrides</code>（后缀覆盖）： 在 <code>&lt;trim&gt;</code> 标签中的内容的<u>后面去掉某些内容</u> （<u><em><strong>去掉后缀</strong></em></u>）</li>
</ul>
<h4 id="32-操作"><a class="markdownIt-Anchor" href="#32-操作"></a> 3.2 操作</h4>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// &lt;trim&gt;标签实现若干条件查询</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getEmpByConditionsTrimLabel</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getEmpByConditionsTrimLabel(Emp emp);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByConditionsTrimLabel&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and|or&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and emp_name = #&#123;empName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empAge != null and empAge != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and emp_age = #&#123;empAge&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empGender != null and empGender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and emp_gender = #&#123;empGender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empEmail != null and empEmail != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and emp_email = #&#123;empEmail&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByConditionsTrimLabel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    List&lt;Emp&gt; result = mapper.getEmpByConditionsTrimLabel(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;gdai&quot;</span>, <span class="number">24</span>, <span class="string">&quot;男&quot;</span>,<span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1106 18:32:40 739 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsTrimLabel - ==&gt;  Preparing: select * from t_emp where emp_name = ? and emp_age = ? and emp_gender = ?</span><br><span class="line">[1106 18:32:40 760 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsTrimLabel - ==&gt; Parameters: gdai(String), 24(Integer), 男(String)</span><br><span class="line">[1106 18:32:40 776 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsTrimLabel - &lt;==      Total: 1</span><br><span class="line">[Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;]</span><br></pre></td></tr></table></figure>
<h3 id="4-choose-when-otherwise-标签"><a class="markdownIt-Anchor" href="#4-choose-when-otherwise-标签"></a> 4 <code>&lt;choose&gt;, &lt;when&gt;, &lt;otherwise&gt;</code> 标签</h3>
<h4 id="41-思路"><a class="markdownIt-Anchor" href="#41-思路"></a> 4.1 思路</h4>
<p><code>&lt;choose&gt;, &lt;when&gt;, &lt;otherwise&gt;</code> 标签<u><em><strong>逻辑上</strong></em></u>相当于 <code>switch...cases...default</code> 。</p>
<p>所以与 <code>&lt;if&gt;</code> 标签不同的是：</p>
<ul>
<li><code>&lt;choose&gt;, &lt;when&gt;, &lt;otherwise&gt;</code> 标签会按照 <code>&lt;when&gt;</code> 标签的顺序依次执行，只执行<u><em><strong>最先符合条件</strong></em></u>的 <code>&lt;when&gt;</code> 标签中的内容（<u><em><strong>只执行一个</strong></em></u>）
<ul>
<li>如果都不符合，则执行 <code>&lt;otherwise&gt;</code> 标签中的内容</li>
</ul>
</li>
<li><code>&lt;if&gt;</code> 标签中只要符合条件， <code>&lt;if&gt;</code> 标签中的内容就都执行（<u><em><strong>执行若干个</strong></em></u>）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;结果返回类型&quot;</span>&gt;</span></span><br><span class="line">    select * from table</span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;param1 != null&quot;</span>&gt;</span></span><br><span class="line">               table_字段 = #&#123;param1&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;param2 != null&quot;</span>&gt;</span></span><br><span class="line">               table_字段 = #&#123;param2&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">when</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">otherwise</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;when&gt;</code> 至少要有一个，<code>&lt;otherwise&gt;</code> 最多一个</li>
</ul>
<h4 id="42-操作"><a class="markdownIt-Anchor" href="#42-操作"></a> 4.2 操作</h4>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// &lt;choose&gt;标签实现单个符合条件查询</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">getEmpByConditionsChooseLabel</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; getEmpByConditionsChooseLabel(Emp emp);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByConditionsChooseLabel&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                   emp_name = #&#123;empName&#125;</span><br><span class="line">               <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empAge != null and empAge != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                   emp_age = #&#123;empAge&#125;</span><br><span class="line">               <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empGender != null and empGender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                   emp_gender = #&#123;empGender&#125;</span><br><span class="line">               <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empEmail != null and empEmail != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                   emp_email = #&#123;empEmail&#125;</span><br><span class="line">               <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                   1=1</span><br><span class="line">               <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByConditionsChooseLabel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    List&lt;Emp&gt; result = mapper.getEmpByConditionsChooseLabel(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;gdai&quot;</span>, <span class="number">24</span>, <span class="string">&quot;男&quot;</span>,<span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">    System.out.println(<span class="string">&quot;\n---------------------otherwise-------------------&quot;</span>);</span><br><span class="line">    List&lt;Emp&gt; result_otherwise = mapper.getEmpByConditionsChooseLabel(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">    <span class="keyword">for</span> (Emp e:result_otherwise) &#123;</span><br><span class="line">        System.out.println(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[1106 19:55:46 778 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - ==&gt;  Preparing: select * from t_emp WHERE emp_name = ?</span><br><span class="line">[1106 19:55:46 791 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - ==&gt; Parameters: gdai(String)</span><br><span class="line">[1106 19:55:46 808 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - &lt;==      Total: 1</span><br><span class="line">[Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;]</span><br><span class="line"></span><br><span class="line">---------------------otherwise-------------------</span><br><span class="line">[1106 19:55:46 809 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - ==&gt;  Preparing: select * from t_emp WHERE 1=1</span><br><span class="line">[1106 19:55:46 809 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - ==&gt; Parameters: </span><br><span class="line">[1106 19:55:46 811 DEBUG] [main] mapper.DynamicSQLMapper.getEmpByConditionsChooseLabel - &lt;==      Total: 6</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=3, empName=&#x27;enzo&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;enzo@enzo.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=4, empName=&#x27;theo&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;theo@theo.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=5, empName=&#x27;amina&#x27;, empAge=23, empGender=&#x27;女&#x27;, empEmail=&#x27;amina@amina.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=6, empName=&#x27;clement&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;clement@clement.com&#x27;, dept=null&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-foreach-标签"><a class="markdownIt-Anchor" href="#5-foreach-标签"></a> 5 <code>&lt;foreach&gt;</code> 标签</h3>
<h4 id="51-思路"><a class="markdownIt-Anchor" href="#51-思路"></a> 5.1 思路</h4>
<h5 id="批量搜索或删除"><a class="markdownIt-Anchor" href="#批量搜索或删除"></a> 批量搜索（或删除）</h5>
<p>在 <code>SQL</code> 中，我们经常使用 <code>where _column in(item1, item2, ...)</code> 子句来对集合 <code>[item1, item2, ...]</code> 内的元素进行操作，如下所示。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 批量删除</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> _table <span class="keyword">where</span> _column <span class="keyword">in</span> (item1, item2, ...);</span><br><span class="line"><span class="comment">-- 批量搜素</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> _table <span class="keyword">where</span> _column <span class="keyword">in</span> (item1, item2, ...);</span><br></pre></td></tr></table></figure>
<p>当 <code>XxxMapper</code> 接口中对应方法的<u><em><strong>传入参数是一个集合</strong></em></u>时（<code>List, Map</code>），可以使用 <code>&lt;foreach&gt;</code> 标签来<u><em><strong>遍历</strong></em></u>这个集合 <code>collection</code>，将每次遍历的元素 <code>item</code> 放入 <code>in()</code> 子句中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Object&gt; selectMethod(@Param(&quot;params&quot;) List&lt;T&gt; params);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;结果返回类型&quot;</span>&gt;</span></span><br><span class="line">        select * from table</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;集合类型参数params&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">open</span>=<span class="string">&quot;table_param in(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">                #&#123;item&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="批量添加"><a class="markdownIt-Anchor" href="#批量添加"></a> 批量添加</h5>
<p>对于 <code>SQL</code> 中的批量添加语句，形式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> _table <span class="keyword">values</span> (item1), (item2), ..., (itemn);</span><br></pre></td></tr></table></figure>
<p>当 <code>XxxMapper</code> 接口中对应方法的<u><em><strong>传入参数是一个集合</strong></em></u>时（<code>List, Map</code>），可以使用 <code>&lt;foreach&gt;</code> 标签来<u><em><strong>遍历</strong></em></u>这个集合 <code>collection</code>，将每次遍历的元素 <code>item</code> 放入 <code>values</code> 子句中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int insertMethod(@Param(&quot;params&quot;) List&lt;T&gt; params);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;方法名&quot;</span>&gt;</span></span><br><span class="line">        insert into _table values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;params&quot;</span> <span class="attr">item</span>=<span class="string">&quot;param&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;param._filed1&#125;, #&#123;param._filed2&#125;, ..., #&#123;param._filedn&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="52-操作"><a class="markdownIt-Anchor" href="#52-操作"></a> 5.2 操作</h4>
<h5 id="批量搜索或删除-2"><a class="markdownIt-Anchor" href="#批量搜索或删除-2"></a> 批量搜索（或删除）</h5>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 批量搜索</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">selectManyEmps</span><span class="params">(<span class="meta">@Param(&quot;empIds&quot;)</span> List&lt;Integer&gt; empIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Emp&gt; selectManyEmps(@Param(&quot;empIds&quot;) List&lt;Integer&gt; empIds);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectManyEmps&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_emp</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;empId&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">open</span>=<span class="string">&quot;emp_id in(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">                #&#123;empId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectManyEmps</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">1</span>);</span><br><span class="line">    list.add(<span class="number">2</span>);</span><br><span class="line">    list.add(<span class="number">3</span>);</span><br><span class="line">    List&lt;Emp&gt; resluts = mapper.selectManyEmps(list);</span><br><span class="line">    <span class="keyword">for</span> (Emp e:resluts) &#123;</span><br><span class="line">        System.out.println(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[1107 11:36:42 377 DEBUG] [main] mapper.DynamicSQLMapper.selectManyEmps - ==&gt;  Preparing: select * from t_emp WHERE emp_id in( ? , ? , ? )</span><br><span class="line">[1107 11:36:42 391 DEBUG] [main] mapper.DynamicSQLMapper.selectManyEmps - ==&gt; Parameters: 1(Integer), 2(Integer), 3(Integer)</span><br><span class="line">[1107 11:36:42 408 DEBUG] [main] mapper.DynamicSQLMapper.selectManyEmps - &lt;==      Total: 3</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=3, empName=&#x27;enzo&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;enzo@enzo.com&#x27;, dept=null&#125;</span><br></pre></td></tr></table></figure>
<h5 id="批量添加-2"><a class="markdownIt-Anchor" href="#批量添加-2"></a> 批量添加</h5>
<p><code>fr.gdai.mybatis.mapper.DynamicSQLMapper.java</code> 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fr.gdai.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fr.gdai.mybatis.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 批量添加</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertManyEmps</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span> List&lt;Emp&gt; emps)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fr/gdai/mybatis/mapper/DynamicSQLMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int insertManyEmps(@Param(&quot;emps&quot;) List&lt;Emp&gt; emps);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertManyEmps&quot;</span>&gt;</span></span><br><span class="line">        insert into t_emp values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (null, #&#123;emp.empName&#125;, #&#123;emp.empAge&#125;, #&#123;emp.empGender&#125;, #&#123;emp.empEmail&#125;, #&#123;emp.dept.deptId&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertManyEmps</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">dynamicSQLMapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    <span class="type">DeptMapper</span> <span class="variable">deptMapper</span> <span class="operator">=</span> sqlSession.getMapper(DeptMapper.class);</span><br><span class="line">    List&lt;Emp&gt; empList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    empList.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;calioppe&quot;</span>, <span class="number">22</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;calioppe@calioppe.com&quot;</span>,deptMapper.getDeptBtDeptId(<span class="number">1</span>)));</span><br><span class="line">    empList.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;david&quot;</span>, <span class="number">22</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;david@david.com&quot;</span>, deptMapper.getDeptBtDeptId(<span class="number">1</span>)));</span><br><span class="line">    empList.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;alex&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;alex@alex.com&quot;</span>,deptMapper.getDeptBtDeptId(<span class="number">2</span>)));</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> dynamicSQLMapper.insertManyEmps(empList);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>测试输出</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[1107 11:38:42 300 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - ==&gt;  Preparing: select * from t_dept where dept_id = ?</span><br><span class="line">[1107 11:38:42 314 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - ==&gt; Parameters: 1(Integer)</span><br><span class="line">[1107 11:38:42 330 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - &lt;==      Total: 1</span><br><span class="line">[1107 11:38:42 332 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - ==&gt;  Preparing: select * from t_dept where dept_id = ?</span><br><span class="line">[1107 11:38:42 332 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - ==&gt; Parameters: 2(Integer)</span><br><span class="line">[1107 11:38:42 332 DEBUG] [main] mapper.DeptMapper.getDeptBtDeptId - &lt;==      Total: 1</span><br><span class="line">[1107 11:38:42 340 DEBUG] [main] mapper.DynamicSQLMapper.insertManyEmps - ==&gt;  Preparing: insert into t_emp values (null, ?, ?, ?, ?, ?) , (null, ?, ?, ?, ?, ?) , (null, ?, ?, ?, ?, ?)</span><br><span class="line">[1107 11:38:42 341 DEBUG] [main] mapper.DynamicSQLMapper.insertManyEmps - ==&gt; Parameters: calioppe(String), 22(Integer), 女(String), calioppe@calioppe.com(String), 1(Integer), david(String), 22(Integer), 男(String), david@david.com(String), 1(Integer), alex(String), 23(Integer), 男(String), alex@alex.com(String), 2(Integer)</span><br><span class="line">[1107 11:38:42 344 DEBUG] [main] mapper.DynamicSQLMapper.insertManyEmps - &lt;==    Updates: 3</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<h3 id="6-sql-与-include-标签"><a class="markdownIt-Anchor" href="#6-sql-与-include-标签"></a> 6 <code>&lt;sql&gt;</code> 与 <code>&lt;include&gt;</code> 标签</h3>
<p><code>&lt;sql&gt;</code> 标签记录一段<u><em><strong>公共</strong></em></u> <code>SQL</code> <strong><u><em>片段</em></u></strong>，在使用的地方<u><em><strong>通过 <code>&lt;include&gt;</code> 标签进行引入</strong></em></u></p>
<ul>
<li>声明 <code>SQL</code> 片段：<code>&lt;sql&gt;</code> 标签</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;aliasDept&quot;</span>&gt;</span></span><br><span class="line">    dept_id as deptId, dept_name as deptName</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>引用 <code>SQL</code> 片段：<code>&lt;include&gt;</code> 标签</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    List&lt;Dept&gt; getAllDept();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllDept&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;aliasDept&quot;</span>/&gt;</span> from t_dept</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllDept</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">dynamicSQLMapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">    List&lt;Dept&gt; results = dynamicSQLMapper.getAllDept();</span><br><span class="line">    <span class="keyword">for</span> (Dept d:results) &#123;</span><br><span class="line">        System.out.println(d.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[1107 12:57:37 445 DEBUG] [main] mapper.DynamicSQLMapper.getAllDept - ==&gt;  Preparing: select dept_id as deptId, dept_name as deptName from t_dept</span><br><span class="line">[1107 12:57:37 464 DEBUG] [main] mapper.DynamicSQLMapper.getAllDept - ==&gt; Parameters: </span><br><span class="line">[1107 12:57:37 478 DEBUG] [main] mapper.DynamicSQLMapper.getAllDept - &lt;==      Total: 3</span><br><span class="line">Dept&#123;deptId=1, deptName=&#x27;enseeiht&#x27;, emps=null&#125;</span><br><span class="line">Dept&#123;deptId=2, deptName=&#x27;tbs&#x27;, emps=null&#125;</span><br><span class="line">Dept&#123;deptId=3, deptName=&#x27;tgu&#x27;, emps=null&#125;</span><br></pre></td></tr></table></figure>
<h2 id="六-mybatis-中的分页"><a class="markdownIt-Anchor" href="#六-mybatis-中的分页"></a> 六、MyBatis 中的分页</h2>
<blockquote>
<p>举一个简单的例子，我们在将后台查询到的数据展示到前端页面时，如果记录过多，就需要一个如下所示的导航栏来将记录分页展示。</p>
<table align="center">
  <tr>
    <td align="center"> <a herf>首页</a> </td>
     <td align="center"> <a herf>上一页</a> </td>
     <td align="center"> <a herf>1</a> </td>
     <td align="center"> <a herf>2</a> </td>
     <td align="center"> 3</td>
     <td align="center"> <a herf>4</a> </td>
     <td align="center"> <a herf>5</a> </td>
     <td align="center">
       <form name="pages">
         跳转至: <input type="text" name="page" value placeholder="输入页数">页
         <input type="button" value="跳转">
       </form>
     </td>
     <td align="center"> <a herf>下一页</a> </td>
     <td align="center"> <a herf>末页</a> </td>
  </tr>
</table>
</blockquote>
<h3 id="1-sql-语句中的分页"><a class="markdownIt-Anchor" href="#1-sql-语句中的分页"></a> 1 <code>SQL</code> 语句中的分页</h3>
<p><a href="https://dave0126.github.io/2022/09/25/MySQL-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/#LIMIT-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2">点击跳转至 <code>MySQL</code> :  <code>LIMIT</code> 分页查询</a></p>
<h3 id="2-分页插件"><a class="markdownIt-Anchor" href="#2-分页插件"></a> 2 分页插件</h3>
<h4 id="21-添加依赖"><a class="markdownIt-Anchor" href="#21-添加依赖"></a> 2.1 添加依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="22-配置分页插件"><a class="markdownIt-Anchor" href="#22-配置分页插件"></a> 2.2 配置分页插件</h4>
<p>在 MyBatis 的核心设置 <code>mybatis-config.xml</code> 中设置分页插件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置分页插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="23-使用分页插件功能"><a class="markdownIt-Anchor" href="#23-使用分页插件功能"></a> 2.3 使用分页插件功能</h4>
<h5 id="获取简单的分页信息"><a class="markdownIt-Anchor" href="#获取简单的分页信息"></a> 获取简单的分页信息</h5>
<p>在查询功能之前使用 <code>PageHelper.startPage(int pageNum, int pageSize)</code> 开启分页功能，其中</p>
<ul>
<li><code>pageNum</code>：当前页的页码</li>
<li><code>pageSize</code>：每页显示的条数</li>
</ul>
<p>我们可以使用一个 <code>Page&lt;Object&gt; page</code> 对象来接收<u><em><strong>分页的简单结果</strong></em></u>（<u><em><strong>当前页的页码</strong></em></u>  <code>pageNum</code>，每页显示的记录数 <code>pageSize</code>，从第几行记录开始  <code>startRow</code>，到第几行记录结束 <code>endRow</code>，<u><em><strong>总记录数</strong></em></u> <code>total</code>，<u><em><strong>总页数</strong></em></u> <code>page</code>）即：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在查询功能之前，开启分页功能</span></span><br><span class="line">Page&lt;Object&gt; page = PageHelper.startPage(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize);</span><br><span class="line">List&lt;T&gt; results = mapper.selectAll();</span><br></pre></td></tr></table></figure>
<h6 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllEmpsInPageHelper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">empMapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line">    <span class="comment">// 在查询功能之前，开启分页功能，page获取简单分页信息</span></span><br><span class="line">    Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    List&lt;Emp&gt; result = empMapper.getAllEmp();</span><br><span class="line">    <span class="keyword">for</span> (Emp e:result) &#123;</span><br><span class="line">        System.out.println(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(</span><br><span class="line">            <span class="string">&quot;每页显示&quot;</span> + page.getPageSize() + <span class="string">&quot;条记录&quot;</span> + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;当前页数：&quot;</span> + page.getPageNum() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;共&quot;</span> + page.getPages() + <span class="string">&quot;页，&quot;</span> + page.getTotal() + <span class="string">&quot;条数据\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">每页显示2条记录	当前页数：1	共6页，12条数据</span><br></pre></td></tr></table></figure>
<h5 id="获取更多的分页信息"><a class="markdownIt-Anchor" href="#获取更多的分页信息"></a> 获取更多的分页信息</h5>
<p>如果 <code>Page&lt;Object&gt; page</code> 对象获取的简单结果并不能满足我们的需要，我们可以通过 <code>PageInfo&lt;T&gt; pageInfo</code> 对象来获取更详细的信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在查询功能之前，开启分页功能</span></span><br><span class="line">PageHelper.startPage(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize);</span><br><span class="line">List&lt;T&gt; results = mapper.selectAll();</span><br><span class="line"><span class="comment">// 在查询功能之后，获取分页的详细</span></span><br><span class="line">PageInfo&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(results, navigatePages);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li>
<p><code>results</code>：是<u>***分页查询之后的数据（记录）***</u></p>
</li>
<li>
<p><code>navigatePages</code>：导航分页的<u><em><strong>页面个数</strong></em></u>，即在如下所示的导航栏中，页面 “<code>1, 2, 3, 4, 5</code>” 的显示个数。通常为<u><em><strong>奇数</strong></em></u>。</p>
<ul>
<li>
<p><code>navigatePages = 5</code>：</p>
<table align="center">
  <tr>
    <td align="center"> <a herf>首页</a> </td>
     <td align="center"> <a herf>上一页</a> </td>
     <td align="center"> 1 </td>
     <td align="center"> <a herf>2</a> </td>
     <td align="center"> <a herf>3</a></td>
     <td align="center"> <a herf>4</a> </td>
     <td align="center"> <a herf>5</a> </td>
     <td align="center">
       <form name="pages">
         跳转至: <input type="text" name="page" value placeholder="输入页数">页
         <input type="button" value="跳转">
       </form>
     </td>
     <td align="center"> <a herf>下一页</a> </td>
     <td align="center"> <a herf>末页</a> </td>
  </tr>
</table>
</li>
<li>
<p><code>navigatePages = 3</code>：</p>
<table align="center">
  <tr>
    <td align="center"> <a herf>首页</a> </td>
     <td align="center"> <a herf>上一页</a> </td>
     <td align="center"> 1 </td>
     <td align="center"> <a herf>2</a> </td>
     <td align="center"> <a herf>3</a> </td>
     <td align="center">
       <form name="pages">
         跳转至: <input type="text" name="page" value placeholder="输入页数">页
         <input type="button" value="跳转">
       </form>
     </td>
     <td align="center"> <a herf>下一页</a> </td>
     <td align="center"> <a herf>末页</a> </td>
  </tr>
</table>
</li>
</ul>
</li>
</ul>
<p>我们通过 <code>PageInfo&lt;T&gt; pageInfo</code> 对象来获取的详细信息如下：</p>
<ul>
<li><code>int pageNum</code>：当前页的页码</li>
<li><code>int pageSize</code>：每页显示的记录数</li>
<li><code>int size</code>：当前页显示的<u><em><strong>真实记录数</strong></em></u></li>
<li><code>int total</code>：总记录数</li>
<li><code>int pages</code>：总页数</li>
<li><code>int prePage</code>：上一页的页码</li>
<li><code>int nextPage</code>：下一页的页码</li>
<li><code>boolean isFirstPage</code> / <code>isLastPage</code>：是否为第一页 / 最后一页</li>
<li><code>boolean hasPreviousPage</code> / <code>hasNextPage</code>：是否存在上一页 / 下一页</li>
<li><code>int navigatePages</code>：导航分页的页码数</li>
<li><code>int[] navigatepageNums</code>：导航分页的页码，<code>[1,2,3,4,5]</code></li>
</ul>
<h6 id="测试-2"><a class="markdownIt-Anchor" href="#测试-2"></a> 测试</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAllEmpsInPageHelperPageInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">empMapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line">    <span class="comment">// 在查询功能之前，开启分页功能</span></span><br><span class="line">    PageHelper.startPage(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line">    List&lt;Emp&gt; result = empMapper.getAllEmp();</span><br><span class="line">    <span class="comment">// 在查询功能之后，pageInfo获取分页的详细信息</span></span><br><span class="line">    <span class="keyword">for</span> (Emp e:result) &#123;</span><br><span class="line">        System.out.println(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(</span><br><span class="line">            <span class="string">&quot;本页记录数：&quot;</span> + pageInfo.getSize() +<span class="string">&quot;/&quot;</span>+ pageInfo.getPageSize() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;共&quot;</span> + pageInfo.getPages() + <span class="string">&quot;页，&quot;</span> + pageInfo.getTotal() + <span class="string">&quot;条数据\n&quot;</span></span><br><span class="line">            + <span class="string">&quot;当前页数：&quot;</span> + pageInfo.getPageNum() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;是否有上一页：&quot;</span> + pageInfo.isHasPreviousPage() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;是否有下一页：&quot;</span> + pageInfo.isHasNextPage() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">            + <span class="string">&quot;导航分页的页码：&quot;</span> + Arrays.toString(pageInfo.getNavigatepageNums()) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Emp&#123;empId=9, empName=&#x27;alex&#x27;, empAge=23, empGender=&#x27;男&#x27;, empEmail=&#x27;alex@alex.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=14, empName=&#x27;calioppe&#x27;, empAge=22, empGender=&#x27;女&#x27;, empEmail=&#x27;calioppe@calioppe.com&#x27;, dept=null&#125;</span><br><span class="line">本页记录数：2/2	共6页，12条数据</span><br><span class="line">当前页数：5	是否有上一页：true	是否有下一页：true	导航分页的页码：[2, 3, 4, 5, 6]	</span><br></pre></td></tr></table></figure>
<h2 id="七-mybatis-的缓存机制"><a class="markdownIt-Anchor" href="#七-mybatis-的缓存机制"></a> 七、MyBatis 的缓存机制</h2>
<p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#cache">官方文档：缓存</a></p>
<h3 id="1-一级缓存"><a class="markdownIt-Anchor" href="#1-一级缓存"></a> 1 一级缓存</h3>
<p><u><em><strong>一级缓存</strong></em></u>是 <code>SqlSession</code> <u><em><strong>级别</strong></em></u>的，通过同一个 <code>SqlSession</code> 查询的数据会被缓存，下次<u><em><strong>查询相同的数据</strong></em></u>，就会从缓存中直接获取，不会从数据库重新访问。</p>
<h4 id="开启缓存"><a class="markdownIt-Anchor" href="#开启缓存"></a> 开启缓存</h4>
<p><code>MyBatis</code> <u><em><strong>默认开启</strong></em></u>一级缓存（本地缓存）。</p>
<h4 id="缓存失效的情况"><a class="markdownIt-Anchor" href="#缓存失效的情况"></a> 缓存失效的情况</h4>
<ol>
<li><u><em><strong>不同的</strong></em></u> <code>SqlSession</code> 对应不同的一级缓存</li>
<li>同一个 <code>SqlSession</code> 但是<u><em><strong>查询条件不同</strong></em></u></li>
<li>同一个 <code>SqlSession</code> 两次查询期间<u><em><strong>执行了任何一次增删改操作</strong></em></u></li>
<li>同一个 <code>SqlSession</code> 两次查询期间<u><em><strong>手动清空了缓存</strong></em></u></li>
</ol>
<h3 id="2-二级缓存"><a class="markdownIt-Anchor" href="#2-二级缓存"></a> 2 二级缓存</h3>
<p><u><em><strong>二级缓存</strong></em></u>是 <code>SqlSessionFactory</code> <u><em><strong>级别</strong></em></u>，通过同一个 <code>SqlSessionFactory</code> 创建的 <code>SqlSession</code> 查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取。</p>
<h4 id="开启缓存-2"><a class="markdownIt-Anchor" href="#开启缓存-2"></a> 开启缓存</h4>
<p>要启用全局的二级缓存，只需要检查核心配置文件 <code>mybatis-config.xml</code> 中，与缓存有关的设置 <code>cacheEnabled=&quot;true&quot;</code>，<u><em><strong>默认</strong></em></u>为 <code>true</code>。然后在你的 <code>XxxMapper.xml</code> 映射文件中添加一行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个简单语句的效果如下:</p>
<ul>
<li>映射文件中的<u><em><strong>所有 <code>select</code> 语句</strong></em></u>的结果将会<u><em><strong>被缓存</strong></em></u>。</li>
<li>映射语句文件中的<u><em><strong>所有 <code>insert</code>、<code>update</code> 和 <code>delete</code> 语句</strong></em></u>会<u><em><strong>刷新缓存</strong></em></u>。</li>
<li>缓存会使用最近最少使用算法（<code>LRU, Least Recently Used</code>）算法来清除不需要的缓存。</li>
<li>缓存<u><em><strong>不会定时进行刷新</strong></em></u>（也就是说，没有刷新间隔）。</li>
<li>缓存会<u><em><strong>保存列表或对象</strong></em></u>（无论查询方法返回哪种）的 <u><em><strong>1024 个引用</strong></em></u>。</li>
<li>缓存会被视为 <code>读/写缓存</code>，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li>
</ul>
<p>这些属性可以通过 <code>&lt;cache&gt;</code> 元素的属性来修改。比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span></span></span><br><span class="line"><span class="tag">  <span class="attr">eviction</span>=<span class="string">&quot;LRU&quot;</span> | &quot;<span class="attr">FIFO</span>&quot; | &quot;<span class="attr">SOFT</span>&quot; | &quot;<span class="attr">WEAK</span>&quot;</span></span><br><span class="line"><span class="tag">  <span class="attr">flushInterval</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span> | &quot;<span class="attr">false</span>&quot;</span></span><br><span class="line"><span class="tag"> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面我们对这些元素属性逐一介绍：</p>
<ol>
<li><code>eviction</code>（清除策略）：
<ul>
<li><code>LRU</code> – 最近最少使用（默认）：移除最长时间不被使用的对象。</li>
<li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li>
<li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li>
</ul>
</li>
<li><code>flushInterval</code>（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以<u><em><strong>毫秒为单位</strong></em></u>的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</li>
<li><code>size</code>（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。<u><em><strong>默认值是 1024</strong></em></u>。</li>
<li><code>readOnly</code>（只读）属性可以被设置为 <code>true</code> 或 <code>false</code>。
<ul>
<li>只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。</li>
<li>可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 <code>false</code>。</li>
</ul>
</li>
</ol>
<h3 id="3-一二级缓存查询的顺序"><a class="markdownIt-Anchor" href="#3-一二级缓存查询的顺序"></a> 3 一二级缓存查询的顺序</h3>
<ol>
<li><u><em><strong>先查询二级缓存</strong></em></u>，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用；</li>
<li>如果二级缓存没有命中，<u><em><strong>再查询一级缓存</strong></em></u>；</li>
<li>如果一级缓存也没有命中，则<u><em><strong>查询数据库</strong></em></u>。</li>
</ol>
<p>当一级缓存的 <code>SqlSession</code> <u><em><strong>关闭</strong></em></u>之后，一级缓存中的数据会<u><em><strong>写入二级缓存</strong></em></u>。</p>
<h2 id="八-mybatis-与-spring-框架整合"><a class="markdownIt-Anchor" href="#八-mybatis-与-spring-框架整合"></a> 八、MyBatis 与 Spring 框架整合</h2>
<p>首先，Spring 本质上就是一个管理对象的容器，而 MyBatis 可是看作是一个操作数据库的一系列对象。我们也可以将 MyBatis 的对象<u><em><strong>在 Spring 中注册</strong></em></u>，<u><em><strong>交由 Spring 来管理</strong></em></u>，使用时<u><em><strong>从 Spring 容器中获取</strong></em></u>。</p>
<p>所以在 MyBatis 中，哪些对象应该交给 Spring 管理呢？我们现在看一组 MyBatis 的测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMyBatis</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 加载核心配置文件</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;myBatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取SqlSessionFactoryBuilder</span></span><br><span class="line">    <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">ssfb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">    <span class="comment">// 获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> ssfb.build(is);</span><br><span class="line">    <span class="comment">// 获取SqlSession, true为开启自动提交事务</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 获取Mapper接口对象</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 测试</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insertUser();</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中我们发现，<code>SqlSessionFactory</code> 对象通过 <code>myBatis-config.xml</code> 配置文件创建，从而创建 <code>SqlSession</code> 对象，进而<u><em><strong>通过 <code>Mapper</code> 接口动态代理生成的实现类</strong></em></u>。</p>
<p>我们分析一下之前学习的 MyBatis 核心配置 <code>myBatis-config.xml</code> 中都有哪些基本设置，从而更好的了解需要 Spring 管理的部分：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;properties文件名&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- --------------- 设置 DataSource --------------- --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- --------------- Mapper接口映射 --------------- --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要引入的映射文件所在包的名字，如&lt;fr.gdai.mybatis.mapper&gt;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>所以在 Spring 整合 MyBatis 中，我们需要：</p>
<ol>
<li><u><em><strong>数据源 <code>DataSource</code> 对象</strong></em></u></li>
<li><u><em><strong>依托数据源创建的 <code>SqlSessionFactory</code> 对象</strong></em></u>（Spring 中提供了 <code>SqlSessionFactoryBean</code>）</li>
</ol>
<h3 id="1-操作流程"><a class="markdownIt-Anchor" href="#1-操作流程"></a> 1. 操作流程</h3>
<h4 id="11-添加依赖包"><a class="markdownIt-Anchor" href="#11-添加依赖包"></a> 1.1 添加依赖包</h4>
<p>首先，我们在 <code>maven</code> 的 <code>pom.xml</code> 文件中添加依赖（主要）：</p>
<ol>
<li><code>Spring</code> 的依赖 <code>spring-context</code></li>
<li><code>MySQL</code> 的驱动依赖 <code>mysql-connector-java</code></li>
<li><code>MyBatis</code> 的依赖 <code>mybatis</code></li>
<li><code>Spring</code> 整合 <code>MyBatis</code> 的工具类 <code>mybatis-spring</code></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ****** 测试相关 ******** --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ******* mysql连接 ******** --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ****** MyBatis相关 ******** --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ****** Spring核心 ******** --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ****** 数据库连接池 ******** --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="12-准备数据源-datasource"><a class="markdownIt-Anchor" href="#12-准备数据源-datasource"></a> 1.2 准备数据源 <code>DataSource</code></h4>
<p>这里我们使用 <code>c3p0</code> 连接池获取数据源。</p>
<p><code>jdbc.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>
<h5 id="注解形式"><a class="markdownIt-Anchor" href="#注解形式"></a> 注解形式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">getDataSource</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setDriverClass(driver);</span><br><span class="line">        dataSource.setJdbcUrl(url);</span><br><span class="line">        dataSource.setUser(userName);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置文件形式"><a class="markdownIt-Anchor" href="#配置文件形式"></a> 配置文件形式</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:c3p0.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="13-获取-sqlsessionfactory-对象"><a class="markdownIt-Anchor" href="#13-获取-sqlsessionfactory-对象"></a> 1.3 获取 <code>SqlSessionFactory</code> 对象</h4>
<h5 id="注解形式-2"><a class="markdownIt-Anchor" href="#注解形式-2"></a> 注解形式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">      <span class="comment">// 设置使用别名的包</span></span><br><span class="line">        sqlSessionFactoryBean.setTypeAliasesPackage(<span class="string">&quot;fr.gdai.mybatis.pojo&quot;</span>);</span><br><span class="line">      <span class="comment">// 为SqlSessionFactory 设置数据源</span></span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置文件形式-2"><a class="markdownIt-Anchor" href="#配置文件形式-2"></a> 配置文件形式</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置别名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;fr.gdai.mybatis.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="14-配置-mapper-映射接口"><a class="markdownIt-Anchor" href="#14-配置-mapper-映射接口"></a> 1.4 配置 <code>Mapper</code> 映射接口</h4>
<p>此时我们发现，我们并没有设置 <code>Mapper</code> 映射，即</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- --------------- Mapper接口映射 --------------- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;需要引入的映射文件所在包的名字，如&lt;fr.gdai.mybatis.mapper&gt;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当<u><em><strong>以包为单位</strong></em></u>，自动扫描包下所有的映射文件时<u><em><strong>需要保证</strong></em></u>：</p>
<ol>
<li><code>mapper</code> 接口和 <code>mapper</code> 映射文件<u><em><strong>必须在相同的包下</strong></em></u></li>
<li><code>mapper</code> 接口要和 <code>mapper</code> 映射文件的<u><em><strong>名字一致</strong></em></u></li>
</ol>
<p>在 Spring 整合 MyBatis 框架中，我们需要通过 <code>MapperScannerConfigurer</code> 来设置。当 Spring 容器启动时，如果容器内<u><em><strong>存在</strong></em></u> <code>MapperScannerConfigurer</code> 对象，则<u><em><strong>会自动开启包扫描</strong></em></u>，<u><em><strong>生成 <code>Mapper</code> 代理对象</strong></em></u>，从而可以<u><em><strong>直接从容器内获得 <code>Mapper</code> 代理对象</strong></em></u>。</p>
<h5 id="注解形式-3"><a class="markdownIt-Anchor" href="#注解形式-3"></a> 注解形式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">mapperScannerConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MapperScannerConfigurer</span> <span class="variable">mapperScannerConfigurer</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">      <span class="comment">// 设置自动扫描的包</span></span><br><span class="line">        mapperScannerConfigurer.setBasePackage(<span class="string">&quot;fr.gdai.mybatis.mapper&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mapperScannerConfigurer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者直接在 <code>XxxConfig</code> 设置类前设置<u>***注解 <code>@MapperScanner()</code>***</u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;fr.gdai.mybatis.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置文件形式-3"><a class="markdownIt-Anchor" href="#配置文件形式-3"></a> 配置文件形式</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;MapperScannerConfigurer&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置自动扫描的包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;fr.gdai.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="15-测试"><a class="markdownIt-Anchor" href="#15-测试"></a> 1.5 测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAllEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">EmpMapper</span> <span class="variable">empMapper</span> <span class="operator">=</span> ctx.getBean(EmpMapper.class);</span><br><span class="line">        List&lt;Emp&gt; empList = empMapper.getAllEmp();</span><br><span class="line">        <span class="keyword">for</span> (Emp e:empList) &#123;</span><br><span class="line">            System.out.println(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[1108 19:47:32 231 DEBUG] [main] v2.resourcepool.BasicResourcePool - trace com.mchange.v2.resourcepool.BasicResourcePool@41f69e84 [managed: 3, unused: 2, excluded: 0] (e.g. com.mchange.v2.c3p0.impl.NewPooledConnection@46c570bb)</span><br><span class="line">[1108 19:47:32 232 DEBUG] [main] spring.transaction.SpringManagedTransaction - JDBC Connection [com.mchange.v2.c3p0.impl.NewProxyConnection@5167f57d [wrapping: com.mysql.cj.jdbc.ConnectionImpl@64b0598]] will not be managed by Spring</span><br><span class="line">[1108 19:47:32 234 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt;  Preparing: select * from t_emp</span><br><span class="line">[1108 19:47:32 247 DEBUG] [main] mapper.EmpMapper.getAllEmp - ==&gt; Parameters: </span><br><span class="line">[1108 19:47:32 268 DEBUG] [main] mapper.EmpMapper.getAllEmp - &lt;==      Total: 12</span><br><span class="line">[1108 19:47:32 270 DEBUG] [main] mybatis.spring.SqlSessionUtils - Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@29d80d2b]</span><br><span class="line">[1108 19:47:32 270 DEBUG] [main] jdbc.datasource.DataSourceUtils - Returning JDBC Connection to DataSource</span><br><span class="line">[1108 19:47:32 270 DEBUG] [main] v2.async.ThreadPoolAsynchronousRunner - com.mchange.v2.async.ThreadPoolAsynchronousRunner@7068e664: Adding task to queue -- com.mchange.v2.resourcepool.BasicResourcePool$1RefurbishCheckinResourceTask@3336e6b6</span><br><span class="line">[1108 19:47:32 270 DEBUG] [main] v2.resourcepool.BasicResourcePool - trace com.mchange.v2.resourcepool.BasicResourcePool@41f69e84 [managed: 3, unused: 2, excluded: 0] (e.g. com.mchange.v2.c3p0.impl.NewPooledConnection@46c570bb)</span><br><span class="line">Emp&#123;empId=1, empName=&#x27;gdai&#x27;, empAge=24, empGender=&#x27;男&#x27;, empEmail=&#x27;gdai@gdai.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=2, empName=&#x27;tom&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;tom@tom.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=3, empName=&#x27;enzo&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;enzo@enzo.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=4, empName=&#x27;theo&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;theo@theo.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=5, empName=&#x27;amina&#x27;, empAge=23, empGender=&#x27;女&#x27;, empEmail=&#x27;amina@amina.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=6, empName=&#x27;clement&#x27;, empAge=21, empGender=&#x27;男&#x27;, empEmail=&#x27;clement@clement.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=7, empName=&#x27;calioppe&#x27;, empAge=22, empGender=&#x27;女&#x27;, empEmail=&#x27;calioppe@calioppe.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=8, empName=&#x27;david&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;david@david.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=9, empName=&#x27;alex&#x27;, empAge=23, empGender=&#x27;男&#x27;, empEmail=&#x27;alex@alex.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=14, empName=&#x27;calioppe&#x27;, empAge=22, empGender=&#x27;女&#x27;, empEmail=&#x27;calioppe@calioppe.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=15, empName=&#x27;david&#x27;, empAge=22, empGender=&#x27;男&#x27;, empEmail=&#x27;david@david.com&#x27;, dept=null&#125;</span><br><span class="line">Emp&#123;empId=16, empName=&#x27;alex&#x27;, empAge=23, empGender=&#x27;男&#x27;, empEmail=&#x27;alex@alex.com&#x27;, dept=null&#125;</span><br></pre></td></tr></table></figure>
<p>至此，MyBatis 的对象已经完全的交由 Spring 容器来管理了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://dave0126.github.io">Guohao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dave0126.github.io/2022/10/28/MyBatis/">https://dave0126.github.io/2022/10/28/MyBatis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dave0126.github.io" target="_blank">Lost N Found</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a></div><div class="post_share"><div class="social-share" data-image="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2022/09/25/MySQL-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL 相关笔记</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Guohao</div><div class="author-info__description">L’existence précède l‘essence</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Dave0126" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dave980126@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%B6-mybatis%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-text"> 零、MyBatis简单介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%8C%81%E4%B9%85%E5%8C%96%E5%B1%82%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text"> 与其他持久化层技术的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E6%90%AD%E5%BB%BA-mybatis-%E7%8E%AF%E5%A2%83"><span class="toc-text"> 一、搭建 MyBatis 环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text"> 1. 开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-maven-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text"> 2. 使用 Maven 构建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text"> 3. 创建实体类与数据库表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text"> (1) 创建实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-text"> (2) 根据实体类创建数据库表结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-mybatis-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 4. 创建 MyBatis 核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E5%B9%B6%E4%BD%BF%E7%94%A8-log4j-%E6%97%A5%E5%BF%97"><span class="toc-text"> 5. 配置并使用 log4j 日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0-maven-%E4%BE%9D%E8%B5%96"><span class="toc-text"> (1) 添加 maven 依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-log4j-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> (2) 配置 log4j 的配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA-mapper-%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 6. 创建 mapper 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%9B%E5%BB%BA-mapper-%E6%8E%A5%E5%8F%A3%E7%9A%84-xml-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-text"> 7. 创建 mapper 接口的 .xml 映射文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-text"> (1) 对象关系映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-xml-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-text"> (2) .xml 映射文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E5%B9%B6%E6%B5%8B%E8%AF%95"><span class="toc-text"> 8. 与数据库建立连接并测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5sqlsessionutils"><span class="toc-text"> (1) 与数据库建立连接：SqlSessionUtils</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5"><span class="toc-text"> (2) 测试连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text"> 二、核心配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-%E6%A0%87%E7%AD%BE%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-text"> 0 标签的顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-properties-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 1 &lt;properties&gt; 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-settings-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 2 &lt;settings&gt; 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-typealiases-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 3 &lt;typeAliases&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mybatis-%E4%B8%AD%E9%BB%98%E8%AE%A4%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-text"> MyBatis 中默认的别名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-environments-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 9 &lt;environments&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#91-environments"><span class="toc-text"> 9.1 &lt;environments&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#92-environment"><span class="toc-text"> 9.2 &lt;environment&gt;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-mappers-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 11 &lt;mappers&gt; 标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-mybatis-%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text"> 三、MyBatis 中的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 0 简单查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#01-%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1"><span class="toc-text"> 0.1 查询返回一个实体类对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#02-%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%93%E7%B1%BB%E9%9B%86%E5%90%88"><span class="toc-text"> 0.2 查询返回实体类集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%87%8D%E7%82%B9"><span class="toc-text"> 1 获取参数值的两种方式（重点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8D%95%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text"> 2 单个字面量类型的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%9A%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text"> 3 多个字面量类型的参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#31-mybatis-%E9%BB%98%E8%AE%A4%E6%8F%90%E4%BE%9B%E7%9A%84-map-%E9%9B%86%E5%90%88"><span class="toc-text"> 3.1 MyBatis 默认提供的 Map 集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA-map-%E9%9B%86%E5%90%88"><span class="toc-text"> 3.2 手动创建 Map 集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text"> 4 实体类类型的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8-param-%E6%A0%87%E8%AF%86%E5%8F%82%E6%95%B0"><span class="toc-text"> 5 使用 @Param 标识参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-mybatis-%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-text"> 6 MyBatis 的增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-%E6%B7%BB%E5%8A%A0"><span class="toc-text"> 6.1 添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-%E5%88%A0%E9%99%A4"><span class="toc-text"> 6.2 删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-%E4%BF%AE%E6%94%B9"><span class="toc-text"> 6.3 修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E7%89%B9%E6%AE%8Asql%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="toc-text"> 7. 特殊SQL的执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#71-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 7.1 模糊查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#72-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-text"> 7.2 批量删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#73-%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%90%8D"><span class="toc-text"> 7.3 动态设置表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#74-%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E7%9A%84%E4%B8%BB%E9%94%AE"><span class="toc-text"> 7.4 添加功能获取自增的主键</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84-resultmap"><span class="toc-text"> 四、自定义映射 resultMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8E%E5%B1%9E%E6%80%A7%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-text"> 1 字段名与属性名不一致</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E4%B8%BAsql%E5%AD%97%E6%AE%B5%E8%AE%BE%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc-text"> 1.1 为（SQL）字段设置别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1.2 修改全局配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-resultmap-results-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"><span class="toc-text"> 1.3 resultMap (@Results) 自定义映射关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-text"> 2 多对一关系映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21-%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E8%B5%8B%E5%80%BC"><span class="toc-text"> 2.1 级联属性赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-association-one-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 2.2 &lt;association&gt; (@One) 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 2.3 分步查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E6%83%B3"><span class="toc-text"> 思想</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-text"> 操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-text"> 优点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-text"> 3 一对多关系映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#31-collection-many-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 3.1 &lt;collection&gt; (@Many) 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 3.2 分步查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E6%83%B3-2"><span class="toc-text"> 思想</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C-2"><span class="toc-text"> 操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-2"><span class="toc-text"> 优点</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E5%8A%A8%E6%80%81-sql"><span class="toc-text"> 五、动态 SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-if-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 1 &lt;if&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E6%80%9D%E8%B7%AF"><span class="toc-text"> 1.1 思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%E6%93%8D%E4%BD%9C"><span class="toc-text"> 1.2 操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-where-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 2 &lt;where&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21-%E6%80%9D%E8%B7%AF"><span class="toc-text"> 2.1 思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-%E6%93%8D%E4%BD%9C"><span class="toc-text"> 2.2 操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-trim-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 3 &lt;trim&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#31-%E6%80%9D%E8%B7%AF"><span class="toc-text"> 3.1 思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-%E6%93%8D%E4%BD%9C"><span class="toc-text"> 3.2 操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-choose-when-otherwise-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 4 &lt;choose&gt;, &lt;when&gt;, &lt;otherwise&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#41-%E6%80%9D%E8%B7%AF"><span class="toc-text"> 4.1 思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#42-%E6%93%8D%E4%BD%9C"><span class="toc-text"> 4.2 操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-foreach-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 5 &lt;foreach&gt; 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#51-%E6%80%9D%E8%B7%AF"><span class="toc-text"> 5.1 思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%90%9C%E7%B4%A2%E6%88%96%E5%88%A0%E9%99%A4"><span class="toc-text"> 批量搜索（或删除）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0"><span class="toc-text"> 批量添加</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#52-%E6%93%8D%E4%BD%9C"><span class="toc-text"> 5.2 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%90%9C%E7%B4%A2%E6%88%96%E5%88%A0%E9%99%A4-2"><span class="toc-text"> 批量搜索（或删除）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0-2"><span class="toc-text"> 批量添加</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-sql-%E4%B8%8E-include-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 6 &lt;sql&gt; 与 &lt;include&gt; 标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-mybatis-%E4%B8%AD%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-text"> 六、MyBatis 中的分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-sql-%E8%AF%AD%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-text"> 1 SQL 语句中的分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text"> 2 分页插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text"> 2.1 添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text"> 2.2 配置分页插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-text"> 2.3 使用分页插件功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AE%80%E5%8D%95%E7%9A%84%E5%88%86%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-text"> 获取简单的分页信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text"> 测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%88%86%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-text"> 获取更多的分页信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-text"> 测试</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-mybatis-%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-text"> 七、MyBatis 的缓存机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text"> 1 一级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E7%BC%93%E5%AD%98"><span class="toc-text"> 开启缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text"> 缓存失效的情况</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text"> 2 二级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E7%BC%93%E5%AD%98-2"><span class="toc-text"> 开启缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%80%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-text"> 3 一二级缓存查询的顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-mybatis-%E4%B8%8E-spring-%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88"><span class="toc-text"> 八、MyBatis 与 Spring 框架整合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text"> 1. 操作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-text"> 1.1 添加依赖包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E6%BA%90-datasource"><span class="toc-text"> 1.2 准备数据源 DataSource</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BD%A2%E5%BC%8F"><span class="toc-text"> 注解形式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BD%A2%E5%BC%8F"><span class="toc-text"> 配置文件形式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-%E8%8E%B7%E5%8F%96-sqlsessionfactory-%E5%AF%B9%E8%B1%A1"><span class="toc-text"> 1.3 获取 SqlSessionFactory 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BD%A2%E5%BC%8F-2"><span class="toc-text"> 注解形式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BD%A2%E5%BC%8F-2"><span class="toc-text"> 配置文件形式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-%E9%85%8D%E7%BD%AE-mapper-%E6%98%A0%E5%B0%84%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 1.4 配置 Mapper 映射接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BD%A2%E5%BC%8F-3"><span class="toc-text"> 注解形式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BD%A2%E5%BC%8F-3"><span class="toc-text"> 配置文件形式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-%E6%B5%8B%E8%AF%95"><span class="toc-text"> 1.5 测试</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: #8EC3B0"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Guohao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'ea138c6f176d57705144',
      clientSecret: 'c999d74b366c68c80bc3b704c716a8ff8d67af6d',
      repo: 'Dave0126.github.io',
      owner: 'Dave0126',
      admin: ['Dave0126'],
      id: 'c709a0f831a707f2fafaf305ab6e21eb',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div></div></body></html>