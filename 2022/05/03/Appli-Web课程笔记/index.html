<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Appli Web课程笔记 | Lost N Found</title><meta name="author" content="Guohao"><meta name="copyright" content="Guohao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 本文章是根据法国国立高等电力技术、电子学、计算机、水力学与电信学校 (E.N.S.E.E.I.H.T.) 第八学期课程*“Application Web”* 总结而来的【部分课程笔记】。碍于本人学识有限，部分叙述难免存在纰漏，请读者注意甄别。">
<meta property="og:type" content="article">
<meta property="og:title" content="Appli Web课程笔记">
<meta property="og:url" content="https://lostnfound.top/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Lost N Found">
<meta property="og:description" content="前言 本文章是根据法国国立高等电力技术、电子学、计算机、水力学与电信学校 (E.N.S.E.E.I.H.T.) 第八学期课程*“Application Web”* 总结而来的【部分课程笔记】。碍于本人学识有限，部分叙述难免存在纰漏，请读者注意甄别。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lostnfound.top/linear-gradient(45deg,%20#8EC3B0,%20#9ED5C5,%20#F8C4B4,%20#FF8787)">
<meta property="article:published_time" content="2022-05-03T04:51:05.000Z">
<meta property="article:modified_time" content="2022-11-16T13:28:57.099Z">
<meta property="article:author" content="Guohao">
<meta property="article:tag" content="课程笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lostnfound.top/linear-gradient(45deg,%20#8EC3B0,%20#9ED5C5,%20#F8C4B4,%20#FF8787)"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://lostnfound.top/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: Guohao","link":"链接: ","source":"来源: Lost N Found","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Appli Web课程笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-16 21:28:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Lost N Found" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-battery-full"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar-check"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-hashtag"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-circle"></i><span> 关于我</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/Dave0126"><i class="fa-fw fab fa-github"></i><span> Github</span></a></li><li><a class="site-page child" href="mailto:dave980126@outlook.com"><i class="fa-fw fas fa-envelope"></i><span> Mail</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(45deg, #8EC3B0, #9ED5C5, #F8C4B4, #FF8787)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Lost N Found</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-battery-full"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar-check"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-hashtag"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user-circle"></i><span> 关于我</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/Dave0126"><i class="fa-fw fab fa-github"></i><span> Github</span></a></li><li><a class="site-page child" href="mailto:dave980126@outlook.com"><i class="fa-fw fas fa-envelope"></i><span> Mail</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Appli Web课程笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-03T04:51:05.000Z" title="发表于 2022-05-03 12:51:05">2022-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-16T13:28:57.099Z" title="更新于 2022-11-16 21:28:57">2022-11-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.1k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h3>
<p>本文章是根据法国国立高等电力技术、电子学、计算机、水力学与电信学校 (E.N.S.E.E.I.H.T.) 第八学期课程*“Application Web”* 总结而来的【部分课程笔记】。碍于本人学识有限，部分叙述难免存在纰漏，请读者注意甄别。</p>
<span id="more"></span>
<h3 id="第一部分introduction"><a class="markdownIt-Anchor" href="#第一部分introduction"></a> 第一部分：Introduction</h3>
<p>Web 基于 <code>客户端-服务器</code> 模型， 这里客户端是浏览器，服务器是 Web 服务器（如 Apache）。<br>
主要包括三个方面：</p>
<h4 id="1-带有-uriurnurl-的文件的指定和位置"><a class="markdownIt-Anchor" href="#1-带有-uriurnurl-的文件的指定和位置"></a> 1. 带有 URI/URN/URL 的文件的指定和位置</h4>
<ul>
<li>URI (Uniform Resource Identifier)：统一资源标识符，就是在某一规则下能把一个资源独一无二地标识出来。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi><mi>R</mi><mi>I</mi><mo>=</mo><mi>U</mi><mi>R</mi><mi>L</mi><mtext>  </mtext><mo>∪</mo><mtext>  </mtext><mi>U</mi><mi>R</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">URI = URL \; \cup \; URN</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></li>
<li>URL (Uniform Resource Locator)：统一资源定位符。标识一个互联网资源，并指定对其进行操作或获取该资源的方法。</li>
<li>URN (Uniform Resource Name)：统一资源名称。用于标识唯一书目的 ISBN系统是一个典型的 URN 使用范例</li>
</ul>
<h4 id="2-使用-html-和-css-语言对文档进行编码"><a class="markdownIt-Anchor" href="#2-使用-html-和-css-语言对文档进行编码"></a> 2. 使用 HTML 和 CSS 语言对文档进行编码</h4>
<h5 id="html"><a class="markdownIt-Anchor" href="#html"></a> HTML</h5>
<p>HTML (HyperText Markup Language) 语言由**包含内容的标签 (composé de balises)**组成</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>	<span class="comment">&lt;!-- 标记 HTML文档 --&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span>	<span class="comment">&lt;!-- 标记 HTML头部元素 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span>	<span class="comment">&lt;!-- 标记 HTML元数据 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">title</span>&gt;</span>	<span class="comment">&lt;!-- 标记 HTML的标题 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span>	<span class="comment">&lt;!-- 标记 HTML文档的主体 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>	<span class="comment">&lt;!-- 标记 标题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span>	<span class="comment">&lt;!-- 标记 水平线 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="comment">&lt;!-- 标记 一个段落 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="comment">&lt;!-- 标记 换行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">em</span>&gt;</span>	<span class="comment">&lt;!-- 标记 着重元素(加粗) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>	<span class="comment">&lt;!-- 内容划分元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span>	<span class="comment">&lt;!-- 表格 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>	<span class="comment">&lt;!-- table data cell	表格中的一个单元格 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span>	<span class="comment">&lt;!-- table header cell	表格中的表头 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span>	<span class="comment">&lt;!-- table row	表格中的一行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>	<span class="comment">&lt;!-- List Item	列表项目 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">nl</span>&gt;</span><span class="tag">&lt;/<span class="name">nl</span>&gt;</span>	<span class="comment">&lt;!-- navigation lists	导航列表 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ol</span>&gt;</span><span class="tag">&lt;/<span class="name">ol</span>&gt;</span>	<span class="comment">&lt;!-- Ordered List	排序列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span>	<span class="comment">&lt;!-- Unordered List	不排序列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 表示文档中的一个区域，此区域包含交互控件，用于向 Web 服务器提交信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.google.com&quot;</span>&gt;</span>这是一个链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签&lt;a&gt;: 设置超文本链接 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/logo.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;258&quot;</span> <span class="attr">height</span>=<span class="string">&quot;39&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签&lt;img&gt;: 设置图片 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="css"><a class="markdownIt-Anchor" href="#css"></a> CSS</h5>
<p><strong>层叠样式表</strong>（<strong>C</strong>ascading <strong>S</strong>tyle <strong>S</strong>heets) 是一种用来为结构化文档（如HTML文档或XML应用）添加样式（字体、间距和颜色等）的计算机语言</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="number">#d0e4fe</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:orange;</span><br><span class="line">    <span class="attribute">text-align</span>:center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>:<span class="string">&quot;Times New Roman&quot;</span>;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Exemple: &lt;h2 id=&quot;boldFond&quot;&gt;加粗文本&lt;/h2&gt;*/</span></span><br><span class="line"><span class="selector-class">.boldFond</span> &#123;</span><br><span class="line">  font_weight: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如何在 <code>HTTP</code> 文件里使用 <code>CSS</code>文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">herf</span>=<span class="string">&quot;/style.css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-浏览器和-web-服务器之间的通信协议-http"><a class="markdownIt-Anchor" href="#3-浏览器和-web-服务器之间的通信协议-http"></a> 3. 浏览器和 Web 服务器之间的通信协议 (HTTP)</h4>
<p>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网服务器传输超文本到本地浏览器的传送协议，<strong>基于TCP/IP通信协议</strong>来传递数据（HTML 文件, 图片文件, 查询结果等）。面向连接，安全。</p>
<p>HTTP协议工作于 <code>C/S</code> 架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。<u>Web服务器根据接收到的请求后，向客户端发送响应信息</u>：</p>
<pre class="mermaid">graph LR
Client --Request--> Server
Server --Reponse--> Client</pre>
<p>HTTP使用URL来传输数据和建立连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://	127.0.0.1		:8080	/enseeiht/	index.html	?name=dai&amp;age=18	#detail</span><br><span class="line">协议		IP地址或DNS	端口	虚拟目录			文件名				参数部分					锚</span><br></pre></td></tr></table></figure>
<h5 id="http-请求数据格式"><a class="markdownIt-Anchor" href="#http-请求数据格式"></a> HTTP 请求数据格式</h5>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 请求行 --&gt;</span></span><br><span class="line">POST /example/index.html HTTP/1.1</span><br><span class="line"><span class="comment">&lt;!-- 请求方法 | 请求资源路径 | 协议及版本 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 请求头 key: value --&gt;</span></span><br><span class="line">Host: www.google.com	<span class="comment">&lt;!-- 请求主机名 --&gt;</span></span><br><span class="line">User_Agent: Chrome	<span class="comment">&lt;!-- 请求的浏览器信息 --&gt;</span></span><br><span class="line">Accept: xxx/xxx	<span class="comment">&lt;!-- 浏览器能接收的资源类型，如text/*、image/* --&gt;</span></span><br><span class="line">Cookie: NAME=VALUE <span class="comment">&lt;!-- 上报 Cookie --&gt;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 请求体  --&gt;</span></span><br><span class="line">username=xxx&amp;password=123456</span><br></pre></td></tr></table></figure>
<p>或 <code>json</code> 格式的 HTTP 请求数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http<span class="punctuation">:</span><span class="comment">//www.example.com HTTP/1.1 </span></span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json;charset=utf<span class="number">-8</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;123456&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">24</span><span class="punctuation">,</span> <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;x&quot;</span><span class="punctuation">,</span><span class="string">&quot;xx&quot;</span><span class="punctuation">,</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>或 <code>xml</code> 格式的 HTTP 请求数据</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST http://www.example.com HTTP/1.1 </span><br><span class="line">Content-Type: text/xml</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;REQ&gt;</span></span><br><span class="line"><span class="meta">	&lt;username&gt;xxx&lt;/username&gt;</span></span><br><span class="line"><span class="meta">	&lt;passowrd&gt;123456&lt;/password&gt;</span></span><br><span class="line"><span class="meta">&lt;/REQ&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="http-的请求方法"><a class="markdownIt-Anchor" href="#http-的请求方法"></a> HTTP 的请求方法</h6>
<ul>
<li>
<p><code>GET</code>：请求指定的页面信息，并返回实体主体。</p>
<p><u>在<strong>请求行</strong>中请求 (<code>/example/index.html?username=xxx&amp;password=123456</code>)，<strong>有长度限制</strong></u>。</p>
</li>
<li>
<p><code>HEAD</code>：类似于 <code>GET</code> 请求，只不过返回的响应中没有具体的内容，用于获取报头</p>
</li>
<li>
<p><code>POST</code>：向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。<code>POST</code> 请求可能会导致新的资源的建立和/或已有资源的修改。<u>在<strong>请求体</strong>中请求，<strong>没有长度限制</strong></u>。</p>
</li>
<li>
<p><code>PUT</code>：从客户端向服务器传送的数据取代指定的文档的内容。</p>
</li>
<li>
<p><code>DELETE</code>：请求服务器删除指定的页面。</p>
</li>
<li>
<p><code>CONNECT</code>：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</p>
</li>
<li>
<p><code>OPTIONS</code>：允许客户端查看服务器的性能。</p>
</li>
<li>
<p><code>TRACE</code>：回显服务器收到的请求，主要用于测试或诊断。</p>
</li>
</ul>
<h5 id="http-响应数据格式"><a class="markdownIt-Anchor" href="#http-响应数据格式"></a> HTTP 响应数据格式</h5>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 响应行 --&gt;</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line"><span class="comment">&lt;!-- 协议及版本 响应状态 状态码描述 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 响应头 key: value --&gt;</span></span><br><span class="line">Server: www.google.com	<span class="comment">&lt;!-- 响应主机名 --&gt;</span></span><br><span class="line">Content-Type: text/html	<span class="comment">&lt;!-- 该响应的内容类型，text/html、image/jpg --&gt;</span></span><br><span class="line">Content-Length:	<span class="comment">&lt;!-- 该响应的内容长度(字节数) --&gt;</span></span><br><span class="line">Content-Encoding:	<span class="comment">&lt;!-- 该响应的编码 --&gt;</span></span><br><span class="line">Cache-Control：<span class="comment">&lt;!-- 客户端如何缓存该响应 --&gt;</span></span><br><span class="line">Set-Cookie: NAME=VALUE, expires=过期时间戳, ... <span class="comment">&lt;!-- 下放 Cookie --&gt;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 响应体  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">http</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="http-状态码"><a class="markdownIt-Anchor" href="#http-状态码"></a> HTTP 状态码</h6>
<p>状态代码有三位数字组成，第一个数字定义了响应的类别，共分五种类别:</p>
<ul>
<li><code>1xx</code>：指示信息。表示请求已接收，继续处理</li>
<li><code>2xx</code>：成功。表示请求已被成功接收、理解、接受</li>
<li><code>3xx</code>：重定向。要完成请求必须进行更进一步的操作</li>
<li><code>4xx</code>：客户端错误。请求有语法错误或请求无法实现</li>
<li><code>5xx</code>：服务器端错误。服务器未能实现合法的请求</li>
</ul>
<p>常见状态码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">200 OK                        //客户端请求成功</span><br><span class="line">302 Found											//资源已移动到Location响应头指定的URL，浏览器自动重新跳转</span><br><span class="line">400 Bad Request               //客户端请求有语法错误，不能被服务器所理解</span><br><span class="line">401 Unauthorized              //请求未经授权</span><br><span class="line">403 Forbidden                 //服务器收到请求，但是拒绝提供服务</span><br><span class="line">404 Not Found                 //请求资源不存在，eg：输入了错误的URL</span><br><span class="line">500 Internal Server Error     //服务器发生不可预期的错误</span><br><span class="line">503 Server Unavailable        //服务器当前不能处理客户端的请求，一段时间后可能恢复正常</span><br></pre></td></tr></table></figure>
<h4 id="4-http-表单-formulaire"><a class="markdownIt-Anchor" href="#4-http-表单-formulaire"></a> 4. HTTP 表单 (formulaire)</h4>
<p>网站怎样与用户进行交互？答案是使用HTML表单(form)。表单是可以把浏览者输入的数据传送到服务器端，这样服务器端程序就可以处理表单传过来的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;url&quot;</span> <span class="attr">method</span>=<span class="string">&quot;method&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--	action: 规定当提交表单时向何处发送表单数据 </span></span><br><span class="line"><span class="comment">				method: 规定用于发送 form-data 的 HTTP 方法(GET/POST)--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="get与-post的差别"><a class="markdownIt-Anchor" href="#get与-post的差别"></a> <code>get</code>与 <code>post</code>的差别</h5>
<p>本质上的区别是语义的区别，根据HTTP规范，<code>POST</code> 的语义是根据请求负荷（报文主体）对指定的资源做出处理。<code>POST</code> 方法是安全、不可缓存的。<code>GET</code> 的语义是请求获取指定的资源，具体的处理方式视资源类型而不同。<code>GET</code> 不安全，可缓存。具体差别如下：</p>
<ul>
<li>get在后退刷新时是无害的，post会重新提交请求；</li>
<li>get参数通过URL传递，post放在Request body中；</li>
<li>get请求参数保留在浏览器历史记录中，post参数不会保留；</li>
<li>get产生的URL地址可以被存为书签，而post不可以；</li>
<li>对参数的数据类型，get只接受ASCII字符，而post没有限制；</li>
<li>get比post更不安全，因为发送的数据显示在URL上，在发送密码或其他敏感信息时绝不要使用get;</li>
<li>get请求只能进行url编码，而post支持多种编码方式。</li>
</ul>
<h5 id="表单元素input"><a class="markdownIt-Anchor" href="#表单元素input"></a> 表单元素：<code>input</code></h5>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span> <span class="attr">size</span>=<span class="string">&quot;10pd&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="常见的-input-标签"><a class="markdownIt-Anchor" href="#常见的-input-标签"></a> 常见的 <code>input</code> 标签:</h6>
<ul>
<li>
<p><code>submit</code> 用于数据提交</p>
</li>
<li>
<p><code>text</code> 可输入文本</p>
</li>
<li>
<p><code>password</code> 用于输入密码，输入内容会呈现为小圆点，进行隐藏</p>
</li>
<li>
<p><code>checkbox</code> 多选框</p>
</li>
<li>
<p><code>radio</code> 多选框</p>
</li>
<li>
<p><code>select</code> 下拉选择 并和 <code>option</code> 标签一起使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;choice&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>&gt;</span>选择1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;value2&quot;</span>&gt;</span>选择2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;value3&quot;</span>&gt;</span>选择3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>file</code> 上传文件</p>
</li>
<li>
<p><code>hidden</code> 隐藏组件</p>
</li>
<li>
<p><code>bottom</code> 按钮</p>
</li>
<li>
<p><code>reset</code> 重置表单</p>
</li>
<li>
<p><code>textarea</code> 文本区域</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;teatarea&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">这是文本区域，可以键入</span><br><span class="line"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-cgi的工作原理"><a class="markdownIt-Anchor" href="#5-cgi的工作原理"></a> 5. CGI的工作原理</h4>
<p>CGI（Common Gateway Interface）公共网关接口，根据CGI标准，编写外部扩展应用程序，可以对客户端浏览器输入的数据进行处理，完成客户端与服务器的交互操作。CGI规范定义了Web服务器如何向扩展应用程序发送消息，在收到扩展应用程序的信息后又如何进行处理等内容。</p>
<p>CGI 应用程序能与浏览器进行交互，还可通过数据API与数据库服务器等外部数据源进行通信，从数据库服务器中获取数据。格式化为HTML文档后，发送给浏览器，也可以将从浏览器获得的数据放到数据库中。</p>
<pre class="mermaid">graph RL

subgraph "C/S"
浏览器 --"get/post"--> Web服务器
Web服务器 --"generated.html"--> 浏览器
end

Web服务器 --stdin--> CGI
Web服务器 --$QUERY_STRING--> CGI
CGI --stdout--> Web服务器

subgraph "动态网页"
CGI --传入数据--> 程序
程序 --产生数据--> CGI
end</pre>
<p><code>&lt;form&gt;</code>标签的 <code>METHOD</code> 属性来决定具体使用哪一种方法。</p>
<ul>
<li>在 <code>METHOD=GET</code> 时，向 CGI 传递表单编码信息的是通过命令来进行的。表单编码信息大多数是通过环境变量 <code>QUERY_STRING</code> 来传递的。</li>
<li>若 <code>METHOD=POST</code>，表单信息通过标准输入 <code>stdin</code> 来读取。</li>
</ul>
<h4 id="6-http-cookies"><a class="markdownIt-Anchor" href="#6-http-cookies"></a> 6. HTTP Cookies</h4>
<p><code>Cookie</code> 是一个<strong>保存在客户机</strong>中的简单的文本文件, 这个文件与特定的 Web 文档关联在一起, <u>保存了该客户机访问这个Web 文档时的信息, 当客户机再次访问这个 Web 文档时这些信息可供该文档使用</u>。</p>
<p><strong>由服务器创建，保存在客户端中</strong></p>
<h5 id="组成"><a class="markdownIt-Anchor" href="#组成"></a> 组成</h5>
<p>Cookie是一段不超过4KB的小型文本数据，由一个名称（Name）、一个值（Value）和其它几个用于控制Cookie有效期、安全性、使用范围的可选属性组成。其中：</p>
<ol>
<li><code>Name/Value</code>：设置Cookie的名称及相对应的值，对于认证Cookie，<code>Value</code>值包括Web服务器所提供的访问令牌。</li>
<li><code>Expires</code>属性：设置Cookie的生存期。有两种存储类型的Cookie：会话性与持久性。Expires属性缺省时，为会话性Cookie，仅保存在客户端内存中，并在用户关闭浏览器时失效；持久性Cookie会保存在用户的硬盘中，直至生存期到或用户直接在网页中单击“注销”等按钮结束会话时才会失效 [3] 。</li>
<li><code>Path</code> 属性：定义了Web站点上可以访问该Cookie的目录。</li>
<li><code>Domain</code> 属性：指定了可以访问该 Cookie 的 Web 站点或域。Cookie 机制并未遵循严格的同源策略，允许一个子域可以设置或获取其父域的 Cookie。当需要实现单点登录方案时，Cookie 的上述特性非常有用，然而也增加了 Cookie受攻击的危险，比如攻击者可以借此发动会话定置攻击。因而，浏览器禁止在 <code>Domain</code> 属性中设置<code>.org</code>、<code>.com</code> 等通用顶级域名、以及在国家及地区顶级域下注册的二级域名，以减小攻击发生的范围</li>
<li><code>Secure</code> 属性：指定是否使用 <code>HTTPS</code> 安全协议发送Cookie。使用HTTPS安全协议，可以保护Cookie在浏览器和Web服务器间的传输过程中不被窃取和篡改。该方法也可用于Web站点的身份鉴别，即在HTTPS的连接建立阶段，浏览器会检查Web网站的SSL证书的有效性。但是基于兼容性的原因（比如有些网站使用自签署的证书）在检测到SSL证书无效时，浏览器并不会立即终止用户的连接请求，而是显示安全风险信息，用户仍可以选择继续访问该站点。由于许多用户缺乏安全意识，因而仍可能连接到Pharming攻击所伪造的网站</li>
<li><code>HTTPOnly</code> 属性 ：用于防止客户端脚本通过document.cookie属性访问Cookie，有助于保护Cookie不被跨站脚本攻击窃取或篡改。但是，HTTPOnly的应用仍存在局限性，一些浏览器可以阻止客户端脚本对Cookie的读操作，但允许写操作；此外大多数浏览器仍允许通过 <code>XMLHTTP</code> 对象读取 <code>HTTP</code> 响应中的Set-Cookie头 。</li>
</ol>
<h3 id="第二部分动态网页"><a class="markdownIt-Anchor" href="#第二部分动态网页"></a> 第二部分：动态网页</h3>
<h4 id="21-servlet"><a class="markdownIt-Anchor" href="#21-servlet"></a> 2.1 Servlet</h4>
<p>Servlet是 Java 提供的一门<strong>动态web</strong>资源开发技术。是JavaEE 的规范之一，其实就是一个<u>接口</u>，我们需要定义 <code>Servlet</code> 的类实现 <code>Servlet</code>接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Servlet</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">destory</span><span class="params">()</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line">  ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line">  String <span class="title function_">getServletInfo</span><span class="params">()</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是在上述 <code>Servlet</code> 接口中只有 <code>void service(ServletRequest req, ServletResponse res)</code> 方法最为常用，我们将 <code>Servlet</code> 接口封装为 <code>HttpServlet</code> 抽象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HttpServlet</span> <span class="keyword">extends</span> <span class="title class_">GenericServlet</span> &#123;</span><br><span class="line"><span class="comment">/* Provides an abstract class to be subclassed to create an HTTP servlet suitable for a Web site. A subclass of HttpServlet must override at least one method, usually one of these:*/</span></span><br><span class="line">  HttpServletRequest req;</span><br><span class="line">	HttpServletResponse res;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// if the servlet supports HTTP GET requests</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// for HTTP POST requests</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="request-和-response"><a class="markdownIt-Anchor" href="#request-和-response"></a> Request 和 Response</h5>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-06 11.28.18.png" alt="2022-05-06 11.28.18" style="zoom:40%;">
<h6 id="request-获取请求数据"><a class="markdownIt-Anchor" href="#request-获取请求数据"></a> Request 获取请求数据</h6>
<p>请求数据分为3部分：</p>
<ol>
<li>请求行：<code>GET /request-demo/req1?username=xxx HTTP/1.1</code></li>
</ol>
<ul>
<li><code>String getMethod()</code>：获取请求方式：<code>GET/POST</code></li>
<li><code>String getContextPath()</code>：获取虛拟目录(项目访问路径)：<code>/request-demo</code></li>
<li><code>String Buffer getRequestURL()</code>：获取URL（统一资源定位符）：<code>http://localhost:8080/request-demo/req1</code></li>
<li><code>String getRequestURI()</code>：获取URI（统一资源标识符）：<code>/request-demo/req1</code></li>
<li><code>String getQueryString()</code>：获取请求参数（<code>GET</code> 方式）： <code>username=zhangsan&amp;password=1</code></li>
</ul>
<ol start="2">
<li>请求头：<code>User-Agent: Mozilla/5.0 Chrome/91.0.4472.106</code></li>
</ol>
<ul>
<li>String getHeader(String name)：根据请求头名称，获取值</li>
</ul>
<ol start="3">
<li>请求体 (<code>POST</code> 方式)：<code>username=xxx&amp;password=123456</code></li>
</ol>
<ul>
<li><code>ServletlnputStream getinputStream()</code>：获取字节输入流</li>
<li><code>BufferedReader getReader()</code>：获取字符输入流</li>
</ul>
<p><code>getParameter()</code>：我们将 <code>GET</code> 方式中获取请求参数 <code>String getQueryString()</code> 和 <code>POST</code> 方式中获取请求参数 <code>BufferedReader getReader()</code> 同一为一种<u>通用的获取请求参数的方法：<code>getParameter(key)</code></u>。这其实是将所有的参数解析后存在在一个 <code>MAP</code> 中，通过 <code>key</code> 来获取 <code>value</code>。</p>
<p>【请求转发】<code>request.getRequestDispatcher(&quot;资源B的路径&quot;).forword(request,respond)</code>：如果服务器有两个资源，资源A 和资源B，资源A处理一部分后跳转 (forword) 到资源B继续处理。地址栏不变，一次请求</p>
<ul>
<li>请求转发资源间共享数据：使用 <code>Request</code> 对象
<ul>
<li><code>void setAttribute(String name, Object o)</code>：存储数据到 <code>request</code> 域中</li>
<li><code>Object getAttribute (String name)</code>：根据 key，获取值</li>
<li><code>void removeAttribute(String name)</code>：根据 key，删除该键值对</li>
</ul>
</li>
</ul>
<h6 id="response-设置响应数据"><a class="markdownIt-Anchor" href="#response-设置响应数据"></a> Response 设置响应数据</h6>
<p>响应数据分为3部分：</p>
<ol>
<li>
<p>响应行：<code>HTTP/1.1 200 OK</code></p>
<ul>
<li><code>void setStatus(int statusCode)</code>：设置响应状态码</li>
</ul>
</li>
<li>
<p>响应头：<code>Content-Type: text/html</code></p>
<ul>
<li><code>void setHeader(String name, String value)</code>：设置响应头 键值对</li>
</ul>
</li>
<li>
<p>响应体：<code>&lt;html&gt;&lt;/html&gt;</code></p>
</li>
</ol>
<ul>
<li><code>Printwriter writer = response.getWriter()</code>：获取宇符输出流
<ul>
<li><code>writer.write(&quot;&lt;html&gt;&quot;)</code></li>
</ul>
</li>
<li><code>Servletoutputstream outputStream = response.getoutputStream()</code>：获取字节输出流</li>
</ul>
<p>【重定向 Redierct】当前资源A无法处理(<code>statusCode=302</code>)，重定向到别的资源B (<code>location</code>) 处理。地址栏变化，两次不同的请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedierct(<span class="string">&quot;资源B的路径&quot;</span>);</span><br><span class="line"><span class="comment">// 与以下代码等价</span></span><br><span class="line">response.setStatus(<span class="number">302</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;location&quot;</span>,<span class="string">&quot;资源B的路径&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>例：</p>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-03 20.48.15.png" alt="2022-05-03 20.48.15" style="zoom:50%;">
<p><code>web_app/demo.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Enter a person<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>= <span class="string">&quot;web_app/demo&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- action是请求的路径，规定当提交表单时向何处发送表单数据 --&gt;</span></span><br><span class="line">      firstname<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstname&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      lastname<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastname&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      email<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;op&quot;</span> <span class="attr">value</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;op&quot;</span> <span class="attr">value</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>由上述代码可见，<code>action</code> 指定的请求路径是 <code>web_app/demo</code></li>
<li><code>method</code> 指定的方法是 <code>post</code></li>
</ul>
<p><code>servletDemo.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个路径可以配置多个 urlPattern = &#123;&quot;/demo1&quot;, &quot;/demo2&quot;&#125;</span></span><br><span class="line"><span class="meta">@WebServlet(urlPattern=&quot;/web_app/demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Directory</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 对于数据库的操作</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">db_url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:hsqldb:hsql://localhost/web_app&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">db_user</span> <span class="operator">=</span> <span class="string">&quot;sa&quot;</span>;</span><br><span class="line">      Class.forName(<span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span>);</span><br><span class="line">      <span class="type">Connection</span> <span class="variable">con</span> <span class="operator">=</span> DriverManager.getConnection(db_url, db_user, <span class="literal">null</span>);</span><br><span class="line">      </span><br><span class="line">      response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">      out.print(<span class="string">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;demo&lt;/title&gt;&lt;/head&gt;&quot;</span>);</span><br><span class="line">      out.print(<span class="string">&quot;&lt;body&gt;&lt;h1&gt;Enter a person&lt;/h1&gt;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">op</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;op&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (op.equals(<span class="string">&quot;list&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// op = list</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> con.createStatement();</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">res</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT * FROM demo&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(res.next()) &#123;</span><br><span class="line">          out.print(<span class="string">&quot;&lt;p&gt;&quot;</span>+res.getString(<span class="string">&quot;firstname&quot;</span>)+<span class="string">&quot; &quot;</span>+res.getString(<span class="string">&quot;lastname&quot;</span>) +<span class="string">&quot; &quot;</span>+res.getString(<span class="string">&quot;email&quot;</span>)+<span class="string">&quot;&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// op = add</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> con.prepareStatement(<span class="string">&quot;INSERT INTO demo VALUES(?,?,?)&quot;</span>);</span><br><span class="line">        ps.setString(<span class="number">1</span>, request.getParameter(<span class="string">&quot;firstname&quot;</span>));</span><br><span class="line">        ps.setString(<span class="number">2</span>, request.getParameter(<span class="string">&quot;lastname&quot;</span>));</span><br><span class="line">        ps.setString(<span class="number">3</span>, request.getParameter(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">        ps.executeUpdate();</span><br><span class="line">        out.print(<span class="string">&quot;Person was added&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      out.print(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">      ex.printStackTrace(out);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="cookie"><a class="markdownIt-Anchor" href="#cookie"></a> Cookie</h5>
<p>客户端的会话构造技术：将数据保存在客户端，每次请求都携带 Cookies 数据进行访问。</p>
<ul>
<li>Cookie 存活时间：
<ul>
<li>默认情况下，Cookie 存储在浏览器内存中，当浏览器关闭，内存释放，则 Cookie 被销毁。</li>
<li><code>setMaxAge(int seconds)</code> ：设置存活时间。（+表示存入硬盘，到期删除；-表示默认情况；0表示删除对应Cookie）</li>
</ul>
</li>
</ul>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 09.21.41.png" alt="2022-05-04 09.21.41" style="zoom:50%;">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建Cookie对象，设置数据</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(String name, String value);</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String newValue)</span>;</span><br><span class="line">String <span class="title function_">getValue</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setDomain</span><span class="params">(String pattern)</span>;</span><br><span class="line">String <span class="title function_">getDomain</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setMxaAge</span><span class="params">(<span class="type">int</span> expiry)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">getMaxAge</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.发送Cookie到客户端：使用response对象</span></span><br><span class="line">HttpServletRequest.addCookie(cookie);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.获取客户端携带的所有Cookie</span></span><br><span class="line">Cookie[] cookies = HttpServletRequest.getCookie();</span><br><span class="line"><span class="comment">// 遍历所有cookies数组，获取每一个Cookie对象</span></span><br><span class="line"><span class="keyword">for</span> (Cookie c:cookies)&#123;</span><br><span class="line">  <span class="comment">// 得到键 key</span></span><br><span class="line">  c.getName();</span><br><span class="line">  <span class="comment">// 得到值 value</span></span><br><span class="line">  c.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="session"><a class="markdownIt-Anchor" href="#session"></a> Session</h5>
<p>服务器端的会话跟踪技术：将数据保存在服务端。Session的是现实基于Cookies的。</p>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 09.38.52.png" alt="2022-05-04 09.38.52" style="zoom:50%;">
<p>JavaEE 提供了 <code>HttpSession</code> 接口，来实现<u>一次回话的多次请求间的<strong>数据共享功能</strong></u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 获取 Session 对象</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> HttpServletRequest.getSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Session 中的功能</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object o)</span>; <span class="comment">// 将数据存储到 Session 中</span></span><br><span class="line">Object <span class="title function_">getAttritube</span><span class="params">(String name)</span>; <span class="comment">// 根据 key 获得 value</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeAttritude</span><span class="params">(String name)</span>; <span class="comment">// 根据 key 删除该键值对</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="22-jsp"><a class="markdownIt-Anchor" href="#22-jsp"></a> 2.2 JSP</h4>
<p>Java Server Page，即Java服务端页面。是一种动态网页技术，既可以定义 HTML、JS、CSS 等静态内容，还可以定义 Java 代码的动态内容。<code>JSP = HRTML + Java</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;!-- html 代码 --&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;JSP, Hello world.&lt;/h1&gt;</span><br><span class="line">    &lt;% <span class="comment">// JSP 脚本：Java 代码</span></span><br><span class="line">    	System.out.println(<span class="string">&quot;hello.jsp&quot;</span>);	<span class="comment">// console 输出</span></span><br><span class="line">    %&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="jsp-原理"><a class="markdownIt-Anchor" href="#jsp-原理"></a> JSP 原理</h5>
<p>JSP 本质上是一个 Servlet。JSP 在被访问时，由 JSP 容器（Tomcat）将其转换为 Java 文件（Servlet），再由 JSP 容器将其编译，最终对外提供服务的就是这个字节码文件：</p>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 10.05.07.png" alt="2022-05-04 10.05.07" style="zoom:40%;">
<h5 id="jsp-脚本-scriptlet"><a class="markdownIt-Anchor" href="#jsp-脚本-scriptlet"></a> JSP 脚本 (Scriptlet)</h5>
<p>JSP 脚本用于在 JSP 页面内定义 Java 代码。</p>
<p>JSP 脚本的分类：</p>
<ul>
<li><code>&lt;% ... %&gt;</code>：Java 脚本。内容会直接放到 <code>_jspService()</code> 方法之中；</li>
<li><code>&lt;%= ... %&gt;</code>：表达式。内容会直接放到 <code>out.print()</code> 方法之中，作为 <code>out.print()</code> 的参数；</li>
<li><code>&lt;%! ... %&gt;</code>：声明。内容会放到 <code>_jspService()</code> 方法之外，被类直接包含。定义成员变量、方法等</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;% System.out.println(<span class="string">&quot;Hello, JSP&quot;</span>); %&gt;</span><br><span class="line">	&lt;%= <span class="string">&quot;hello&quot;</span> %&gt;</span><br><span class="line">	&lt;%! <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">123</span>; %&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">hello_jsp</span> <span class="keyword">extends</span> <span class="title class_">HttpJspBase</span> <span class="keyword">implements</span> <span class="title class_">JspSourceDependent</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">123</span>;	<span class="comment">// 成员变量或方法</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">_jspService</span><span class="params">(req, res)</span> &#123;</span><br><span class="line">    out.write(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;Hello, JSP&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;hello&quot;</span>);	<span class="comment">// 显示输出在页面上</span></span><br><span class="line">    out.write(<span class="string">&quot;&lt;\html&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="jsp-的指令标签"><a class="markdownIt-Anchor" href="#jsp-的指令标签"></a> JSP 的指令标签</h5>
<p>JSP指令用来设置整个JSP页面相关的属性，如网页的编码方式和脚本语言。</p>
<p>语法格式如下：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ directive attribute=<span class="string">&quot;value&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>指令可以有很多个属性，它们以键值对的形式存在，并用逗号隔开。</p>
<p>JSP中的三种指令标签：</p>
<p><strong>（1）<code>&lt;%@ page ... %&gt;</code></strong></p>
<p>Page指令为容器提供当前页面的使用说明。一个JSP页面可以包含多个page指令。</p>
<p>Page指令的语法格式：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page attribute=<span class="string">&quot;value&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>
<p>等价的XML格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp:directive.page</span> <span class="attr">attribute</span>=<span class="string">&quot;value&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>属性</strong></th>
<th style="text-align:left"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>buffer</code></td>
<td style="text-align:left">指定out对象使用缓冲区的大小</td>
</tr>
<tr>
<td style="text-align:left"><code>autoFlush</code></td>
<td style="text-align:left">控制out对象的 缓存区</td>
</tr>
<tr>
<td style="text-align:left"><code>contentType</code></td>
<td style="text-align:left">指定当前JSP页面的MIME类型和字符编码</td>
</tr>
<tr>
<td style="text-align:left"><code>errorPage</code></td>
<td style="text-align:left">指定当JSP页面发生异常时需要转向的错误处理页面</td>
</tr>
<tr>
<td style="text-align:left"><code>isErrorPage</code></td>
<td style="text-align:left">指定当前页面是否可以作为另一个JSP页面的错误处理页面</td>
</tr>
<tr>
<td style="text-align:left"><code>extends</code></td>
<td style="text-align:left">指定servlet从哪一个类继承</td>
</tr>
<tr>
<td style="text-align:left"><code>import</code></td>
<td style="text-align:left">导入要使用的Java类</td>
</tr>
<tr>
<td style="text-align:left"><code>info</code></td>
<td style="text-align:left">定义JSP页面的描述信息</td>
</tr>
<tr>
<td style="text-align:left"><code>isThreadSafe</code></td>
<td style="text-align:left">指定对JSP页面的访问是否为线程安全</td>
</tr>
<tr>
<td style="text-align:left"><code>language</code></td>
<td style="text-align:left">定义JSP页面所用的脚本语言，默认是Java</td>
</tr>
<tr>
<td style="text-align:left"><code>session</code></td>
<td style="text-align:left">指定JSP页面是否使用session</td>
</tr>
<tr>
<td style="text-align:left"><code>isELIgnored</code></td>
<td style="text-align:left">指定是否执行EL表达式</td>
</tr>
<tr>
<td style="text-align:left"><code>isScriptingEnabled</code></td>
<td style="text-align:left">确定脚本元素能否被使用</td>
</tr>
</tbody>
</table>
<p><strong>（2）包含：<code>&lt;%@ include ... %&gt;</code></strong></p>
<p>使用包含操作，可以将一些重复的代码包含进来继续使用，从正常的页面组成来看，有时可能分为几个区域。而其中的一些区域可能是一直不需要改变的，改变的就其中的一个具体内容区域。现在有两种方法可以实现上述功能。</p>
<ul>
<li>方法一：在每个JSP 页面 （HTML）都包含工具栏、头部信息、尾部信息、具体内容</li>
<li>方法二：将工具栏、头部信息、尾部信息都分成各个独立的文件，使用的时候直接导入</li>
</ul>
<p>很明显，第二种方法比第一种更好，第一种会存在很多重复的代码，并旦修改很不方便，在JSP 中如果要想实现包含的操作，有两种做法：<strong>静态包含</strong>、<strong>动态包含</strong>，静态包含使用 <code>include</code> 指令即可，动态包含则需要使用 <code>include</code> 动作标签。</p>
<ul>
<li>
<p>静态包含：<code>&lt;%@ include file=&quot;要包含文件的相对路径&quot; %&gt;</code></p>
</li>
<li>
<p>动态包含：<code>&lt;jsp:include file=&quot;要包含文件的相对路径&quot;&gt; &lt;/jsp:include&gt;</code></p>
</li>
</ul>
<p><strong>（3）Taglib 指令</strong></p>
<p>JSP API允许用户自定义标签，一个自定义标签库就是自定义标签的集合。Taglib指令引入一个自定义标签集合的定义，包括库路径、自定义标签。</p>
<p>Taglib指令的语法：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;uri&quot;</span> prefix=<span class="string">&quot;prefixOfTag&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>
<h4 id="23-mvc-模式"><a class="markdownIt-Anchor" href="#23-mvc-模式"></a> 2.3 MVC 模式</h4>
<p>MVC 是一种分层开发的模式，其中：</p>
<ul>
<li>M：Model，业务模型，处理业务</li>
<li>V：View，视图，界面展示</li>
<li>C：Controller，控制器，处理请求，调用模型和视图，也可以在一个控制器中调用另一个控制器</li>
</ul>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 11.29.09.png" alt="2022-05-04 11.29.09" style="zoom:40%;">
<h5 id="三层架构软件设计架构"><a class="markdownIt-Anchor" href="#三层架构软件设计架构"></a> 三层架构：软件设计架构</h5>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 11.46.01.png" alt="2022-05-04 11.46.01" style="zoom:50%;">
<ul>
<li>数据访问层：对数据库的CRUD基本操作</li>
<li>业务逻辑层：对业务逻辑进行封装，组合数据访问层层中基本功能，形成复杂的业务逻辑功能</li>
<li>表现层：接收请求，封装数据，调用业务逻辑层，响应数据</li>
</ul>
<h4 id="24-案例"><a class="markdownIt-Anchor" href="#24-案例"></a> 2.4 案例</h4>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 12.59.01.png" alt="2022-05-04 12.59.01" style="zoom:50%;">
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 12.59.29.png" alt="2022-05-04 12.59.29" style="zoom:50%;">
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 12.59.46.png" alt="2022-05-04 12.59.46" style="zoom:50%;">
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 13.00.04.png" alt="2022-05-04 13.00.04" style="zoom:50%;">
<p>我们使用一个简单的例子实现上述 MVC + 三层结构，其中我们不需要连接数据库，所以我们把 “数据访问层”和“数据库”用一个类 <code>Compte</code> 取代：</p>
<p><code>Compte.java</code> (DATA)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Compte</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">  <span class="keyword">private</span> String nom;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> solde;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">()</span> &#123;&#125; <span class="comment">// 空构造函数</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">(<span class="type">int</span> num, String nom, <span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.num;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNom</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.nom;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNom</span><span class="params">(String nom)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSolde</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.solde;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSolde</span><span class="params">(<span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    rerturn <span class="string">&quot;Compte [num=&quot;</span> + num + <span class="string">&quot;,nom=&quot;</span> + nom + <span class="string">&quot;,solde=&quot;</span> + solde + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Facade.java</code> (Service)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Facade</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Facade</span><span class="params">()</span> &#123;</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">1</span>, <span class="string">&quot;dan&quot;</span>, <span class="number">2000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">2</span>, <span class="string">&quot;alain&quot;</span>, <span class="number">4000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">3</span>, <span class="string">&quot;luc&quot;</span>, <span class="number">6000</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Map&lt;Integer, Compte&gt; comptes = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;Integer, Compte&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>&#123;</span><br><span class="line">    comptes.put(c.getNum(), c);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> comptes.values();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> comptes.get(num);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Compte introuvable&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    <span class="keyword">if</span> (c.getSolde() &lt; montant)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Solde insuffisant&quot;</span>);</span><br><span class="line">    c.setSolde(c.getSolde - montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    c.setSolde(c.getSolde + montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Controller.java</code> (servlet)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/Controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Controller</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="type">Facade</span> <span class="variable">facade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Facade</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (action.equals(<span class="string">&quot;consulter&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, num);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;compte&quot;</span>, facade.consulterCompte(num));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (action.equals(<span class="string">&quot;consulterTous&quot;</span>))&#123;</span><br><span class="line">         request.setAttribute(<span class="string">&quot;comptes&quot;</span>, facade.consulterComptes());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (action.equals(<span class="string">&quot;debit&quot;</span>) || action.equals(<span class="string">&quot;credit&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">montant</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;montant&quot;</span>));</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, num);</span><br><span class="line">        <span class="keyword">if</span> (action.equals(<span class="string">&quot;debit&quot;</span>)) &#123;</span><br><span class="line">          facade.debit(num, montant);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          facade.crebit(num, montant);</span><br><span class="line">        &#125;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      request.setAttribute(<span class="string">&quot;exception: &quot;</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;Banque.jsp&quot;</span>).forward(request, response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Banque.jsp</code> (View)</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></span><br><span class="line"><span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">		&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;form action=<span class="string">&quot;Controller&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">			&lt;table&gt;</span><br><span class="line"> 				&lt;tr&gt;</span><br><span class="line"> 					&lt;td&gt; Code :&lt;/td&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;&lt;/td&gt; </span><br><span class="line">          &lt;!-- $&#123;num&#125; EL表达式 = request.getAttribute(<span class="string">&quot;num&quot;</span>); --&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;consulter&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;consultertous&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 				&lt;/tr&gt;</span><br><span class="line"> 			&lt;/table&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;% <span class="keyword">if</span> (request.getAttribute(<span class="string">&quot;compte&quot;</span>) != <span class="literal">null</span>) &#123; %&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;table&gt;</span><br><span class="line"> 			&lt;tr&gt;&lt;td&gt; Num :&lt;/td&gt;&lt;td&gt;$&#123;compte.num&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line"> 			&lt;tr&gt;&lt;td&gt; Nom :&lt;/td&gt;&lt;td&gt;$&#123;compte.nom&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line"> 			&lt;tr&gt;&lt;td&gt; Solde :&lt;/td&gt;&lt;td&gt;$&#123;compte.solde&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line"> 		&lt;/table&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;form action=<span class="string">&quot;Controller&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line"> 			&lt;table&gt;</span><br><span class="line"> 				&lt;tr&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;montant&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;debit&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 					&lt;td&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;action&quot;</span> value=<span class="string">&quot;credit&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line"> 				&lt;/tr&gt;</span><br><span class="line"> 			&lt;/table&gt;</span><br><span class="line"> 		&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">		&lt;% &#125; %&gt;</span><br><span class="line">  	&lt;% Collection&lt;Compte&gt; l = (Collection&lt;Compte&gt;)request.getAttribute(<span class="string">&quot;comptes&quot;</span>);</span><br><span class="line"> 				<span class="keyword">if</span> (l != <span class="literal">null</span>) &#123;</span><br><span class="line">		%&gt;</span><br><span class="line">    </span><br><span class="line">		&lt;table border=<span class="string">&quot;1&quot;</span> width=<span class="string">&quot;80%&quot;</span>&gt;</span><br><span class="line">			&lt;tr&gt; &lt;th&gt;Num&lt;/th&gt;&lt;th&gt;Nom&lt;/th&gt;&lt;th&gt;Solde&lt;/th&gt;&lt;/tr&gt;</span><br><span class="line">			&lt;% <span class="keyword">for</span> (Compte c : l) &#123; %&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=c.getNum() %&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=c.getNom() %&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=c.getSolde() %&gt;&lt;/td&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">			&lt;% &#125; %&gt;</span><br><span class="line">		&lt;/table&gt;</span><br><span class="line">		&lt;% &#125; %&gt;</span><br><span class="line">    </span><br><span class="line">		$&#123;exception&#125;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="第三部分ejb"><a class="markdownIt-Anchor" href="#第三部分ejb"></a> 第三部分：EJB</h3>
<p>EBJ (Enterprise JavaBean) 运行在容器 (Container) 中。EJB 实际上就是一个封装了业务逻辑的 Java 类。</p>
<ul>
<li>EJB 支持分布式。分布式对象之间实现分布透明性，即在客户端代码中无需指定分布式对象的位置；</li>
<li>EJB 支持分布式对象之间的事物（RMI 不支持）</li>
<li>支持不同类型的客户端</li>
</ul>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 14.40.38.png" alt="2022-05-04 14.40.38" style="zoom:50%;">
<h4 id="session-bean"><a class="markdownIt-Anchor" href="#session-bean"></a> Session Bean</h4>
<p>Session Bean 可以<strong>执行业务逻辑操作</strong>，比如注册用户、订单登记等。在上级部分所讲的“三层结构”中位于<strong>业务逻辑层</strong>。</p>
<p>何为 Session？</p>
<p>从客户端获得 EJB 对象开始，多次调用 EJB 对象的方法，直到客户端生命周期结束，或客户端释放了 EJB 队象为止，称为一次会话 (Session)。与返回的 EJB 对象有关，如果不是同一个对象（内存地址不同），则不是同一个会话。</p>
<pre class="mermaid">sequenceDiagram
    participant c as Client
    participant ec as EJB容器
    participant eo as EJB对象
    
    c ->> ec :1. JNDI 查找 EJB对象
    ec ->> c :2. 返回 EJB对象1
    c ->> eo :3. 调用 EJB对象1 的方法
    c ->> eo :4. 调用 EJB对象1 的方法
    c ->> eo :5. 调用 EJB对象1 的方法
    Note over eo :以上操作均在一个 Session1 中
    
    Note over c :客户端生命周期结束
    
    c ->> ec :6. JNDI 查找 EJB对象
    ec ->> c :7. 返回 EJB对象2
    c ->> eo :8. 调用 EJB对象2 的方法
    c ->> eo :9. 调用 EJB对象2 的方法
    c ->> eo :10. 调用 EJB对象2 的方法
    Note over eo :以上操作均在一个 Session2 中</pre>
<h5 id="session-bean-的状态"><a class="markdownIt-Anchor" href="#session-bean-的状态"></a> Session Bean 的状态</h5>
<p>何为对象的状态？</p>
<p>对象的状态是由其实例变量（即成员变量）的值组成。</p>
<ul>
<li>实例变量：在不同的实例中，变量的值可以是不同的。非静态变量。</li>
<li>类变量：这个类的所有实例都一个值。<code>static</code> 变量</li>
</ul>
<h6 id="stateful-session-bean-有状态的-session-bean"><a class="markdownIt-Anchor" href="#stateful-session-bean-有状态的-session-bean"></a> Stateful Session Bean (有状态的 Session Bean)</h6>
<p>EJB 能够为同一个客户端在多次请求（方法调用）之间保持与其对应的状态信息</p>
<blockquote>
<p>从 HTTP Session 类比 Stateful Session Bean：</p>
</blockquote>
<table>
<thead>
<tr>
<th>客户动作</th>
<th>服务器响应</th>
</tr>
</thead>
<tbody>
<tr>
<td>1、打开浏览器</td>
<td></td>
</tr>
<tr>
<td>2、访问购物网站</td>
<td>3、创建 HTTP Session 对象</td>
</tr>
<tr>
<td></td>
<td>4、返回 jsessionid</td>
</tr>
<tr>
<td>5、将 jsessionid 写入 cookie</td>
<td></td>
</tr>
<tr>
<td>6、往购物车内添加商品</td>
<td></td>
</tr>
<tr>
<td>7、向系统提交商品信息，以及 jsessionid 的值</td>
<td>8、服务器根据 jsessionid 找到对应的 HTTP Session对象，同时，创建购物车对象，与 Session 绑定</td>
</tr>
<tr>
<td>9、 继续添加商品，或删除商品</td>
<td></td>
</tr>
<tr>
<td>10、每次向服务器提交数据的时候，都会带着一个 jsessionid 的信息</td>
<td>11、服务器通过 jsessionid 来辨认不同的客户端，以及维护这些客户端的状态信息</td>
</tr>
</tbody>
</table>
<p>EJB 实例池通过 Token 令牌区分不同的客户端，从而实现 Stateful Session Bean：</p>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-04 15.01.19.png" alt="2022-05-04 15.01.19" style="zoom:45%;">
<h6 id="stateless-session-bean-无状态的-session-bean"><a class="markdownIt-Anchor" href="#stateless-session-bean-无状态的-session-bean"></a> Stateless Session Bean (无状态的 Session Bean)</h6>
<p>是指 EJB 容器不会对 EJB 的状态进行管理。容器会使用实例池的方式，甚至单例 (Singleton) 的方式来实现无状态的 Session Bean。</p>
<blockquote>
<p>是否可以理解成：在有状态的 Session Bean 中，实例池不再根据 Token 区分不同的客户端？</p>
</blockquote>
<h6 id="singleton-session-bean-单例的-session-bean"><a class="markdownIt-Anchor" href="#singleton-session-bean-单例的-session-bean"></a> Singleton Session Bean (单例的 Session Bean)</h6>
<p>实例池中只有一个 EJB对象，不再对客户端的状态进行区别管理，而统一使用一个 EJB 对象</p>
<h4 id="客户端访问接口"><a class="markdownIt-Anchor" href="#客户端访问接口"></a> 客户端访问接口</h4>
<h5 id="remote-远程客户端接口"><a class="markdownIt-Anchor" href="#remote-远程客户端接口"></a> <code>@Remote</code> 远程客户端接口</h5>
<ul>
<li>客户端与其调用的 EJB 对象不在同一个 JVM 进程中；</li>
<li>可以是 web组件、应用客户端、或是其他的 EJB；</li>
<li>对于远程客户端来说，EJB 的位置是透明的；</li>
<li>为了创建一个可以被远程客户端访问的 EJB，需要用 <code>@Remote</code> 注解来定义这些 EJB</li>
</ul>
<h5 id="local-本地客户端接口"><a class="markdownIt-Anchor" href="#local-本地客户端接口"></a> <code>@Local</code> 本地客户端接口</h5>
<ul>
<li>客户端与其调用的 EJB 对象在同一个 JVM 进程中；</li>
<li>可以是 web组件、或是其他的 EJB；</li>
<li>为了创建一个可以被本地访问的 EJB，需要用 <code>@Local</code> 注解来定义这些 EJB</li>
<li>一个 EJB 可以同时被定义为 <code>@Remote</code> 和 <code>@Local</code></li>
</ul>
<h5 id="webmethod-客户端接口"><a class="markdownIt-Anchor" href="#webmethod-客户端接口"></a> <code>@webMethod</code> 客户端接口</h5>
<p>Web Service 客户端可以访问<strong>无状态 Session Bean</strong> 的接口，只有在业务逻辑方法被标识为 <code>@WebMethod</code> 的时候，Web Service 客户端才可以访问到。</p>
<h4 id="客户端访问方式"><a class="markdownIt-Anchor" href="#客户端访问方式"></a> 客户端访问方式</h4>
<h5 id="远程访问方式-remote-access"><a class="markdownIt-Anchor" href="#远程访问方式-remote-access"></a> 远程访问方式 (Remote Access)</h5>
<p>在进程间通行的时候需要将参数序列化和反序列化，传值。</p>
<pre class="mermaid">sequenceDiagram
    participant c as Client
    participant est as EJB Stub 客户端代理
    participant esk as EJB Skeleton 服务器代理
    participant j as JNDI 服务
    participant eo as EJB对象
    
    c ->> +j :1. JNDI lookup(查找) EJB对象
    j ->> -est :2. 创建
    est ->> c :3. 给客户端返回 stub 对象
    c ->> +est :4. 调用方法（参数）
    est ->> est :5. 将参数序列化
    est ->> -esk :6. 底层网络通信
    esk ->> esk :7. 将参数反序列化
    esk ->> eo :8. 调用相应的方法（参数）</pre>
<h5 id="本地访问方式-local-access"><a class="markdownIt-Anchor" href="#本地访问方式-local-access"></a> 本地访问方式 (Local Access)</h5>
<p>与远程访问方式相比，本地服务方式没有将参数序列化和反序列化的内容。可以直接访问地址（传址）</p>
<pre class="mermaid">sequenceDiagram
    participant c as Client
    participant est as EJB Stub 客户端代理
    participant esk as EJB Skeleton 服务器代理
    participant j as JNDI 服务
    participant eo as EJB对象
    
    c ->> +j :1. JNDI lookup(查找) EJB对象
    j ->> -est :2. 创建
    est ->> c :3. 给客户端返回 stub 对象
    c ->> +est :4. 调用方法（参数）
    est ->> -esk :5. 底层网络通信
    esk ->> eo :6. 调用相应的方法（参数）</pre>
<h5 id="客户端访问接口类型与访问方式"><a class="markdownIt-Anchor" href="#客户端访问接口类型与访问方式"></a> 客户端访问接口类型与访问方式</h5>
<pre class="mermaid">graph LR
subgraph "客户端接口"
远程客户端接口
本地客户端接口
WebService客户端接口
end
subgraph "访问方式"
Remote方式
Local方式
WebMethod方式
end
远程客户端接口 --- Remote方式
本地客户端接口 --- Remote方式
本地客户端接口 --- Local方式
WebService客户端接口 --- WebMethod方式</pre>
<h5 id="方法的参数和访问方式"><a class="markdownIt-Anchor" href="#方法的参数和访问方式"></a> 方法的参数和访问方式</h5>
<p>不同的访问方式 (Remote、Local、Web Service) 会影响到 EJB 方法的参数及其返回值。</p>
<h6 id="独立性"><a class="markdownIt-Anchor" href="#独立性"></a> 独立性</h6>
<ul>
<li>如果是远程调用，客户端操纵的 EJB 的参数，其实是一份<strong>参数值的拷贝</strong>。因此，对参数的修改，不会影响到EJB，</li>
<li>但是对于本地调用来说，客户端操纵的 EJB 的参数，就是一个直接引用，它对参数的修改，将会<strong>影响到  EJB</strong>。</li>
<li>所以，不管在哪种情况下，<strong>请避免修改参数的值</strong>！</li>
</ul>
<h6 id="粗粒度的数据访问"><a class="markdownIt-Anchor" href="#粗粒度的数据访问"></a> 粗粒度的数据访问</h6>
<p>因为远程调用的速度比较慢，所以在设计的时候，请尽量使用粗粒度的接口设计。即尽量减少方法的调用，并尽可能在一次方法调用中传输完毕所需要的数据！</p>
<h4 id="案例"><a class="markdownIt-Anchor" href="#案例"></a> 案例</h4>
<p>我们依旧沿用上一个部分的案例。</p>
<p><code>Compte.java</code> ( 实体类 )</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Compte</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;	<span class="comment">// 需要将其序列化</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">  <span class="keyword">private</span> String nom;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> solde;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">()</span> &#123;&#125; <span class="comment">// 空构造函数</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">(<span class="type">int</span> num, String nom, <span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.num;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNom</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.nom;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNom</span><span class="params">(String nom)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSolde</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.solde;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSolde</span><span class="params">(<span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    rerturn <span class="string">&quot;Compte [num=&quot;</span> + num + <span class="string">&quot;,nom=&quot;</span> + nom + <span class="string">&quot;,solde=&quot;</span> + solde + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="remote-远程客户端访问-和-local-本地客户端访问"><a class="markdownIt-Anchor" href="#remote-远程客户端访问-和-local-本地客户端访问"></a> <code>@Remote</code> 远程客户端访问 和 <code>@Local</code> 本地客户端访问</h5>
<p><code>&lt;interface&gt;: BankLocal</code> (本地访问接口)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Local</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BankLocal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>;</span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;interface&gt;: BankRemote</code> (远程访问接口)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Remote</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BankRemote</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>;</span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BankImpl.java</code> ( Facade/Service)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span> <span class="comment">// Or @Stateful, or @Stateless</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bankimpl</span> <span class="keyword">implements</span> <span class="title class_">BankLocal</span>, BankRemote &#123;</span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">1</span>, <span class="string">&quot;dan&quot;</span>, <span class="number">2000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">2</span>, <span class="string">&quot;alain&quot;</span>, <span class="number">4000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">3</span>, <span class="string">&quot;luc&quot;</span>, <span class="number">6000</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Map&lt;Integer, Compte&gt; comptes = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;Integer, Compte&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>&#123;</span><br><span class="line">    comptes.put(c.getNum(), c);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> comptes.values();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> comptes.get(num);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Compte introuvable&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    <span class="keyword">if</span> (c.getSolde() &lt; montant)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Solde insuffisant&quot;</span>);</span><br><span class="line">    c.setSolde(c.getSolde - montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    c.setSolde(c.getSolde + montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>RemoteClientEJB.java</code> (远程客户端app)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteClientEJB</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">appName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">moduleName</span> <span class="operator">=</span> <span class="string">&quot;jbbk&quot;</span>; <span class="comment">// project name</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">distinctName</span> <span class="operator">=</span> <span class="string">&quot;BankImpl&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">viewClassName</span> <span class="operator">=</span> BankRemote.class.getName();</span><br><span class="line">      <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">      <span class="type">String</span> <span class="variable">jndiName</span> <span class="operator">=</span> <span class="string">&quot;ejb:&quot;</span> + appName + <span class="string">&quot;/&quot;</span> + mouduleName + <span class="string">&quot;/&quot;</span> + distinctName + <span class="string">&quot;!&quot;</span></span><br><span class="line">        + viewClassName;</span><br><span class="line">      System.out.println(jndiName);	<span class="comment">// ejb:/jbbk/BankImpl!bk.BankRemote</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 远程获取 BankRemote 的代理</span></span><br><span class="line">      <span class="type">BankRemote</span> <span class="variable">bankStub</span> <span class="operator">=</span> (BankRemote) ctx.lookup(jndiName);</span><br><span class="line">      </span><br><span class="line">      Collection&lt;Compte&gt; comptes = bankStub.consulterComptes();</span><br><span class="line">      System.out.println(<span class="string">&quot;Print all the accounts(comptes).&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (Compte c:comptes) &#123;</span><br><span class="line">        System.out.println(c.toString);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Execption e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>jboss-ejb-client.properties</code> ( 为了客户端可以远程访问，配置 <code>JNDI</code> )</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">endpoint.name</span> = <span class="string">client-endpoint</span></span><br><span class="line"><span class="attr">remote.connectionprovider.create.org.xnio.Options.SSL_ENABLED</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">remote.connections</span> = <span class="string">default</span></span><br><span class="line"><span class="attr">remote.connections.default.host</span> = <span class="string">localhost</span></span><br><span class="line"><span class="attr">remote.connections.default.port</span> = <span class="string">8080</span></span><br></pre></td></tr></table></figure>
<h5 id="webmethod-客户端访问servlet"><a class="markdownIt-Anchor" href="#webmethod-客户端访问servlet"></a> <code>@WebMethod</code> 客户端访问：Servlet</h5>
<p><code>Controller.java</code> (以 <code>@WebServlet</code> 方式访问的客户端：Servlet)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/Controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Controller</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;	<span class="comment">// *</span></span><br><span class="line">  <span class="meta">@EJB</span>	<span class="comment">// * 服务器端的实现</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">BankImpl</span> <span class="variable">facade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Facade</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;action&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (action.equals(<span class="string">&quot;consulter&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, num);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;compte&quot;</span>, facade.consulterCompte(num));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (action.equals(<span class="string">&quot;consulterTous&quot;</span>))&#123;</span><br><span class="line">         request.setAttribute(<span class="string">&quot;comptes&quot;</span>, facade.consulterComptes());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (action.equals(<span class="string">&quot;debit&quot;</span>) || action.equals(<span class="string">&quot;credit&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">montant</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;montant&quot;</span>));</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, num);</span><br><span class="line">        <span class="keyword">if</span> (action.equals(<span class="string">&quot;debit&quot;</span>)) &#123;</span><br><span class="line">          facade.debit(num, montant);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          facade.crebit(num, montant);</span><br><span class="line">        &#125;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;num&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      request.setAttribute(<span class="string">&quot;exception: &quot;</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;Banque.jsp&quot;</span>).forward(request, response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;interface&gt;: BankRemote</code> (远程访问接口)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Remote</span></span><br><span class="line"><span class="meta">@WebService</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BankRemote</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>;</span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="meta">@WebMethod</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line">  <span class="meta">@WebMethod</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BankImpl.java</code> ( Facade/Service)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span> <span class="comment">// Or @Stateful, or @Stateless</span></span><br><span class="line"><span class="meta">@WebService(endpointInterface=&quot;bk.BankRemote&quot;, serviceName=&quot;BankWS&quot;)</span></span><br><span class="line"><span class="comment">// endpointInterface = &quot;name_of_interface.class&quot;</span></span><br><span class="line"><span class="comment">// serviceName = &quot;name_of_service_wanted&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bankimpl</span> <span class="keyword">implements</span> <span class="title class_">BankLocal</span>, BankRemote &#123;</span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">1</span>, <span class="string">&quot;dan&quot;</span>, <span class="number">2000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">2</span>, <span class="string">&quot;alain&quot;</span>, <span class="number">4000</span>));</span><br><span class="line">    addCompte(<span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">3</span>, <span class="string">&quot;luc&quot;</span>, <span class="number">6000</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Map&lt;Integer, Compte&gt; comptes = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;Integer, Compte&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCompte</span><span class="params">(Compte c)</span>&#123;</span><br><span class="line">    comptes.put(c.getNum(), c);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Collection&lt;Compte&gt; <span class="title function_">consulterComptes</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> comptes.values();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Compte <span class="title function_">consulterCompte</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> comptes.get(num);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Compte introuvable&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    <span class="keyword">if</span> (c.getSolde() &lt; montant)</span><br><span class="line">      <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Solde insuffisant&quot;</span>);</span><br><span class="line">    c.setSolde(c.getSolde - montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">credit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> montant)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">    <span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> consulterCompte(num);</span><br><span class="line">    c.setSolde(c.getSolde + montant);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第四部分jpa"><a class="markdownIt-Anchor" href="#第四部分jpa"></a> 第四部分：JPA</h3>
<p>JPA，Java持久化API：持久化 Bean 与普通的 Java Bean 无异，区别在于他们要用 EJB 的 Annotation 进行标记。</p>
<ul>
<li>一个实体类将其表示为 <code>@Entity</code>；</li>
<li>实体类必须有主键，一般用 <code>@Id</code> 标识；</li>
<li>在 <code>/META-INF/</code> 目录下，有 <code>persistence.xml</code> 文件，其主要作用是定义<u>实体类映射的相关配置信息</u>，比如指定数据源、都有哪些实体类、以及跟持久化相关的其它的一些属性。</li>
</ul>
<h4 id="entity-bean-实体类"><a class="markdownIt-Anchor" href="#entity-bean-实体类"></a> Entity Bean 实体类</h4>
<p>我们可以用 Entity Bean 实体类来记录数据，<u>每个实体类都关联一个数据库的表</u>。</p>
<h4 id="entity-bean-基本映射规则映射到数据库表"><a class="markdownIt-Anchor" href="#entity-bean-基本映射规则映射到数据库表"></a> Entity Bean 基本映射规则（映射到数据库表）</h4>
<p>（默认的表名和字段名与属性名一致）</p>
<ol>
<li>
<p>实体类和表的映射关系：</p>
<ul>
<li><code>@Entity</code>：声明<u>实体类</u>；</li>
<li><code>@Table(name=&quot;数据库表的名称&quot;)</code>：配置<u>实体类和表的映射关系</u></li>
</ul>
</li>
<li>
<p>实体类中属性和数据库表中字段的映射关系：</p>
<ul>
<li><code>@Id</code>：声明主键的配置</li>
<li><code>@GeneratedValue(strategy)</code>：配置<u>主键的生成策略</u>
<ul>
<li><code>strategy = GenerationType.IDENTITY</code>：id主键自增</li>
<li><code>strategy = GenerationType.AUTO</code>：缺省，默认方式</li>
<li><code>strategy = GenerationType.SEQUENCE</code>：通过序列生产主键，与 <code>@SequenceGenerator</code> 配合使用</li>
<li><code>strategy = GenerationType.TABLE</code>：通过其他表生成主键</li>
</ul>
</li>
<li><code>@Column(name=&quot;数据库表中字段的名称&quot;)</code>：配置属性和数据库表中<u>字段的映射</u>关系
<ul>
<li><code>name = &quot;数据库表中字段的名称&quot;</code> ;</li>
<li><code>unique = true/false</code>：是否唯一；</li>
<li><code>nullable = true/false</code>：是否可空；</li>
<li><code>length = 字段长度</code>；</li>
</ul>
</li>
<li><code>@Basic</code>：默认<u>缺省</u>，所有配置全部设为<u>默认</u></li>
<li><code>@Transient</code>：该属性<u>不需要映射为数据库表的字段</u>；</li>
<li><code>@Temporal(TemporalType)</code>：定义 <code>Date</code> 类型的精度
<ul>
<li><code>TemporalType.DATE</code>：<code>年-月-日</code></li>
<li><code>TemporalType.TIME</code>：<code>时:分:秒</code></li>
<li><code>TemporalType.TIMESTAMP</code>：<code>年-月-日 时:分:秒</code></li>
</ul>
</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Compte</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;	<span class="comment">// 需要将其序列化</span></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratetdValue(strategy=GenerationType.IDENTITY)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">  <span class="keyword">private</span> String nom;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> solde;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">()</span> &#123;&#125; <span class="comment">// 空构造函数</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Compte</span><span class="params">(<span class="type">int</span> num, String nom, <span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.num;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.num = num;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNom</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.nom;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNom</span><span class="params">(String nom)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.nom = nom;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSolde</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.solde;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSolde</span><span class="params">(<span class="type">int</span> solde)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.solde = solde;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    rerturn <span class="string">&quot;Compte [num=&quot;</span> + num + <span class="string">&quot;,nom=&quot;</span> + nom + <span class="string">&quot;,solde=&quot;</span> + solde + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ol>
<h4 id="entitymanager-实体类管理器"><a class="markdownIt-Anchor" href="#entitymanager-实体类管理器"></a> <code>EntityManager</code> 实体类管理器</h4>
<p>在 JPA 规范中，EntityManager是真正对数据库操作的对象。</p>
<p>实体作为普通 Java 对象，只有在调用EntityManager 将其持久化后才会变成持久化对象。EntityManager对象在一组实体类与底层数据源之间进行 O/R  映射的管理。它可以用来管理和更新 Entity Bean，根椐主键查找 Entity Bean，还可以通过 JPQL 语句查询实体。</p>
<h5 id="实体的状态"><a class="markdownIt-Anchor" href="#实体的状态"></a> 实体的状态：</h5>
<ul>
<li>新建状态：新创建的对象，<u>尚未拥有持久性主键</u>。</li>
<li>持久化状态：已经拥有持久性主键并<u>和持久化建立了上下文环境</u></li>
<li>游离状态 ：拥有持久化主键，但是<u>没有与持久化建立上下文环境</u></li>
<li>删除状态：拥有持久化主键，已经和持久化建立上下文环境，但是<u>从数据库中删除</u></li>
</ul>
<h5 id="entitymanager-方法"><a class="markdownIt-Anchor" href="#entitymanager-方法"></a> <code>EntityManager</code> 方法</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PersistenceContext</span></span><br><span class="line"><span class="keyword">private</span> EntityManager em;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>find()</code>：根据id查找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> num;	<span class="comment">// 主键</span></span><br><span class="line"><span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> em.find(Compte.class, num);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>getReference()</code>：根据id查找，先返回实体对象的代理，在使用代理对象前关闭 EntityManager 会出现懒加载异常 <code>LazyInitializationException</code>。</p>
</li>
<li>
<p><code>presist()</code>：保存 (<code>INSERT</code>)，使对象由临时状态变为持久化状态。如果实体类有主键，在 <code>presist()</code>会抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="literal">null</span>, <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;200&quot;</span>);	<span class="comment">// 自动分配主键</span></span><br><span class="line">em.presist(c);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>merge()</code>：更新 <code>UPDATE or INSERT</code></p>
<ul>
<li>
<p>如传入的是一个<u>临时对象</u>（无主键id），会先<u>创建一个新的对象</u>（有主键），把临时对象的<u>属性复制到新对象</u>中，再对这个<u>新对象 <code>INSERT</code> 数据库持久化操作</u>。所以新对象有主键，而临时对象没有主键。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="literal">null</span>, <span class="string">&quot;theo&quot;</span>, <span class="string">&quot;1000&quot;</span>);	<span class="comment">// 自动分配主键</span></span><br><span class="line"><span class="type">Compte</span> <span class="variable">c_temp</span> <span class="operator">=</span> em.merge(c);</span><br><span class="line"><span class="comment">// c.getNum(); -&gt; null		c_temp.getNum(); -&gt; JPA 按照策略分配的 #Id 的值</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果传入的是一个<u>游离对象</u>（有主键id），若 <u>EntityManager 缓存中<strong>没有</strong>该对象</u>、且<u>数据库中也<strong>没有</strong>相应的记录</u>，JPA 则会先<u>创建一个新的对象</u>，把游离对象的<u>属性复制到新对象</u>中，再对这个<u>新对象 <code>INSERT</code> 数据库持久化操作</u>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="number">100</span>, <span class="string">&quot;enzo&quot;</span>, <span class="string">&quot;1000&quot;</span>);	<span class="comment">// 自动分配主键</span></span><br><span class="line"><span class="type">Compte</span> <span class="variable">c_temp</span> <span class="operator">=</span> em.merge(c);</span><br><span class="line"><span class="comment">// c.getNum(); -&gt; 100		c_temp.getNum(); -&gt; 4</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果传入的是一个游离对象（有主键id），若 <u>EntityManager 缓存中没有该对象</u>，但<u>数据库中有相应的记录</u>，JPA 则会<u>查询相应记录</u>后<u>返回该记录的一个对象</u>，把<u>游离对象的属性复制到查询对象</u>中，再对这个<u>查询对象 <code>UPDATE</code> 数据库持久化操作</u>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Compte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Compte</span>(<span class="literal">null</span>, <span class="string">&quot;enzo&quot;</span>, <span class="string">&quot;500&quot;</span>);	<span class="comment">// 自动分配主键</span></span><br><span class="line">c.setNum(<span class="number">4</span>);</span><br><span class="line"><span class="type">Compte</span> <span class="variable">c_temp</span> <span class="operator">=</span> em.merge(c);</span><br><span class="line"><span class="comment">// c.toString(); -&gt; Compte [num=4, nom=enzo, solde=500]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><code>remove()</code>：删除</p>
</li>
<li>
<p><code>flush()</code>：同步数据表的记录和内存中对象的状态</p>
<ul>
<li><code>setFlushMode(FlushModeType.AUTO)</code>：自动同步到数据库</li>
<li><code>setFlushMode(FlushModeType.COMMIT)</code>：直到事物提交时才同步到数据库</li>
<li><code>getFlushMode</code></li>
</ul>
</li>
<li>
<p><code>transaction = em.getTransaction()</code>：获取事务对象</p>
<ul>
<li><code>transaction.begin();</code></li>
<li><code>transaction.commit();</code></li>
<li><code>transaction.rollback();</code></li>
</ul>
</li>
</ul>
<h4 id="映射关联关系"><a class="markdownIt-Anchor" href="#映射关联关系"></a> 映射关联关系</h4>
<h5 id="manytoone-单向多对一关联映射"><a class="markdownIt-Anchor" href="#manytoone-单向多对一关联映射"></a> <code>@ManyToOne</code> 单向多对一关联映射</h5>
<p>在单向多对一的关联映射里，在“多”的一端添加一个外键 (Foreign Key) 指向“一”的一端，而且可以指定字段名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">  <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;client_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">// constructors, setters, getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;account_amount&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span>							<span class="comment">// @ManyToOne 多对一映射关系</span></span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;client_ID&quot;)</span>	<span class="comment">// 使用 @JoinColumn 来映射外键，name为新建外键列的列名</span></span><br><span class="line">  <span class="keyword">private</span> Client client;	<span class="comment">// 多个账户可以对应一个客户</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 19.57.54.png" alt="2022-05-05 19.57.54" style="zoom:50%;">
<h5 id="onetomany-一对多关联映射"><a class="markdownIt-Anchor" href="#onetomany-一对多关联映射"></a> <code>@OneToMany</code> 一对多关联映射</h5>
<ul>
<li><code>@OneToMany(fetch=FetchType.xxx)</code>：修改默认加载策略，默认懒加载 (<code>LAZY</code>)；(<code>EAGER</code>)</li>
<li><code>@OneToMany(cascade=CascadeType.remove)</code>：
<ul>
<li>默认情况下，若删除“一”的一端，会先将“一”的一端中<u>关联“多”的外键置空</u>，然后删除</li>
<li>可以通过 <code>@OneToMany</code> 的 <code>cascade</code> 属性来修改默认的删除策略</li>
<li><code>CascadeType.PERSIST （级联新建）</code></li>
<li><code>CascadeType.REMOVE （级联删除）</code></li>
<li><code>CascadeType.REFRESH （级联刷新）</code></li>
<li><code>CascadeType.MERGE （级联更新）中选择一个或多个</code></li>
<li><code>还有一个选择是使用CascadeType.ALL ，表示选择全部四项</code></li>
</ul>
</li>
</ul>
<h6 id="一对多u单向u关联映射"><a class="markdownIt-Anchor" href="#一对多u单向u关联映射"></a> 一对多<u>单向</u>关联映射：</h6>
<p>一对多<u>单向</u>关联映射 有两个映射策略，即 <u>外键关联</u> 和 <u>表关联</u></p>
<ul>
<li><u>外键</u>关联：会创建一个<u>外键</u> ，用<u>外键</u>记录 <code>Client</code> 和 <code>Account</code> 之间的<u>单向关联</u>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;client_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;client_ID&quot;)</span>	<span class="comment">// 使用 @JoinColumn 来映射外键，name为新建外键列的列名</span></span><br><span class="line">  <span class="meta">@OneToMany</span>											<span class="comment">// @OneToMany 一对多映射关系</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Account&gt; accounts;	<span class="comment">// 集合属性：一个客户可以对应多个账户</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;account_amount&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// private Client client;	// 因为是单向的，所以不能 Account 类里不能有 Client 类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 19.57.54.png" alt="2022-05-05 19.57.54" style="zoom:50%;">
<ul>
<li><u>表</u>关联：会创建一个<u>中间表</u> ，用<u>中间表</u>记录 <code>Client</code> 和 <code>Account</code> 之间的<u>单向关联</u>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;client_Name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@JoinTable(name=&quot;t_Client_Account&quot;,</span></span><br><span class="line"><span class="meta">          joinColumn=&#123;@JoinColumn(name=&quot;client_ID&quot;,referencedColumnName=&quot;ID&quot;)&#125;,</span></span><br><span class="line"><span class="meta">          inverseJoinColumn=&#123;@JoinColumn(name=&quot;account_ID&quot;,referencedColumnName=&quot;ID&quot;)&#125;</span></span><br><span class="line"><span class="meta">  @OneToMany											// @OneToMany 一对多映射关系</span></span><br><span class="line"><span class="meta">  private Set&lt;Account&gt; accounts;	// 集合属性：一个客户可以对应多个账户</span></span><br><span class="line"><span class="meta">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;account_amount&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// private Client client;	// 因为是单向的，所以不能 Account 类里不能有 Client 类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 20.44.11.png" alt="2022-05-05 20.44.11" style="zoom:50%;">
<h6 id="一对多u双向u关联映射"><a class="markdownIt-Anchor" href="#一对多u双向u关联映射"></a> 一对多<u>双向</u>关联映射：</h6>
<p>一对多<u>双向</u>关联映射 = 多对一<u>双向</u>关联映射</p>
<p>没有中间表，但会在“多”的一端加入一个外键，两端的外键名保持一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;client_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 在“一”的一端定义mappedBy，即映射规则由对方决定; 在使用这种属性时，则不能用@JoinColumn属性</span></span><br><span class="line">  <span class="meta">@OneToMany(mappedBy=client)</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Account&gt; accounts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="meta">@Column(name=&quot;account_amount&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;client_ID&quot;)</span>	<span class="comment">// 使用 @JoinColumn 来映射外键，两端的外键名保持一致</span></span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="keyword">private</span> Client client;	<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 19.57.54.png" alt="2022-05-05 19.57.54" style="zoom:50%;">
<h5 id="onetoone-一对一双向关联映射"><a class="markdownIt-Anchor" href="#onetoone-一对一双向关联映射"></a> <code>@OneToOne</code> 一对一双向关联映射</h5>
<p>有两种策略：<u><strong>主键(Primary Key)关联</strong></u> 和 <strong><u>唯一外键(Foreign Key)关联</u></strong></p>
<h6 id="主键关联"><a class="markdownIt-Anchor" href="#主键关联"></a> 主键关联</h6>
<p>一端的主键 (<code>@Id</code>) 依赖于另一端的主键 (<code>@Id</code>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Manager</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;manager_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String managerName;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span></span><br><span class="line">  <span class="meta">@PrimaryKeyJoinColumn</span></span><br><span class="line">  <span class="keyword">private</span> CustomerNum customerNum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;department_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String DepartmentName;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne(mappedBy=&quot;m_ID&quot;)</span></span><br><span class="line">  <span class="comment">// 在双键关联中只需要定义一方的映射规则，另外一方遵守已经定义一方的映射规则；</span></span><br><span class="line">  <span class="comment">// mappedBy = 对方指向我自身的 *属性名称*</span></span><br><span class="line">  <span class="keyword">private</span> Customer customer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 21.07.25.png" alt="2022-05-05 21.07.25" style="zoom:50%;">
<h6 id="唯一外键关联"><a class="markdownIt-Anchor" href="#唯一外键关联"></a> 唯一外键关联</h6>
<ul>
<li>使用 <code>@OneToOne</code> 来映射一对一关联关系；</li>
<li>若需要在当前表中添加外键，则需要使用 <code>@JoinColumn(unique=true)</code> 来映射</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Manager</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;manager_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String managerName;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 对于没有外键的一方，建议设置 mappedBy=true</span></span><br><span class="line">  <span class="meta">@OneToOne(mappedBy=&quot;manager&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> Department department</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;department_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String DepartmentName;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn(name=&quot;manager_ID&quot;, unique=true)</span></span><br><span class="line">  <span class="comment">// 在双键关联中只需要定义一方的外键映射规则，另外一方遵守已经定义一方的映射规则；</span></span><br><span class="line">  <span class="comment">// 需要使用 @JoinColumn(unique=true) 来添加外键映射 </span></span><br><span class="line">  <span class="keyword">private</span> Manager manager</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 21.07.25.png" alt="2022-05-05 21.07.25" style="zoom:50%;">
<h5 id="manytomany-多对多关联映射"><a class="markdownIt-Anchor" href="#manytomany-多对多关联映射"></a> <code>@ManyToMany</code> 多对多关联映射</h5>
<p>​	通过新建一个<u>中间表</u>，达到多对多的关联映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GenerateValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;item_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@JoinTable(	// 映射中间表</span></span><br><span class="line"><span class="meta">    name=&quot;t_Item_Category&quot;,	// 中间表的名字</span></span><br><span class="line"><span class="meta">    joinColumns=&#123;	// 映射当前类所在的表 在中间表中的外键</span></span><br><span class="line"><span class="meta">      	@JoinColumn(name=&quot;item_ID&quot;,	// 当前表在中间表中的 外键列的列名</span></span><br><span class="line"><span class="meta">                 referencedColumnName=&quot;ID&quot;)&#125;,	// 指定外键关联当前表的哪一列（可缺省）</span></span><br><span class="line"><span class="meta">  	inverseJoinColumns=&#123;	// 映射关联的类 在 中间表 中的 外键</span></span><br><span class="line"><span class="meta">      	@JoinColumn(name=&quot;category_ID&quot;,	// 对方表在中间表中 外键列的列名</span></span><br><span class="line"><span class="meta">                       referenceColumnName=&quot;ID&quot;)&#125;)</span>	<span class="comment">// 指定外键关联对方表的哪一列（可缺省）</span></span><br><span class="line">  <span class="meta">@ManyToMany</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Category&gt; categorys</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;</span><br><span class="line">  <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(name=&quot;category_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToMany(mappedBy=&quot;categorys&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Item&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2022-05-05 21.22.35.png" alt="2022-05-05 21.22.35" style="zoom:50%;">
<h4 id="jpql"><a class="markdownIt-Anchor" href="#jpql"></a> JPQL</h4>
<p>JPQL 语言，即 Java Persistence Query Language 的简称。</p>
<p>JPQL 是一种和 SQL 非常类似的中间性和对象化查询语言，它查询的内容是<u>实体类和类中的属性</u>。它最终会被编译成针对不同底层数据库的 SQL查询，从而屏蔽不同数据库的差异。</p>
<p>JPQL 语言的语句可以是 <code>select</code> 语句，<code>update</code> 语句或 <code>delete</code>语句，它们都通过 Query 接口封装执行。调用 <code>EntityManager</code> 的 <code>createQuery()</code>、<code>createNamedQuery()</code>、<code>createNativeQuery()</code> 以获得查询对象，进而可调用 Query 接口的相关方法来执行查询操作</p>
<p>例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Collection&lt;Orders&gt; <span class="title function_">searchByAge</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;FROM Customer c WHERE c.age &gt; ?&quot;</span>; <span class="comment">// ?是参数的占位符</span></span><br><span class="line">  <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> em.createQuery(jpql);</span><br><span class="line">  <span class="comment">// 占位符索引从1开始</span></span><br><span class="line">  <span class="comment">// query.setParameter(第几个占位符, 参数的值)</span></span><br><span class="line">  query.setParameter(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">  Collection&lt;Customer&gt; result = (Collection&lt;Customer&gt;) query.getResultList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>SELECT-FROM</code> 子句：<code>select</code> 用于指定返回的结果实体或实体的某些属性；<code>from</code> 子句声明查询源实体类，并指定标识符变量（相当于 SQL 表的别名）。如果不希望返回重复实体，可以使用关键字 <code>distinct</code>。</p>
<ul>
<li><code>FROM Orders WHERE o.id=:o_id</code> 当查询整个实体类时可省略 <code>select *</code></li>
</ul>
</li>
<li>
<p><code>WHERE</code> 子句：用于指定查询条件，</p>
<ul>
<li><code>SELECT o FROM Orders o WHERE o.id =:o_id</code></li>
<li><code>SELECT o FROM Orders o WHERE o.id &gt; 4</code></li>
</ul>
</li>
<li>
<p><code>GROUP BY</code> 子句：用于对查询结果分组统计，通常需要使用聚合函数，如 <code>AVG, SUM, COUNT, MAX, MIN</code>等</p>
<ul>
<li><code>SELECT MAX(o.id) FROM Orders o</code></li>
</ul>
</li>
<li>
<p><code>ORDER BY</code> 子句：用于对查询结果进行排序，<code>ASC</code> 升序，<code>DESC</code> 降序</p>
<ul>
<li><code>SELECT o FROM Orders ORDER BY o.id DESC</code></li>
</ul>
</li>
<li>
<p><code>UPDATE</code> 子句：用于执行数据的更新操作。主要针对于单个实体类的更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE Order o SET o.age = ? WHERE o.id = ?&quot;</span>;</span><br><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> em.creatQuery(jpql);</span><br><span class="line">query.setParameter(<span class="number">1</span>,<span class="number">25</span>);</span><br><span class="line">query.setParameter(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">query.executeUpdate();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>DELETE</code> 子句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;DELETE Order o WHERE o.id = ?&quot;</span>;</span><br><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> em.creatQuery(jpql);</span><br><span class="line">query.setParameter(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">query.executeUpdate();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当然还有很多其他的用法，但在此我们不作深究。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://lostnfound.top">Guohao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lostnfound.top/2022/05/03/Appli-Web%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">https://lostnfound.top/2022/05/03/Appli-Web课程笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lostnfound.top" target="_blank">Lost N Found</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a></div><div class="post_share"><div class="social-share" data-image="/linear-gradient(45deg,%20#8EC3B0,%20#9ED5C5,%20#F8C4B4,%20#FF8787)" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Guohao</div><div class="author-info__description">L’existence précède l‘essence</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Dave0126" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dave980126@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86introduction"><span class="toc-text"> 第一部分：Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B8%A6%E6%9C%89-uriurnurl-%E7%9A%84%E6%96%87%E4%BB%B6%E7%9A%84%E6%8C%87%E5%AE%9A%E5%92%8C%E4%BD%8D%E7%BD%AE"><span class="toc-text"> 1. 带有 URI&#x2F;URN&#x2F;URL 的文件的指定和位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-html-%E5%92%8C-css-%E8%AF%AD%E8%A8%80%E5%AF%B9%E6%96%87%E6%A1%A3%E8%BF%9B%E8%A1%8C%E7%BC%96%E7%A0%81"><span class="toc-text"> 2. 使用 HTML 和 CSS 语言对文档进行编码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#html"><span class="toc-text"> HTML</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#css"><span class="toc-text"> CSS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%92%8C-web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE-http"><span class="toc-text"> 3. 浏览器和 Web 服务器之间的通信协议 (HTTP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#http-%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text"> HTTP 请求数据格式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#http-%E7%9A%84%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-text"> HTTP 的请求方法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#http-%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text"> HTTP 响应数据格式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#http-%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text"> HTTP 状态码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-http-%E8%A1%A8%E5%8D%95-formulaire"><span class="toc-text"> 4. HTTP 表单 (formulaire)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#get%E4%B8%8E-post%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="toc-text"> get与 post的差别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0input"><span class="toc-text"> 表单元素：input</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84-input-%E6%A0%87%E7%AD%BE"><span class="toc-text"> 常见的 input 标签:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-cgi%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text"> 5. CGI的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-http-cookies"><span class="toc-text"> 6. HTTP Cookies</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E6%88%90"><span class="toc-text"> 组成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5"><span class="toc-text"> 第二部分：动态网页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21-servlet"><span class="toc-text"> 2.1 Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#request-%E5%92%8C-response"><span class="toc-text"> Request 和 Response</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#request-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="toc-text"> Request 获取请求数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#response-%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-text"> Response 设置响应数据</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cookie"><span class="toc-text"> Cookie</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#session"><span class="toc-text"> Session</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-jsp"><span class="toc-text"> 2.2 JSP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#jsp-%E5%8E%9F%E7%90%86"><span class="toc-text"> JSP 原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jsp-%E8%84%9A%E6%9C%AC-scriptlet"><span class="toc-text"> JSP 脚本 (Scriptlet)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jsp-%E7%9A%84%E6%8C%87%E4%BB%A4%E6%A0%87%E7%AD%BE"><span class="toc-text"> JSP 的指令标签</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-mvc-%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 2.3 MVC 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84"><span class="toc-text"> 三层架构：软件设计架构</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#24-%E6%A1%88%E4%BE%8B"><span class="toc-text"> 2.4 案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86ejb"><span class="toc-text"> 第三部分：EJB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#session-bean"><span class="toc-text"> Session Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#session-bean-%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-text"> Session Bean 的状态</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#stateful-session-bean-%E6%9C%89%E7%8A%B6%E6%80%81%E7%9A%84-session-bean"><span class="toc-text"> Stateful Session Bean (有状态的 Session Bean)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#stateless-session-bean-%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84-session-bean"><span class="toc-text"> Stateless Session Bean (无状态的 Session Bean)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#singleton-session-bean-%E5%8D%95%E4%BE%8B%E7%9A%84-session-bean"><span class="toc-text"> Singleton Session Bean (单例的 Session Bean)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 客户端访问接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#remote-%E8%BF%9C%E7%A8%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-text"> @Remote 远程客户端接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#local-%E6%9C%AC%E5%9C%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-text"> @Local 本地客户端接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webmethod-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-text"> @webMethod 客户端接口</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="toc-text"> 客户端访问方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F-remote-access"><span class="toc-text"> 远程访问方式 (Remote Access)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F-local-access"><span class="toc-text"> 本地访问方式 (Local Access)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B%E4%B8%8E%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="toc-text"> 客户端访问接口类型与访问方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0%E5%92%8C%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="toc-text"> 方法的参数和访问方式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%80%A7"><span class="toc-text"> 独立性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%B2%97%E7%B2%92%E5%BA%A6%E7%9A%84%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-text"> 粗粒度的数据访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text"> 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#remote-%E8%BF%9C%E7%A8%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE-%E5%92%8C-local-%E6%9C%AC%E5%9C%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-text"> @Remote 远程客户端访问 和 @Local 本地客户端访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webmethod-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AEservlet"><span class="toc-text"> @WebMethod 客户端访问：Servlet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86jpa"><span class="toc-text"> 第四部分：JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#entity-bean-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text"> Entity Bean 实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#entity-bean-%E5%9F%BA%E6%9C%AC%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99%E6%98%A0%E5%B0%84%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text"> Entity Bean 基本映射规则（映射到数据库表）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#entitymanager-%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-text"> EntityManager 实体类管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-text"> 实体的状态：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#entitymanager-%E6%96%B9%E6%B3%95"><span class="toc-text"> EntityManager 方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-text"> 映射关联关系</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#manytoone-%E5%8D%95%E5%90%91%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> @ManyToOne 单向多对一关联映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onetomany-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> @OneToMany 一对多关联映射</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9Au%E5%8D%95%E5%90%91u%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> 一对多单向关联映射：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9Au%E5%8F%8C%E5%90%91u%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> 一对多双向关联映射：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onetoone-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%8F%8C%E5%90%91%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> @OneToOne 一对一双向关联映射</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E5%85%B3%E8%81%94"><span class="toc-text"> 主键关联</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E5%A4%96%E9%94%AE%E5%85%B3%E8%81%94"><span class="toc-text"> 唯一外键关联</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#manytomany-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> @ManyToMany 多对多关联映射</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jpql"><span class="toc-text"> JPQL</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: #8EC3B0"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By Guohao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'ea138c6f176d57705144',
      clientSecret: 'c999d74b366c68c80bc3b704c716a8ff8d67af6d',
      repo: 'Dave0126.github.io',
      owner: 'Dave0126',
      admin: ['Dave0126'],
      id: 'b4e60ccacfd32aa8b9406a86d7099638',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div></div></body></html>