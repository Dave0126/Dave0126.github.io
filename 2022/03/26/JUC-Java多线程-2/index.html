<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dave0126.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹è§†é¢‘è¯¾ç¨‹: BiliBili - é»‘é©¬ç¨‹åºå‘˜Javaå¹¶å‘ç¼–ç¨‹ JUC ç¬”è®°å‚è€ƒ: Javaå¹¶å‘ - Nyimaâ€™s Blog  æ³¨ï¼šæœ¬è¯¾ç¨‹ç¬”è®°åŸºäºJDK8ï¼Œé‡‡ç”¨lsf4jæ‰“å°æ—¥å¿—">
<meta property="og:type" content="article">
<meta property="og:title" content="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (äºŒ)">
<meta property="og:url" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/index.html">
<meta property="og:site_name" content="Lost N Found">
<meta property="og:description" content="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹è§†é¢‘è¯¾ç¨‹: BiliBili - é»‘é©¬ç¨‹åºå‘˜Javaå¹¶å‘ç¼–ç¨‹ JUC ç¬”è®°å‚è€ƒ: Javaå¹¶å‘ - Nyimaâ€™s Blog  æ³¨ï¼šæœ¬è¯¾ç¨‹ç¬”è®°åŸºäºJDK8ï¼Œé‡‡ç”¨lsf4jæ‰“å°æ—¥å¿—">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144636.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144649.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144702.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144917.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144942.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144950.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144957.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220326175731138-8313862.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144957.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145004.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145148.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145101.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144917.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327195520317-8403730.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327202425832-8405470.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327204404520-8406649.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145250.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145303.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145313.png">
<meta property="og:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144621-8409900.png">
<meta property="article:published_time" content="2022-03-26T14:38:56.000Z">
<meta property="article:modified_time" content="2022-03-27T19:52:06.407Z">
<meta property="article:author" content="Guohao">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JUC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144636.png">

<link rel="canonical" href="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (äºŒ) | Lost N Found</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lost N Found" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lost N Found</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Dave0126" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guohao">
      <meta itemprop="description" content="é—´æ­‡æ€§è¸Œèº‡æ»¡å¿—, æŒç»­æ€§åˆ’æ°´æ‘¸é±¼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lost N Found">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (äºŒ)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-03-26 15:38:56" itemprop="dateCreated datePublished" datetime="2022-03-26T15:38:56+01:00">2022-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-03-27 21:52:06" itemprop="dateModified" datetime="2022-03-27T21:52:06+02:00">2022-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JUC/" itemprop="url" rel="index"><span itemprop="name">JUC</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>17 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Java-å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#Java-å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹"></a>Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹</h2><p>è§†é¢‘è¯¾ç¨‹: <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16J411h7Rd?p=50">BiliBili - é»‘é©¬ç¨‹åºå‘˜Javaå¹¶å‘ç¼–ç¨‹ JUC</a></p>
<p>ç¬”è®°å‚è€ƒ: <a target="_blank" rel="noopener" href="https://nyimac.gitee.io/2020/06/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">Javaå¹¶å‘ - Nyimaâ€™s Blog</a></p>
<ul>
<li>æ³¨ï¼šæœ¬è¯¾ç¨‹ç¬”è®°åŸºäºJDK8ï¼Œé‡‡ç”¨lsf4jæ‰“å°æ—¥å¿—</li>
</ul>
<span id="more"></span>

<h3 id="3-å…±äº«æ¨¡å‹-ä¹‹-ç®¡ç¨‹"><a href="#3-å…±äº«æ¨¡å‹-ä¹‹-ç®¡ç¨‹" class="headerlink" title="3 å…±äº«æ¨¡å‹ ä¹‹ ç®¡ç¨‹"></a>3 å…±äº«æ¨¡å‹ ä¹‹ ç®¡ç¨‹</h3><h4 id="3-1-å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#3-1-å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="3.1 å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>3.1 å…±äº«å¸¦æ¥çš„é—®é¢˜</h4><p>JAVAä»£ç ä¸­çš„ä½“ç°</p>
<p>ä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º0çš„å…¨å±€é™æ€å˜é‡, ä¸€ä¸ªåšè‡ªå¢æ“ä½œ, ä¸€ä¸ªåšè‡ªå‡æ“ä½œ, å„æ‰§è¡Œ5000æ¬¡, æœ€ç»ˆçš„ç»“æœæ˜¯0å—?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;<span class="number">5000</span>; i++)&#123;</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;<span class="number">5000</span>; i++)&#123;</span><br><span class="line">      counter--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  t1.start();</span><br><span class="line">  t2.start();</span><br><span class="line">  t1.join();</span><br><span class="line">  t2.join();</span><br><span class="line">  </span><br><span class="line">  Log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, counter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æœå¤§æ¦‚ç‡ä¸ä¸º<code>0</code></p>
<pre class="mermaid">sequenceDiagram
    participant çº¿ç¨‹1
    participant çº¿ç¨‹2
    participant é™æ€å˜é‡ i
    
    é™æ€å˜é‡ i ->> çº¿ç¨‹2 :getstatic i è¯»å–0
    çº¿ç¨‹2 ->> çº¿ç¨‹2 :iconst_1 å‡†å¤‡å¸¸æ•° 1
    çº¿ç¨‹2 ->> çº¿ç¨‹2 :isub å‡æ³•, çº¿ç¨‹å†… i= -1
    çº¿ç¨‹2 -x é™æ€å˜é‡ i :!!!è¿˜æ²¡æ¥å¾—åŠå°†içš„ç»“æœå†™å…¥
    çº¿ç¨‹2 -->> çº¿ç¨‹1 :ä¸Šä¸‹æ–‡åˆ‡æ¢
    çº¿ç¨‹1 ->> çº¿ç¨‹1 :iconst_1 å‡†å¤‡å¸¸æ•° 1
    çº¿ç¨‹1 ->> çº¿ç¨‹1 :iadd åŠ æ³•, çº¿ç¨‹å†… i= 1
    çº¿ç¨‹1 ->> é™æ€å˜é‡ i :putstatic i å†™å…¥ 1
    çº¿ç¨‹1 -->> çº¿ç¨‹2 :ä¸Šä¸‹æ–‡åˆ‡æ¢
    çº¿ç¨‹2 ->> é™æ€å˜é‡ i :putstatic i å†™å…¥ -1</pre>

<p>æœ€ç»ˆç»“æœä¸º<code>-1</code>.</p>
<h5 id="3-1-1-ä¸´ç•ŒåŒº-Critical-Section"><a href="#3-1-1-ä¸´ç•ŒåŒº-Critical-Section" class="headerlink" title="3.1.1 ä¸´ç•ŒåŒº Critical Section"></a>3.1.1 ä¸´ç•ŒåŒº Critical Section</h5><ul>
<li>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</li>
<li>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº<ul>
<li>å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æºå…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜</li>
<li>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜</li>
</ul>
</li>
<li>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// ä¸´ç•Œèµ„æº</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> </span><br><span class="line"><span class="comment">// ä¸´ç•ŒåŒº </span></span><br><span class="line">&#123;   </span><br><span class="line">    counter++; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> </span><br><span class="line"><span class="comment">// ä¸´ç•ŒåŒº </span></span><br><span class="line">&#123; </span><br><span class="line">    counter--; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-1-2-ç«æ€æ¡ä»¶-Race-Condition"><a href="#3-1-2-ç«æ€æ¡ä»¶-Race-Condition" class="headerlink" title="3.1.2 ç«æ€æ¡ä»¶ Race Condition"></a>3.1.2 ç«æ€æ¡ä»¶ Race Condition</h5><p>å¤šä¸ªçº¿ç¨‹åœ¨<strong>ä¸´ç•ŒåŒº</strong>å†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p>
<h4 id="3-2-Synchronized-è§£å†³æ–¹æ¡ˆ"><a href="#3-2-Synchronized-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.2 Synchronized è§£å†³æ–¹æ¡ˆ"></a>3.2 Synchronized è§£å†³æ–¹æ¡ˆ</h4><h5 id="3-2-1-è§£å†³æ‰‹æ®µ"><a href="#3-2-1-è§£å†³æ‰‹æ®µ" class="headerlink" title="3.2.1 è§£å†³æ‰‹æ®µ"></a>3.2.1 è§£å†³æ‰‹æ®µ</h5><p>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p>
<ul>
<li>ã€é˜»å¡å¼ã€‘çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock</li>
<li>ã€éé˜»å¡å¼ã€‘çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</li>
</ul>
<p>æœ¬æ¬¡è¯¾ä½¿ç”¨é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼š<strong>synchronized</strong>ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå³ä¿—ç§°çš„<strong>ã€å¯¹è±¡é”ã€‘</strong>ï¼Œå®ƒé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€ æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡ä½(blocked)ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é” çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<h5 id="3-2-2-Synchronized-è¯­æ³•"><a href="#3-2-2-Synchronized-è¯­æ³•" class="headerlink" title="3.2.2 Synchronized è¯­æ³•"></a>3.2.2 Synchronized è¯­æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(Object) &#123; <span class="comment">// ä¾‹å¦‚, å½“çº¿ç¨‹1æŒæœ‰é”æ—¶, çº¿ç¨‹2è¢«é˜»å¡; ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾é”</span></span><br><span class="line">		<span class="comment">//ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå…¬å…±å¯¹è±¡ï¼Œä½œä¸ºå¯¹è±¡é”çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">room</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;    </span><br><span class="line">	<span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;        </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;            </span><br><span class="line">        <span class="keyword">synchronized</span> (room) &#123; <span class="comment">// ä¸Šé”</span></span><br><span class="line">        counter++;            </span><br><span class="line">       	 &#125;       </span><br><span class="line"> 	   &#125;    </span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;       </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;         </span><br><span class="line">            <span class="keyword">synchronized</span> (room) &#123; <span class="comment">// ä¸Šé”</span></span><br><span class="line">            counter--;          </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    t1.start();    </span><br><span class="line">    t2.start(); </span><br><span class="line">    t1.join();   </span><br><span class="line">    t2.join();    </span><br><span class="line">    log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>,counter); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæµç¨‹å¦‚ä¸‹å›¾: </p>
<pre class="mermaid">sequenceDiagram
    participant çº¿ç¨‹1
    participant çº¿ç¨‹2
    participant é™æ€å˜é‡ i
    participant ğŸ”’é”å¯¹è±¡
    
    çº¿ç¨‹2 ->> ğŸ”’é”å¯¹è±¡ :å°è¯•è·å–é”
    Note over ğŸ”’é”å¯¹è±¡,çº¿ç¨‹2 :æ‹¥æœ‰é”
    é™æ€å˜é‡ i ->> çº¿ç¨‹2 :getstatic i è¯»å–0
    çº¿ç¨‹2 ->> çº¿ç¨‹2 :iconst_1 å‡†å¤‡å¸¸æ•° 1
    çº¿ç¨‹2 ->> çº¿ç¨‹2 :isub å‡æ³•, çº¿ç¨‹å†… i= 0-1 = -1
    çº¿ç¨‹2 -->> çº¿ç¨‹1 :ä¸Šä¸‹æ–‡åˆ‡æ¢
    çº¿ç¨‹1 ->> ğŸ”’é”å¯¹è±¡ :å°è¯•è·å–é”, ä½†æ˜¯è¢«é˜»å¡(BLOCKED)
    çº¿ç¨‹1 -->> çº¿ç¨‹2 :ä¸Šä¸‹æ–‡åˆ‡æ¢
    çº¿ç¨‹2 ->> é™æ€å˜é‡ i :putstatic i å†™å…¥ -1
    Note over ğŸ”’é”å¯¹è±¡,çº¿ç¨‹2 :æ‹¥æœ‰é”
    çº¿ç¨‹2 ->> ğŸ”’é”å¯¹è±¡ :é‡Šæ”¾é”, å¹¶å”¤é†’é˜»å¡çš„çº¿ç¨‹
    Note over ğŸ”’é”å¯¹è±¡,çº¿ç¨‹1 :æ‹¥æœ‰é”
    é™æ€å˜é‡ i ->> çº¿ç¨‹1 :getstatic i è¯»å–-1
    çº¿ç¨‹1 ->> çº¿ç¨‹1 :iconst_1 å‡†å¤‡å¸¸æ•° 1
    çº¿ç¨‹1 ->> çº¿ç¨‹1 :iadd åŠ æ³•, çº¿ç¨‹å†… i= -1+1 = 0
    çº¿ç¨‹1 ->> é™æ€å˜é‡ i :putstatic i å†™å…¥ 0
    Note over ğŸ”’é”å¯¹è±¡,çº¿ç¨‹1 :æ‹¥æœ‰é”
    çº¿ç¨‹1 ->> ğŸ”’é”å¯¹è±¡ :é‡Šæ”¾é”, å¹¶å”¤é†’é˜»å¡çš„çº¿ç¨‹</pre>

<p><strong>æ€è€ƒ</strong></p>
<p>Synchronized å®é™…æ˜¯ç”¨<strong>å¯¹è±¡é”</strong>ä¿è¯äº†<strong>ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§</strong>, ä¸´ç•ŒåŒºå†…çš„ä»£ç å¯¹å¤–æ˜¯ä¸å¯åˆ†å‰²çš„, ä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢æ‰€æ‰“æ–­. </p>
<p>å°†ä¸Šä¸€ä¸ªä»£ç å—çš„ä¾‹å­è§£è—•, ä½¿å…¶èµ„æºç±»å’Œä»»åŠ¡ç±»åˆ†å¼€:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Room</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">      counter--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCounter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> counter;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">  <span class="type">Room</span> <span class="variable">room</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Room</span>();</span><br><span class="line">	<span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;        </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;            </span><br><span class="line">      room.increment();</span><br><span class="line"> 	   &#125;    </span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;       </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">          room.decrement();</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    t1.start();    </span><br><span class="line">    t2.start(); </span><br><span class="line">    t1.join();   </span><br><span class="line">    t2.join();    </span><br><span class="line">    log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>,room.getCounter()); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-3-Synchronized-åœ¨æ–¹æ³•ä¸Š"><a href="#3-2-3-Synchronized-åœ¨æ–¹æ³•ä¸Š" class="headerlink" title="3.2.3 Synchronized åœ¨æ–¹æ³•ä¸Š"></a>3.2.3 Synchronized åœ¨æ–¹æ³•ä¸Š</h5><p>æˆ‘ä»¬å¿…é¡»çŸ¥é“, <strong><code>Synchronized</code> é”ä½çš„å§‹ç»ˆæ˜¯å¯¹è±¡</strong>. ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­çœ‹ä¼¼æ˜¯ä¸æ–¹æ³•æœ‰å…³, å®åˆ™ä¾ç„¶æ˜¯ä¸ºå¯¹è±¡åŠ é”.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*	1. åœ¨æˆå‘˜æ–¹æ³•ä¸Š	*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123; <span class="comment">// é”ä½thiså¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*	2. åœ¨é™æ€æ–¹æ³•ä¸Š	*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Test.class) &#123; <span class="comment">// é”ä½Testç±»å¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„:</strong></p>
<ul>
<li><code>sleep()</code> æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”</li>
</ul>
<h4 id="3-3-å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3-3-å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3.3 å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3.3 å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h4><h5 id="3-3-1-æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3-3-1-æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3.3.1 æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3.3.1 æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h5><ul>
<li>å¦‚æœæ²¡æœ‰å˜é‡æ²¡æœ‰åœ¨çº¿ç¨‹é—´å…±äº«ï¼Œé‚£ä¹ˆå˜é‡æ˜¯å®‰å…¨çš„</li>
<li>å¦‚æœå˜é‡åœ¨çº¿ç¨‹é—´å…±äº«<ul>
<li>å¦‚æœåªæœ‰è¯»æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨</li>
<li>å¦‚æœæœ‰è¯»å†™æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li>
</ul>
</li>
</ul>
<h5 id="3-3-2-å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3-3-2-å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3.3.2 å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3.3.2 å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æ</h5><ol>
<li>å±€éƒ¨å˜é‡ã€å±€éƒ¨å˜é‡è¢«åˆå§‹åŒ–ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ã€‘æ˜¯<strong>å®‰å…¨</strong>çš„</li>
</ol>
<ol start="2">
<li><strong>å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡æœªå¿…</strong>æ˜¯å®‰å…¨çš„</li>
</ol>
<ul>
<li>å¦‚æœå±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡æ²¡æœ‰å¼•ç”¨çº¿ç¨‹å…±äº«çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>å¦‚æœå±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡å¼•ç”¨äº†ä¸€ä¸ªçº¿ç¨‹å…±äº«çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„</li>
</ul>
<ol start="3">
<li>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„â€”â€”æ¯ä¸ªæ–¹æ³•éƒ½åœ¨å¯¹åº”çº¿ç¨‹çš„æ ˆä¸­åˆ›å»ºæ ˆå¸§ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å…±äº«</li>
</ol>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144636.png" alt="20200608144636" style="zoom:75%;">

<ol start="4">
<li>å¦‚æœå±€éƒ¨å˜é‡<a href="https://dave0126.github.io/2022/03/22/JVM-2/#1-3-%E4%BA%94%E7%A7%8D%E5%BC%95%E7%94%A8">å¼•ç”¨çš„å¯¹è±¡</a>è¢«å…±äº«ï¼Œä¸”æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼Œåˆ™<strong>çº¿ç¨‹ä¸å®‰å…¨</strong></li>
</ol>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144649.png" alt="20200608144649" style="zoom:60%;">

<ol start="5">
<li>å¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œåˆ™ä¼šåœ¨<a href="https://dave0126.github.io/2022/03/22/JVM-1/#4-%E5%A0%86">å †</a>ä¸­åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ol>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144702.png" alt="20200608144702" style="zoom:60%;">

<h5 id="3-3-3-å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"><a href="#3-3-3-å¸¸è§çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="3.3.3 å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"></a>3.3.3 å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h5><ul>
<li>String</li>
<li>Integer</li>
<li>StringBuffer</li>
<li>Random</li>
<li>Vector</li>
<li>Hashtable</li>
<li>java.util.concurrent åŒ…ä¸‹çš„ç±»</li>
</ul>
<p>è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º</p>
<ul>
<li>å®ƒä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­çš„</li>
<li>ä½†å¤šä¸ªæ–¹æ³•ç»„åˆåœ¨ä¸€èµ·å°±ä¸æ˜¯åŸå­çš„</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Hashtable</span> <span class="variable">table</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line"><span class="comment">// thread1, thread2</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> 	<span class="keyword">if</span> (table.get(<span class="string">&quot;key&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">  	table.put(<span class="string">&quot;key&quot;</span>,value1)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> 	<span class="keyword">if</span> (table.get(<span class="string">&quot;key&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">  	table.put(<span class="string">&quot;key&quot;</span>,value2)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre class="mermaid">sequenceDiagram
    participant çº¿ç¨‹1
    participant çº¿ç¨‹2
    participant table
    
    çº¿ç¨‹1 ->> table :get("key") == null
    çº¿ç¨‹2 ->> table :get("key") == null
    çº¿ç¨‹2 ->> table :put("key", value2)
    çº¿ç¨‹1 ->> table :put("key", value1)</pre>





<h5 id="3-3-4-ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"><a href="#3-3-4-ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="3.3.4 ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"></a>3.3.4 ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§</h5><p>Stringã€Integer ç­‰éƒ½æ˜¯<strong>ä¸å¯å˜ç±»</strong>ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<p><strong>æ€è€ƒ:</strong></p>
<p>Q é—®: String æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•å¯ä»¥æ”¹å˜å€¼ï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ</p>
<p>A ç­”: è¿™æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•çš„è¿”å›å€¼éƒ½<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¹å˜Stringã€Integerå¯¹è±¡æœ¬èº«ã€‚</p>
<h5 id="3-3-5-ä¹ é¢˜"><a href="#3-3-5-ä¹ é¢˜" class="headerlink" title="3.3.5 ä¹ é¢˜"></a>3.3.5 ä¹ é¢˜</h5><p>æ‰¾å‡ºä¸´ç•ŒåŒºä»£ç ï¼ŒåŠ é”</p>
<ul>
<li>ä¹°ç¥¨ï¼šBiliBili - é»‘é©¬ç¨‹åºå‘˜å…¨é¢æ·±å…¥å­¦ä¹ Javaå¹¶å‘ç¼–ç¨‹ï¼ŒJUCå¹¶å‘ç¼–ç¨‹å…¨å¥—æ•™ç¨‹ <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16J411h7Rd?p=71">ä¹°ç¥¨é—®é¢˜</a></li>
<li>è½¬è´¦ï¼šBiliBili - é»‘é©¬ç¨‹åºå‘˜å…¨é¢æ·±å…¥å­¦ä¹ Javaå¹¶å‘ç¼–ç¨‹ï¼ŒJUCå¹¶å‘ç¼–ç¨‹å…¨å¥—æ•™ç¨‹ <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16J411h7Rd?p=74">è½¬è´¦é—®é¢˜</a></li>
</ul>
<h4 id="3-4-Monitor"><a href="#3-4-Monitor" class="headerlink" title="3.4 Monitor"></a>3.4 Monitor</h4><h5 id="3-4-1-MonitoråŸç†"><a href="#3-4-1-MonitoråŸç†" class="headerlink" title="3.4.1 MonitoråŸç†"></a>3.4.1 MonitoråŸç†</h5><p>Monitor åˆç§°ä¸ºç›‘è§†å™¨æˆ–<strong>ç®¡ç¨‹</strong>, æ˜¯Synchronizedå®ç°çš„åº•å±‚åŸç†, ç”±<strong>æ“ä½œç³»ç»Ÿæä¾›</strong></p>
<p>æ¯ä¸ªJavaå¯¹è±¡éƒ½ä¼šå…³è”ä¸€ä¸ªMonitorå¯¹è±¡, å¦‚æœä½¿ç”¨synchronizedå…³é”®å­—ç»™å¯¹è±¡ä¸Šé” (é‡é‡çº§) ä¹‹å, è¯¥å¯¹è±¡ä¸Monitorå…³è”.</p>
<p><img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144917.png" alt="20200608144917"></p>
<ul>
<li>åˆšå¼€å§‹æ—¶, Monitor çš„ Owner ä¸º null</li>
<li>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedï¼Œä¼šå…ˆæŸ¥è¯¢synchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>æ˜¯å¦ç»‘å®šäº†Monitor</strong>ã€‚<ul>
<li>å¦‚æœ<strong>æ²¡æœ‰ç»‘å®š</strong>ï¼Œåˆ™ä¼šå…ˆå»å»ä¸Monitorç»‘å®šï¼Œå¹¶ä¸”å°†Ownerè®¾ä¸ºå½“å‰çº¿ç¨‹ã€‚</li>
<li>å¦‚æœå·²ç»ç»‘å®šï¼Œåˆ™ä¼šå»æŸ¥è¯¢è¯¥Monitoræ˜¯å¦å·²ç»æœ‰äº†Owner<ul>
<li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™Ownerä¸å°†å½“å‰çº¿ç¨‹ç»‘å®š</li>
<li>å¦‚æœæœ‰ï¼Œåˆ™æ”¾å…¥EntryListï¼Œè¿›å…¥é˜»å¡çŠ¶æ€(blocked)</li>
</ul>
</li>
</ul>
</li>
<li>å½“Monitorçš„Ownerå°†ä¸´ç•ŒåŒºä¸­ä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒOwnerä¾¿ä¼šè¢«æ¸…ç©ºï¼Œæ­¤æ—¶EntryListä¸­å¤„äº<strong>é˜»å¡</strong>çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«<strong>å«é†’å¹¶ç«äº‰</strong>ï¼Œæ­¤æ—¶çš„ç«äº‰æ˜¯<strong>éå…¬å¹³çš„</strong></li>
<li><strong>æ³¨æ„</strong>ï¼š<ul>
<li>å¯¹è±¡åœ¨ä½¿ç”¨äº†synchronizedåä¸Monitorç»‘å®šæ—¶ï¼Œä¼šå°†å¯¹è±¡å¤´ä¸­çš„<strong>Mark Word</strong>ç½®ä¸ºMonitoræŒ‡é’ˆã€‚</li>
<li>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»‘å®šä¸€ä¸ª<strong>å”¯ä¸€çš„Monitor</strong>ï¼Œå¦‚æœsynchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>ä¸åŒ</strong>ï¼Œåˆ™ä¼šç»‘å®š<strong>ä¸åŒ</strong>çš„Monitor</li>
</ul>
</li>
</ul>
<h5 id="3-4-2-è½»é‡çº§é”"><a href="#3-4-2-è½»é‡çº§é”" class="headerlink" title="3.4.2 è½»é‡çº§é”"></a>3.4.2 è½»é‡çº§é”</h5><p><strong>è½»é‡çº§é”ä½¿ç”¨åœºæ™¯ï¼š</strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œä½†è®¿é—®çš„æ—¶é—´æ˜¯<strong>é”™å¼€çš„ï¼ˆä¸å­˜åœ¨ç«äº‰ï¼‰</strong>ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<strong>è½»é‡çº§é”</strong>æ¥ä¼˜åŒ–ã€‚</p>
<p>å› ä¸ºé‡é‡çº§é”ç”±æ“ä½œç³»ç»Ÿæä¾›, ä½¿ç”¨æ—¶ç³»ç»Ÿå¼€é”€è¾ƒå¤§, æ‰€ä»¥åœ¨ä½¿ç”¨ synchronized æ—¶ä¼˜å…ˆä½¿ç”¨è½»é‡çº§é”</p>
<p>è½»é‡çº§é”å¯¹ä½¿ç”¨è€…æ˜¯é€æ˜çš„, å³è¯­æ³•ä¾ç„¶æ˜¯<code>synchronized</code>, ä¼˜å…ˆä½¿ç”¨è½»é‡çº§é”, å¦‚è‹¥å¤±è´¥åˆ™æ”¹ç”¨å…¶ä»–ç±»å‹</p>
<ul>
<li>åˆ›å»º<strong>é”è®°å½•</strong>ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•å¯¹è±¡ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„mark word(ä¸å†ä¸€å¼€å§‹å°±ä½¿ç”¨Monitor)</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144942.png" alt="20200608144942" style="zoom:75%;">

<ul>
<li>è®©é”è®°å½•ä¸­çš„Object referenceæŒ‡å‘é”å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå¹¶å°è¯•ç”¨caså»æ›¿æ¢Objectä¸­çš„mark wordï¼Œå°†æ­¤mark wordæ”¾å…¥lock recordä¸­ä¿å­˜</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144950.png" alt="20200608144950" style="zoom:75%;">

<ul>
<li>å¦‚æœcasæ›¿æ¢æˆåŠŸï¼Œåˆ™å°†Objectçš„å¯¹è±¡å¤´æ›¿æ¢ä¸º<strong>é”è®°å½•çš„åœ°å€</strong>å’Œ<strong>çŠ¶æ€ 00ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</strong>ï¼Œå¹¶ç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144957.png" alt="20200608144957" style="zoom:75%;">

<ul>
<li><p>å¦‚æœcaså¤±è´¥, æœ‰ä¸¤ç§æƒ…å†µ:</p>
<ul>
<li>å¦‚æœæ˜¯å…¶ä»–çº¿ç¨‹å·²ç»æŒæœ‰äº†è¯¥Objectçš„è½»é‡çº§é”, è¿™æ—¶è¡¨æ˜æœ‰ç«äº‰, è¿›å…¥ä¸‹ä¸€å°èŠ‚çš„<strong>é”è†¨èƒ€</strong>è¿‡ç¨‹</li>
<li>å¦‚æœæ˜¯è‡ªå·±æ‰§è¡Œäº†synchronized<strong>é”é‡å…¥</strong>, é‚£ä¹ˆå†æ·»åŠ ä¸€æ¡Lock Record ä½œä¸ºé‡å…¥çš„è®¡æ•°</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220326175731138-8313862.png" alt="image-20220326175731138" style="zoom:75%;">
</li>
<li><p>å½“é€€å‡ºSynchronized (è§£é”) æ—¶, å¦‚æœæœ‰å–å€¼ä¸ºnullçš„é”è®°å½•, è¡¨ç¤ºæœ‰é‡å…¥, è¿™æ—¶é‡ç½®é”è®°å½•, è¡¨ç¤ºé‡å…¥è®¡æ•° -1</p>
</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144957.png" alt="20200608144957" style="zoom:75%;">

<ul>
<li>å½“é€€å‡ºSynchronized (è§£é”)é”è®°å½•çš„å€¼ä¸ºä¸ä¸ºnullæ—¶, è¿™æ—¶ä½¿ç”¨caså°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´<ul>
<li>æˆåŠŸ, åˆ™è§£é”æˆåŠŸ</li>
<li>å¤±è´¥, è¯´æ˜è½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–è€…å·²ç»å‡çº§ä¸ºé‡é‡çº§é”, è¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹</li>
</ul>
</li>
</ul>
<h5 id="3-4-3-é”è†¨èƒ€"><a href="#3-4-3-é”è†¨èƒ€" class="headerlink" title="3.4.3 é”è†¨èƒ€"></a>3.4.3 é”è†¨èƒ€</h5><ul>
<li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç»™ä¸€ä¸ªå¯¹è±¡åŠ è½»é‡çº§é”æ—¶ï¼Œ<strong>casæ›¿æ¢æ“ä½œå¤±è´¥</strong>ï¼ˆå› ä¸ºæ­¤æ—¶å…¶ä»–çº¿ç¨‹å·²ç»ç»™å¯¹è±¡åŠ äº†è½»é‡çº§é”ï¼‰ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥<strong>é”è†¨èƒ€</strong>è¿‡ç¨‹</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145004.png" alt="20200608145004" style="zoom:75%;">

<ul>
<li>æ­¤æ—¶ä¾¿ä¼šç»™å¯¹è±¡åŠ ä¸Šé‡é‡çº§é” (ä½¿ç”¨Monitor)<ul>
<li>å°†å¯¹è±¡å¤´çš„Mark Wordæ”¹ä¸ºMonitorçš„åœ°å€ï¼Œå¹¶ä¸”çŠ¶æ€æ”¹ä¸º01(é‡é‡çº§é”)</li>
<li>å¹¶ä¸”è¯¥çº¿ç¨‹æ”¾å…¥Monitor çš„ EntryListä¸­ï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€(blocked)</li>
</ul>
</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145148.png" alt="20200608145148" style="zoom:75%;">

<ul>
<li>å½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—è§£é”æ—¶, ä½¿ç”¨caså°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´, å¤±è´¥. è¿™æ˜¯ä¼šè¿›å…¥é‡é‡çº§è§£é”æµç¨‹, å³æŒ‰ç…§Monitoråœ°å€æ‰¾åˆ°Monitorå¯¹è±¡, è®¾ç½®Owner ä¸º null, å”¤é†’EntryListä¸­çš„BLOCKEDçº¿ç¨‹</li>
</ul>
<h5 id="3-4-4-è‡ªæ—‹ä¼˜åŒ–"><a href="#3-4-4-è‡ªæ—‹ä¼˜åŒ–" class="headerlink" title="3.4.4 è‡ªæ—‹ä¼˜åŒ–"></a>3.4.4 è‡ªæ—‹ä¼˜åŒ–</h5><p><strong>é‡é‡çº§é”</strong>ç«äº‰æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥ä¼˜åŒ–(åœ¨å¤šæ ¸å¿ƒcpuä¸­æ‰æœ‰æ„ä¹‰)ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨<strong>è‡ªæ—‹æˆåŠŸ</strong>ï¼ˆä½¿ç”¨é”çš„çº¿ç¨‹é€€å‡ºäº†åŒæ­¥å—ï¼Œ<strong>é‡Šæ”¾äº†é”</strong>ï¼Œå³å½“å‰çº¿ç¨‹å¯ä»¥ç›´æ¥æˆä¸ºæ–°çš„Ownerï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥é¿å…çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<h6 id="è‡ªæ—‹æˆåŠŸçš„æƒ…å†µ"><a href="#è‡ªæ—‹æˆåŠŸçš„æƒ…å†µ" class="headerlink" title="è‡ªæ—‹æˆåŠŸçš„æƒ…å†µ"></a>è‡ªæ—‹æˆåŠŸçš„æƒ…å†µ</h6><pre class="mermaid">sequenceDiagram
    participant t1 as çº¿ç¨‹1(cpu1)
    participant obj as Obj
    participant t2 as çº¿ç¨‹2
    
    Note over obj :10 (é‡é‡çº§é”)
    t1 ->> +obj :è®¿é—®åŒæ­¥å—ï¼Œ è·å– Monitor
    t1 ->> obj :æˆåŠŸåŠ é”
    Note over obj :10 (é‡é‡çº§é”) é‡é‡çº§é”æŒ‡é’ˆ
    t2 -x obj :è®¿é—®åŒæ­¥å—ï¼Œ è·å– Monitor
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    Note over t1 :æ‰§è¡Œä¸´ç•ŒåŒºä»£ç å—
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    obj ->> -t1 :æˆåŠŸè§£é”
    Note over obj :01 (æ— é”)
    t2 ->> +obj :æˆåŠŸåŠ é”
    Note over obj :10 (é‡é‡çº§é”) é‡é‡çº§é”æŒ‡é’ˆ
    Note over t2 :æ‰§è¡Œä¸´ç•ŒåŒºä»£ç å—
    obj ->> -t2 : æˆåŠŸè§£é”</pre>



<h6 id="è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ"><a href="#è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ" class="headerlink" title="è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ"></a>è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ</h6><pre class="mermaid">sequenceDiagram
    participant t1 as çº¿ç¨‹1(cpu1)
    participant obj as Obj
    participant t2 as çº¿ç¨‹2
    
    Note over obj :10 (é‡é‡çº§é”)
    t1 ->> +obj :è®¿é—®åŒæ­¥å—ï¼Œ è·å– Monitor
    t1 ->> obj :æˆåŠŸåŠ é”
    Note over obj :10 (é‡é‡çº§é”) é‡é‡çº§é”æŒ‡é’ˆ
    t2 -x obj :è®¿é—®åŒæ­¥å—ï¼Œ è·å– Monitor
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    Note over t1 :æ‰§è¡Œä¸´ç•ŒåŒºä»£ç å—
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    t2 ->> t2 :è‡ªæ—‹é‡è¯•
    Note over t2 :é˜»å¡
    obj ->> -t1 :æˆåŠŸè§£é”
    Note over obj :01 (æ— é”)</pre>



<h5 id="3-4-5-åå‘é”"><a href="#3-4-5-åå‘é”" class="headerlink" title="3.4.5 åå‘é”"></a>3.4.5 åå‘é”</h5><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œæ¯æ¬¡<strong>é‡å…¥</strong>ï¼ˆè¯¥çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•ä¸­å†æ¬¡é”ä½è¯¥å¯¹è±¡ï¼‰æ“ä½œä»éœ€è¦casæ›¿æ¢æ“ä½œï¼Œè¿™æ ·æ˜¯ä¼šä½¿æ€§èƒ½é™ä½çš„ã€‚</p>
<p>æ‰€ä»¥å¼•å…¥äº†<strong>åå‘é”</strong>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼šåœ¨<strong>ç¬¬ä¸€æ¬¡</strong>casæ—¶ä¼šå°†<strong>çº¿ç¨‹çš„ID</strong>å†™å…¥å¯¹è±¡çš„Mark Wordä¸­ã€‚æ­¤åå‘ç°è¿™ä¸ªçº¿ç¨‹IDå°±æ˜¯è‡ªå·±çš„ï¼Œå°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œå°±ä¸éœ€è¦å†æ¬¡casï¼Œä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p>
<p>ï¼ˆç›¸å½“äºåœ¨ä¸´ç•Œèµ„æºä¸Šåˆ»ä¸Šè¿›ç¨‹çš„åå­—ï¼Œ è¯¥èµ„æºå½’æ­¤è¿›ç¨‹æ‰€æœ‰ï¼‰</p>
<h6 id="åå‘çŠ¶æ€"><a href="#åå‘çŠ¶æ€" class="headerlink" title="åå‘çŠ¶æ€"></a>åå‘çŠ¶æ€</h6><ul>
<li>Normalï¼šä¸€èˆ¬çŠ¶æ€ï¼Œæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œå‰é¢62ä½ä¿å­˜çš„æ˜¯å¯¹è±¡çš„ä¿¡æ¯ï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆæœªä½¿ç”¨ï¼š0ï¼‰</strong></li>
<li>Biasedï¼šåå‘çŠ¶æ€ï¼Œä½¿ç”¨åå‘é”ï¼Œå‰é¢54ä½ä¿å­˜çš„å½“å‰çº¿ç¨‹çš„IDï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆä½¿ç”¨ï¼š1ï¼‰</strong></li>
<li>Lightweightï¼šä½¿ç”¨è½»é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯é”è®°å½•çš„æŒ‡é’ˆï¼Œ<strong>æœ€åä¸¤ä½ä¸ºçŠ¶æ€ï¼ˆ00ï¼‰</strong></li>
<li>Heavyweightï¼šä½¿ç”¨é‡é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯Monitorçš„åœ°å€æŒ‡é’ˆï¼Œ<strong>åä¸¤ä½ä¸ºçŠ¶æ€(10)</strong></li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145101.png" alt="img" style="zoom:75%;">

<ul>
<li>å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯101</li>
<li>ä½†æ˜¯åå‘é”é»˜è®¤æ˜¯<strong>æœ‰å»¶è¿Ÿ</strong>çš„ï¼Œä¸ä¼šå†ç¨‹åºä¸€å¯åŠ¨å°±ç”Ÿæ•ˆï¼Œè€Œæ˜¯ä¼šåœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’ä¹‹åï¼‰ï¼Œæ‰ä¼šå¯¹åˆ›å»ºçš„å¯¹è±¡è®¾ç½®ä¸ºåå‘çŠ¶æ€</li>
<li>å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯001</li>
</ul>
<h6 id="æ’¤é”€åå‘"><a href="#æ’¤é”€åå‘" class="headerlink" title="æ’¤é”€åå‘"></a>æ’¤é”€åå‘</h6><p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šä½¿å¯¹è±¡çš„åå‘é”å¤±æ•ˆ</p>
<ul>
<li>è°ƒç”¨å¯¹è±¡çš„hashCodeæ–¹æ³•</li>
<li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥å¯¹è±¡</li>
<li><strong>è°ƒç”¨äº†wait&#x2F;notifyæ–¹æ³•</strong>ï¼ˆè°ƒç”¨waitæ–¹æ³•ä¼šå¯¼è‡´é”è†¨èƒ€è€Œä½¿ç”¨<strong>é‡é‡çº§é”</strong>ï¼‰</li>
</ul>
<h6 id="æ‰¹é‡é‡åå‘"><a href="#æ‰¹é‡é‡åå‘" class="headerlink" title="æ‰¹é‡é‡åå‘"></a>æ‰¹é‡é‡åå‘</h6><ul>
<li>å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯çº¿ç¨‹é—´ä¸å­˜åœ¨ç«äº‰ï¼Œè¿™æ—¶åå‘T1çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘T2<ul>
<li>é‡åå‘ä¼šé‡ç½®Thread ID</li>
</ul>
</li>
<li>å½“æ’¤é”€è¶…è¿‡20æ¬¡åï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰ï¼ŒJVMä¼šè§‰å¾—æ˜¯ä¸æ˜¯åå‘é”™äº†ï¼Œè¿™æ—¶ä¼šåœ¨ç»™å¯¹è±¡åŠ é”æ—¶ï¼Œé‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹ã€‚</li>
</ul>
<h6 id="æ‰¹é‡æ’¤é”€"><a href="#æ‰¹é‡æ’¤é”€" class="headerlink" title="æ‰¹é‡æ’¤é”€"></a>æ‰¹é‡æ’¤é”€</h6><p>å½“æ’¤é”€åå‘é”çš„é˜ˆå€¼è¶…è¿‡40ä»¥åï¼Œå°±ä¼šå°†<strong>æ•´ä¸ªç±»çš„å¯¹è±¡éƒ½æ”¹ä¸ºä¸å¯åå‘çš„</strong></p>
<h4 id="3-5-Wait-x2F-Notify"><a href="#3-5-Wait-x2F-Notify" class="headerlink" title="3.5 Wait &#x2F; Notify"></a>3.5 Wait &#x2F; Notify</h4><img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144917.png" alt="20200608144917" style="zoom:75%;">

<ul>
<li><p>Ownerçº¿ç¨‹å‘ç°æ‰§è¡Œæ¡ä»¶ä¸æ»¡è¶³ï¼Œé”å¯¹è±¡è°ƒç”¨<code>wait()</code>æ–¹æ³•ï¼ˆobj.waitï¼‰ï¼Œå°±ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥WaitSetä¸­ï¼Œå˜ä¸º<code>WAITING</code>çŠ¶æ€ã€‚</p>
</li>
<li><p>å¤„äº<code>BLOCKED</code>å’Œ<code>WAITING</code>çŠ¶æ€çš„çº¿ç¨‹éƒ½ä¸ºé˜»å¡</p>
<p>çŠ¶æ€ï¼ŒCPUéƒ½ä¸ä¼šåˆ†ç»™ä»–ä»¬æ—¶é—´ç‰‡ã€‚ä½†æ˜¯æœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul>
<li><strong><code>BLOCKED</code>çŠ¶æ€çš„çº¿ç¨‹æ˜¯åœ¨ç«äº‰å¯¹è±¡</strong>æ—¶ï¼Œå‘ç°Monitorçš„Ownerå·²ç»æ˜¯åˆ«çš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥EntryListä¸­ï¼Œå¹¶å¤„äºBLOCKEDçŠ¶æ€</li>
<li><strong><code>WAITING</code>çŠ¶æ€çš„çº¿ç¨‹æ˜¯è·å¾—äº†å¯¹è±¡çš„é”</strong>ï¼Œä½†æ˜¯è‡ªèº«å› ä¸ºæŸäº›åŸå› éœ€è¦è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œé”å¯¹è±¡è°ƒç”¨äº†<code>wait()</code>æ–¹æ³•è€Œè¿›å…¥äº†WaitSetä¸­ï¼Œå¤„äº<code>WAITING</code>çŠ¶æ€</li>
</ul>
</li>
<li><p>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹ä¼šåœ¨é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’ï¼Œä½†æ˜¯å¤„äº<code>WAITING</code>çŠ¶æ€çš„çº¿ç¨‹åªæœ‰è¢«é”å¯¹è±¡è°ƒç”¨äº†<code>notify()</code>æˆ–<code>notifyAll()</code>æ–¹æ³•(obj.notify&#x2F;obj.notifyAll)ï¼Œæ‰ä¼šè¢«å”¤é†’ã€‚</p>
</li>
</ul>
<h5 id="3-5-1-APIä»‹ç»"><a href="#3-5-1-APIä»‹ç»" class="headerlink" title="3.5.1 APIä»‹ç»"></a>3.5.1 APIä»‹ç»</h5><ol>
<li><code>obj.wait()</code>ï¼šè®©è¿›å…¥Monitorçš„çº¿ç¨‹åˆ°waitSetç­‰å¾…</li>
<li><code>obj.wait(long timeout)</code> è®©è¿›å…¥objç›‘è§†å™¨çš„çº¿ç¨‹åˆ°waitSet<strong>ç­‰å¾… timeoutæ—¶é—´é•¿åº¦</strong>ï¼Œç»§ç»­æ‰§è¡Œ</li>
<li><code>obj.notify()</code>ï¼šåœ¨objectä¸Šæ­£åœ¨waitSetç­‰å¾…çš„çº¿ç¨‹ä¸­<strong>æŒ‘ä¸€ä¸ª</strong>å”¤é†’</li>
<li><code>obj.notifyAll()</code>ï¼šåœ¨objectä¸Šæ­£åœ¨waitSetç­‰å¾…çš„çº¿ç¨‹<strong>å…¨éƒ¨</strong>å”¤é†’</li>
</ol>
<p>æ³¨æ„âš ï¸ï¼šä»–ä»¬éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œçš„æ‰‹æ®µï¼Œéƒ½å±äºObjectå¯¹è±¡çš„æ–¹æ³•ã€‚<strong>å¿…é¡»è·å¾—æ­¤å¯¹è±¡çš„é”</strong>ï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•ã€‚<strong>åªæœ‰å½“å¯¹è±¡è¢«é”ä»¥åï¼Œæ‰èƒ½è°ƒç”¨waitå’Œnotifyæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span> ();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span> (() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.wait(); <span class="comment">// è®©çº¿ç¨‹t1åœ¨lockä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span> (() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.wait(); <span class="comment">// è®©çº¿ç¨‹t2åœ¨lockä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123; <span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line">        lock.notify(); <span class="comment">// éšæœºå”¤é†’ä¸€ä¸ª</span></span><br><span class="line">        lock.notifyAll(); <span class="comment">// å”¤é†’æ‰€æœ‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-5-2-wait-å’Œsleep-çš„åŒºåˆ«"><a href="#3-5-2-wait-å’Œsleep-çš„åŒºåˆ«" class="headerlink" title="3.5.2 wait() å’Œsleep()çš„åŒºåˆ«"></a>3.5.2 wait() å’Œsleep()çš„åŒºåˆ«</h5><ul>
<li><p>ä¸åŒç‚¹ï¼š</p>
<ol>
<li>ä»APIè§’åº¦ï¼šsleepæ˜¯Threadçš„é™æ€æ–¹æ³•ï¼Œwaitæ˜¯æ‰€æœ‰å¯¹è±¡ï¼ˆObjectï¼‰çš„æ–¹æ³•</li>
<li>sleepä¸ç”¨ä¸synchronizedä¸€èµ·ç”¨ï¼Œwaitéœ€è¦ä¸synchronizedä¸€èµ·ç”¨</li>
<li>sleep<strong>ä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œwaitåœ¨ç­‰å¾…æ—¶<strong>ä¼šé‡Šæ”¾é”</strong></li>
</ol>
</li>
<li><p>ç›¸åŒç‚¹ï¼š</p>
<ol>
<li>è¿›å…¥çš„çº¿ç¨‹çŠ¶æ€éƒ½æ˜¯TIMED_WAITING</li>
</ol>
</li>
</ul>
<p>ä¸ºäº†è§£å†³waitçš„è™šå‡å”¤é†’ï¼Œä»£ç ç»“æ„å¦‚ä¸‹ï¼š(while)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">   <span class="keyword">while</span> (æ¡ä»¶ä¸æˆç«‹) &#123;</span><br><span class="line">       lock.wait();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">    lock.notify();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.TestCorrectPosture&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCorrectPostureStep4</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">room</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">hasCigarette</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">hasTakeout</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">                <span class="keyword">while</span> (!hasCigarette) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        room.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">                <span class="keyword">if</span> (hasCigarette) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;æ²¡å¹²æˆæ´»...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;å°å—&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">                log.debug(<span class="string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasTakeout);</span><br><span class="line">                <span class="keyword">if</span> (!hasTakeout) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        room.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.debug(<span class="string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasTakeout);</span><br><span class="line">                <span class="keyword">if</span> (hasTakeout) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;æ²¡å¹²æˆæ´»...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;å°å¥³&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">                hasTakeout = <span class="literal">true</span>;</span><br><span class="line">                log.debug(<span class="string">&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;</span>);</span><br><span class="line">                room.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;é€å¤–å–çš„&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-6-åŒæ­¥æ¨¡å¼-ä¹‹-ä¿æŠ¤æ€§æš‚åœ"><a href="#3-6-åŒæ­¥æ¨¡å¼-ä¹‹-ä¿æŠ¤æ€§æš‚åœ" class="headerlink" title="3.6 åŒæ­¥æ¨¡å¼ ä¹‹ ä¿æŠ¤æ€§æš‚åœ"></a>3.6 åŒæ­¥æ¨¡å¼ ä¹‹ ä¿æŠ¤æ€§æš‚åœ</h4><p>å³Guarded Suspensionï¼Œç”¨äºä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœæ—¶ã€‚å¦‚ä¸‹å›¾ã€‚</p>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327195520317-8403730.png" alt="image-20220327195520317" style="zoom:67%;">

<p>è¦ç‚¹ï¼š</p>
<ul>
<li>æœ‰ä¸€ä¸ªç»“æœæƒ³ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥è®©ä»–ä»¬å…³è”åŒä¸€ä¸ªGuardedObject</li>
<li>å¦‚æœæœ‰ç»“æœä¸æ–­çš„ä»ä¸€ä¸ªç»“æœåˆ°å¦ä¸€ä¸ªç»“æœï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆè§æ¶ˆè´¹è€…&#x2F;ç”Ÿäº§è€…ï¼‰</li>
<li>JDKä¸­ï¼Œ<code>join()</code>çš„å®ç°ã€<code>future</code>çš„å®ç°ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¯¥æ¨¡å¼</li>
<li>å› ä¸ºè¦ç­‰å¾…å¦ä¸€æ–¹çš„ç»“æœï¼Œå› æ­¤å½’ç±»åˆ°è¯¥æ¨¡å¼</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="string">&quot;hello thread!&quot;</span>;</span><br><span class="line">		<span class="type">Guarded</span> <span class="variable">guarded</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Guarded</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// thread 1</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;æƒ³è¦å¾—åˆ°ç»“æœ&quot;</span>);</span><br><span class="line">			<span class="keyword">synchronized</span> (guarded) &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;ç»“æœæ˜¯ï¼š&quot;</span>+guarded.getResponse());</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">&quot;å¾—åˆ°ç»“æœ&quot;</span>);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//thread 2</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;è®¾ç½®ç»“æœ&quot;</span>);</span><br><span class="line">			<span class="keyword">synchronized</span> (guarded) &#123;</span><br><span class="line">				guarded.setResponse(hello);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Guarded</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è¦è¿”å›çš„ç»“æœ</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Object response;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//ä¼˜é›…åœ°ä½¿ç”¨wait/notify</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">getResponse</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//å¦‚æœè¿”å›ç»“æœä¸ºç©ºå°±ä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">			<span class="keyword">while</span>(response == <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="built_in">this</span>.wait();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> response;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResponse</span><span class="params">(Object response)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.response = response;</span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">			<span class="comment">//å”¤é†’ä¼‘çœ çš„çº¿ç¨‹</span></span><br><span class="line">			<span class="built_in">this</span>.notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Guarded&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;response=&quot;</span> + response +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¦è¶…æ—¶åˆ¤æ–­çš„æš‚åœ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹ä¸Šé¢ä»£ç å—ä¸­çš„ getResponse() æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getResponse</span><span class="params">(<span class="type">long</span> time)</span> &#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">			<span class="comment">//è·å–å¼€å§‹æ—¶é—´</span></span><br><span class="line">			<span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">			<span class="comment">//ç”¨äºä¿å­˜å·²ç»ç­‰å¾…äº†çš„æ—¶é—´</span></span><br><span class="line">			<span class="type">long</span> <span class="variable">passedTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(response == <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">//çœ‹ç»è¿‡çš„æ—¶é—´-å¼€å§‹æ—¶é—´æ˜¯å¦è¶…è¿‡äº†æŒ‡å®šæ—¶é—´</span></span><br><span class="line">				<span class="type">long</span> <span class="variable">waitTime</span> <span class="operator">=</span> time -passedTime;</span><br><span class="line">				<span class="keyword">if</span>(waitTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">                   	<span class="comment">//ç­‰å¾…å‰©ä½™æ—¶é—´</span></span><br><span class="line">					<span class="built_in">this</span>.wait(waitTime);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">				passedTime = System.currentTimeMillis()-currentTime		</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> response;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-6-1-join-ï¼šä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"><a href="#3-6-1-join-ï¼šä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼" class="headerlink" title="3.6.1 join()ï¼šä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"></a>3.6.1 join()ï¼šä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">(<span class="type">long</span> millis)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                wait(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">delay</span> <span class="operator">=</span> millis - now;</span><br><span class="line">                <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now = System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-6-2-æ‰©å±•-Future"><a href="#3-6-2-æ‰©å±•-Future" class="headerlink" title="3.6.2 æ‰©å±• - Future"></a>3.6.2 æ‰©å±• - Future</h5><p>å›¾ä¸­çš„Futureå°±å¥½æ¯”å±…æ°‘æ¥¼ä¸€æ¥¼çš„ä¿¡ç®±ï¼ˆæ¯ä¸ªä¿¡ç®±éƒ½æœ‰è‡ªå·±çš„ç¼–å·ï¼‰ï¼Œå·¦è¾¹çš„t0ï¼Œt2ï¼Œt4å°±å¥½æ¯”ç­‰å¾…é‚®ä»¶çš„å±…æ°‘ï¼Œå³ä¾§çš„t1ï¼Œt3ï¼Œt5å°±å¥½æ¯”é‚®é€’å‘˜ã€‚</p>
<p>å¦‚æœéœ€è¦å†å¤šä¸ªé›·ä¹‹é—´ä½¿ç”¨GuardedObjectå¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤è®¾è®¡ä¸€ä¸ªç”¨æ¥è§£è€¦çš„ä¸­é—´ç±»ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥è§£è€¦ã€ç»“æœç­‰å¾…è€…ã€‘å’Œã€ç»“æœç”Ÿäº§è€…ã€‘ï¼Œè¿˜èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šä¸ªä»»åŠ¡çš„å¤„ç†ã€‚</p>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327202425832-8405470.png" alt="image-20220327202425832" style="zoom:67%;">



<h4 id="3-7-å¼‚æ­¥æ¨¡å¼-ä¹‹-ç”Ÿäº§è€…-x2F-æ¶ˆè´¹è€…"><a href="#3-7-å¼‚æ­¥æ¨¡å¼-ä¹‹-ç”Ÿäº§è€…-x2F-æ¶ˆè´¹è€…" class="headerlink" title="3.7 å¼‚æ­¥æ¨¡å¼ ä¹‹ ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…"></a>3.7 å¼‚æ­¥æ¨¡å¼ ä¹‹ ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…</h4><h5 id="3-7-1-è¦ç‚¹"><a href="#3-7-1-è¦ç‚¹" class="headerlink" title="3.7.1 è¦ç‚¹"></a>3.7.1 è¦ç‚¹</h5><ul>
<li>ä¸å‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„ Guardobject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æœå’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº”</li>
<li>æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº</li>
<li>ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æœæ•°æ®</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼ˆç”Ÿäº§è€…é˜»å¡ï¼‰ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ®ï¼ˆæ¶ˆè´¹è€…é˜»å¡ï¼‰</li>
<li>JDK ä¸­å„ç§é˜»å¡é˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼</li>
</ul>
<p><img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/image-20220327204404520-8406649.png" alt="image-20220327204404520"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹çš„ä¸‰ä¸ªçº¿ç¨‹æ˜¯ç”Ÿäº§è€…ï¼Œå³è¾¹çš„æ˜¯æ¶ˆè´¹è€…ã€‚</p>
<h5 id="3-7-2-å®ç°"><a href="#3-7-2-å®ç°" class="headerlink" title="3.7.2 å®ç°"></a>3.7.2 å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MessageQueue</span> &#123;</span><br><span class="line">  <span class="comment">// æ¶ˆæ¯çš„é˜Ÿåˆ—é›†åˆ</span></span><br><span class="line">  <span class="keyword">private</span> LinkedList&lt;Message&gt;list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">  <span class="comment">// é˜Ÿåˆ—å®¹é‡</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> capcity;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Message <span class="title function_">take</span><span class="params">()</span> &#123; <span class="comment">// å–æ¶ˆæ¯</span></span><br><span class="line">  	<span class="comment">// æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">synchronized</span>(list)&#123;</span><br><span class="line">      <span class="keyword">while</span>(list.isEmply())&#123;</span><br><span class="line">      	<span class="keyword">try</span> &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…\n&quot;</span>);</span><br><span class="line">          list.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    	&#125;</span><br><span class="line">      <span class="comment">// ä»é˜Ÿåˆ—å¤´è·å–æ¶ˆæ¯å¹¶è¿”å›</span></span><br><span class="line">      <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> list.removeFrist();</span><br><span class="line">      System.out.println(<span class="string">&quot;å·²ç»æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯\n&quot;</span> +message);</span><br><span class="line">      list.notifyAll();</span><br><span class="line">      <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(Message message)</span> &#123; <span class="comment">// å­˜æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦å·²æ»¡</span></span><br><span class="line">    <span class="keyword">synchronized</span>(list)&#123;</span><br><span class="line">      <span class="keyword">while</span>(list.size() == capcity) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;æ¶ˆæ¯é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…\n&quot;</span>);</span><br><span class="line">          list.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å°†æ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨</span></span><br><span class="line">      list.addLast(message);</span><br><span class="line">      System.out.println(<span class="string">&quot;å·²ç»ç”Ÿäº§äº†ä¸€ä¸ªæ¶ˆæ¯ï¼š\n&quot;</span> +message);</span><br><span class="line">      list.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> Object value;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Message</span> <span class="params">(<span class="type">int</span> id, Object value)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.value = value;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Message: id:&quot;</span>+id+<span class="string">&quot;, value:&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">MessageQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageQueue</span>(<span class="number">2</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">      queue.put(<span class="keyword">new</span> <span class="title class_">Message</span>(id, <span class="string">&quot;value&quot;</span>+id));</span><br><span class="line">    &#125;, <span class="string">&quot;ç”Ÿäº§è€…&quot;</span>+i).start();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      <span class="type">Message</span> <span class="variable">massage</span> <span class="operator">=</span> queue.take();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">&quot;æ¶ˆè´¹è€…&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-8-Park-amp-Unpark"><a href="#3-8-Park-amp-Unpark" class="headerlink" title="3.8 Park &amp; Unpark"></a>3.8 Park &amp; Unpark</h4><h5 id="3-8-1-åŸºæœ¬ä½¿ç”¨"><a href="#3-8-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.8.1 åŸºæœ¬ä½¿ç”¨"></a>3.8.1 åŸºæœ¬ä½¿ç”¨</h5><p><strong>park&#x2F;unparkéƒ½æ˜¯LockSupportç±»ä¸­çš„çš„æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">LockSupport.park;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">LockSupport.unpark(thread);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt; &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;park&quot;</span>);</span><br><span class="line">      <span class="comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">			LockSupport.park();</span><br><span class="line">			System.out.println(<span class="string">&quot;resume&quot;</span>);</span><br><span class="line">		&#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">		thread.start();</span><br><span class="line"></span><br><span class="line">		Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;unpark&quot;</span>);</span><br><span class="line">    	<span class="comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">		LockSupport.unpark(thread);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-8-2-ç‰¹ç‚¹"><a href="#3-8-2-ç‰¹ç‚¹" class="headerlink" title="3.8.2 ç‰¹ç‚¹"></a>3.8.2 ç‰¹ç‚¹</h5><p><strong>ä¸wait&#x2F;notifyçš„åŒºåˆ«</strong></p>
<ul>
<li>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ<strong>Object Monitor</strong>ä¸€èµ·ä½¿ç”¨ï¼Œè€Œparkï¼Œunparkä¸å¿…</li>
<li>park ï¼Œunpark æ˜¯ä»¥<strong>çº¿ç¨‹ä¸ºå•ä½</strong>æ¥<strong>ã€é˜»å¡ã€‘</strong>å’Œ<strong>ã€å”¤é†’ã€‘</strong>çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆã€ç²¾ç¡®ã€‘</li>
<li>park &amp; unpark å¯ä»¥<strong>å…ˆ unpark</strong>ï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</li>
<li><strong>parkä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œè€Œwaitä¼šé‡Šæ”¾é”</li>
</ul>
<h5 id="3-8-3-åŸç†"><a href="#3-8-3-åŸç†" class="headerlink" title="3.8.3 åŸç†"></a>3.8.3 åŸç†</h5><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„<strong>Parkå¯¹è±¡</strong>ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡<code>_counter</code>,  <code>_cond</code>, <code>_mutex</code>ç»„æˆ</p>
<ul>
<li><p>å…ˆè°ƒç”¨parkå†è°ƒç”¨unparkæ—¶</p>
<ol>
<li>å…ˆè°ƒç”¨park<ul>
<li>çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä¼šå°†Parkå¯¹è±¡ä¸­<code>_counter</code>çš„å€¼è®¾ä¸º0ï¼›</li>
<li>è°ƒç”¨parkæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹<code>_counter</code>çš„å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—<code>_cond</code>ä¸­</li>
<li>æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­åï¼Œä¼š<strong>å†æ¬¡</strong>å°†<code>_counter</code>è®¾ç½®ä¸º0</li>
</ul>
</li>
</ol>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145250.png" alt="20200608145250" style="zoom:70%;">

<ol start="2">
<li>ç„¶åè°ƒç”¨unpark<ul>
<li>è°ƒç”¨unparkæ–¹æ³•åï¼Œä¼šå°†<code>_counter</code>çš„å€¼è®¾ç½®ä¸º1</li>
<li>å»å”¤é†’é˜»å¡é˜Ÿåˆ—<code>_cond</code>ä¸­çš„çº¿ç¨‹</li>
<li>çº¿ç¨‹ç»§ç»­è¿è¡Œå¹¶å°†<code>_counter</code>çš„å€¼è®¾ä¸º0</li>
</ul>
</li>
</ol>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145303.png" alt="20200608145303" style="zoom:60%;">
</li>
<li><p>å…ˆè°ƒç”¨unparkï¼Œå†è°ƒç”¨park</p>
<ol>
<li><p>è°ƒç”¨unpark</p>
<ul>
<li>ä¼šå°†<code>_counter</code>è®¾ç½®ä¸º1ï¼ˆè¿è¡Œæ—¶0ï¼‰</li>
</ul>
</li>
<li><p>è°ƒç”¨parkæ–¹æ³•</p>
<ul>
<li>æŸ¥çœ‹<code>_counter</code>æ˜¯å¦ä¸º0</li>
<li>å› ä¸ºunparkå·²ç»æŠŠ<code>_counter</code>è®¾ç½®ä¸º1ï¼Œæ‰€ä»¥æ­¤æ—¶å°†<code>_counter</code>è®¾ç½®ä¸º0ï¼Œä½†<strong>ä¸æ”¾å…¥</strong>é˜»å¡é˜Ÿåˆ—<code>_cond</code>ä¸­</li>
</ul>
</li>
</ol>
</li>
</ul>
<img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608145313.png" alt="20200608145313" style="zoom:60%;">





<h4 id="3-9-çº¿ç¨‹çŠ¶æ€è½¬æ¢"><a href="#3-9-çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="headerlink" title="3.9 çº¿ç¨‹çŠ¶æ€è½¬æ¢"></a>3.9 çº¿ç¨‹çŠ¶æ€è½¬æ¢</h4><img src="/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/20200608144621-8409900.png" alt="20200608144621" style="zoom:75%;">

<h5 id="æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE"><a href="#æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE" class="headerlink" title="æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE"></a>æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE</h5><ul>
<li>å½“è°ƒç”¨äº†<code>t.start()</code>æ–¹æ³•æ—¶ï¼Œç”±<code> NEW</code> â€“&gt; <code>RUNNABLE</code></li>
</ul>
<h5 id="æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING</h5><ul>
<li>å½“è°ƒç”¨äº†t çº¿ç¨‹ç”¨ <code>synchronized(obj)</code> è·å–äº†å¯¹è±¡é”å<ul>
<li>è°ƒç”¨ <code>obj.wait()</code> æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt;<code> WAITING</code></li>
<li>è°ƒç”¨ <code>obj.notify()</code> ï¼Œ <code>obj.notifyAll()</code> ï¼Œ<code> t.interrupt()</code> æ—¶<ul>
<li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» <code>WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
<li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» <code>WAITING</code> â€“&gt; <code>BLOCKED</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING</h5><ul>
<li><p>å½“å‰çº¿ç¨‹</p>
<p>è°ƒç”¨ <code>t.join()</code> æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt; <code>WAITING</code></p>
<ul>
<li>æ³¨æ„æ˜¯<strong>å½“å‰çº¿ç¨‹</strong>åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li>
</ul>
</li>
<li><p>t çº¿ç¨‹<strong>è¿è¡Œç»“æŸ</strong>ï¼Œæˆ–è°ƒç”¨äº†<strong>å½“å‰çº¿ç¨‹</strong>çš„ <code>interrupt()</code> æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» <code>WAITING</code> â€“&gt; <code>RUNNABLE</code></p>
</li>
</ul>
<h5 id="æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING</h5><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ <code>LockSupport.park()</code> æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt; <code>WAITING</code></li>
<li>è°ƒç”¨ <code>LockSupport.unpark(ç›®æ ‡çº¿ç¨‹)</code> æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ <code>interrupt()</code> ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» <code>WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
</ul>
<h5 id="æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING</h5><p>t çº¿ç¨‹ç”¨ <code>synchronized(obj)</code> è·å–äº†å¯¹è±¡é”å</p>
<ul>
<li>è°ƒç”¨ <code>obj.wait(long n)</code> æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt; <code>TIMED_WAITING</code></li>
<li>t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ <code>obj.notify()</code>ï¼Œ <code>obj.notifyAll()</code> ï¼Œ<code> t.interrupt()</code> æ—¶<ul>
<li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» <code>TIMED_WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
<li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» <code>TIMED_WAITING</code> â€“&gt; <code>BLOCKED</code></li>
</ul>
</li>
</ul>
<h5 id="æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h5><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ <code>t.join(long n)</code> æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt; <code>TIMED_WAITING</code><ul>
<li>æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li>
</ul>
</li>
<li>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ <code>interrupt()</code> æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» <code>TIMED_WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
</ul>
<h5 id="æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h5><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ <code>Thread.sleep(long n) </code>ï¼Œå½“å‰çº¿ç¨‹ä» <code>RUNNABLE</code> â€“&gt; <code>TIMED_WAITING</code></li>
<li>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä» <code>TIMED_WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
</ul>
<h5 id="æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h5><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ <code>LockSupport.parkNanos(long nanos)</code> æˆ– <code>LockSupport.parkUntil(long millis)</code> æ—¶ï¼Œå½“å‰çº¿ ç¨‹ä» <code>RUNNABLE </code>â€“&gt; <code>TIMED_WAITING</code></li>
<li>è°ƒç”¨ <code>LockSupport.unpark(ç›®æ ‡çº¿ç¨‹)</code> æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ <code>interrupt()</code> ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» <code>TIMED_WAITING</code> â€“&gt; <code>RUNNABLE</code></li>
</ul>
<h5 id="æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED"><a href="#æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED" class="headerlink" title="æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED"></a>æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED</h5><ul>
<li>t çº¿ç¨‹ç”¨ <code>synchronized(obj)</code> è·å–äº†å¯¹è±¡é”æ—¶å¦‚æœ<strong>ç«äº‰å¤±è´¥</strong>ï¼Œä» <code>RUNNABLE</code> â€“&gt; <code>BLOCKED</code></li>
<li>æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ <code>BLOCKED</code> çš„çº¿ç¨‹é‡æ–°ç«äº‰ï¼Œå¦‚æœå…¶ä¸­ t çº¿ç¨‹ç«äº‰ æˆåŠŸï¼Œä» <code>BLOCKED</code> â€“&gt; <code>RUNNABLE</code> ï¼Œå…¶å®ƒ<strong>å¤±è´¥</strong>çš„çº¿ç¨‹ä»ç„¶ <code>BLOCKED</code></li>
</ul>
<h5 id="æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED"><a href="#æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED" class="headerlink" title="æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED"></a>æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED</h5><p>å½“å‰çº¿<strong>ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•</strong>ï¼Œè¿›å…¥ <code>TERMINATED</code></p>
<h4 id="3-10-å¤šæŠŠé”"><a href="#3-10-å¤šæŠŠé”" class="headerlink" title="3.10 å¤šæŠŠé”"></a>3.10 å¤šæŠŠé”</h4><p>æ›´æ–°ä¸­â€¦</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Guohao
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://dave0126.github.io/2022/03/26/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-2/" title="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (äºŒ)">https://dave0126.github.io/2022/03/26/JUC-Javaå¤šçº¿ç¨‹-2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JUC/" rel="tag"># JUC</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/23/JUC-Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-1/" rel="prev" title="Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (ä¸€)">
      <i class="fa fa-chevron-left"></i> Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹ (JUC) (ä¸€)
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-%E5%B9%B6%E5%8F%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B"><span class="nav-text">Java å¹¶å‘å¤šçº¿ç¨‹ç¼–ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B-%E4%B9%8B-%E7%AE%A1%E7%A8%8B"><span class="nav-text">3 å…±äº«æ¨¡å‹ ä¹‹ ç®¡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E5%85%B1%E4%BA%AB%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">3.1 å…±äº«å¸¦æ¥çš„é—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-1-%E4%B8%B4%E7%95%8C%E5%8C%BA-Critical-Section"><span class="nav-text">3.1.1 ä¸´ç•ŒåŒº Critical Section</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-2-%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6-Race-Condition"><span class="nav-text">3.1.2 ç«æ€æ¡ä»¶ Race Condition</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-Synchronized-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">3.2 Synchronized è§£å†³æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-1-%E8%A7%A3%E5%86%B3%E6%89%8B%E6%AE%B5"><span class="nav-text">3.2.1 è§£å†³æ‰‹æ®µ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-Synchronized-%E8%AF%AD%E6%B3%95"><span class="nav-text">3.2.2 Synchronized è¯­æ³•</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-3-Synchronized-%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A"><span class="nav-text">3.2.3 Synchronized åœ¨æ–¹æ³•ä¸Š</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-%E5%8F%98%E9%87%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="nav-text">3.3 å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-1-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%92%8C%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="nav-text">3.3.1 æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="nav-text">3.3.2 å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-3-%E5%B8%B8%E8%A7%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%B1%BB"><span class="nav-text">3.3.3 å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-text">3.3.4 ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-5-%E4%B9%A0%E9%A2%98"><span class="nav-text">3.3.5 ä¹ é¢˜</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-Monitor"><span class="nav-text">3.4 Monitor</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-1-Monitor%E5%8E%9F%E7%90%86"><span class="nav-text">3.4.1 MonitoråŸç†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-2-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81"><span class="nav-text">3.4.2 è½»é‡çº§é”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-3-%E9%94%81%E8%86%A8%E8%83%80"><span class="nav-text">3.4.3 é”è†¨èƒ€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-4-%E8%87%AA%E6%97%8B%E4%BC%98%E5%8C%96"><span class="nav-text">3.4.4 è‡ªæ—‹ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%87%AA%E6%97%8B%E6%88%90%E5%8A%9F%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">è‡ªæ—‹æˆåŠŸçš„æƒ…å†µ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%87%AA%E6%97%8B%E9%87%8D%E8%AF%95%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-5-%E5%81%8F%E5%90%91%E9%94%81"><span class="nav-text">3.4.5 åå‘é”</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%81%8F%E5%90%91%E7%8A%B6%E6%80%81"><span class="nav-text">åå‘çŠ¶æ€</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E5%81%8F%E5%90%91"><span class="nav-text">æ’¤é”€åå‘</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E9%87%8D%E5%81%8F%E5%90%91"><span class="nav-text">æ‰¹é‡é‡åå‘</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%92%A4%E9%94%80"><span class="nav-text">æ‰¹é‡æ’¤é”€</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-Wait-x2F-Notify"><span class="nav-text">3.5 Wait &#x2F; Notify</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-1-API%E4%BB%8B%E7%BB%8D"><span class="nav-text">3.5.1 APIä»‹ç»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-2-wait-%E5%92%8Csleep-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">3.5.2 wait() å’Œsleep()çš„åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%BC%8F-%E4%B9%8B-%E4%BF%9D%E6%8A%A4%E6%80%A7%E6%9A%82%E5%81%9C"><span class="nav-text">3.6 åŒæ­¥æ¨¡å¼ ä¹‹ ä¿æŠ¤æ€§æš‚åœ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-6-1-join-%EF%BC%9A%E4%BD%BF%E7%94%A8%E4%BF%9D%E6%8A%A4%E6%80%A7%E6%9A%82%E5%81%9C%E6%A8%A1%E5%BC%8F"><span class="nav-text">3.6.1 join()ï¼šä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-6-2-%E6%89%A9%E5%B1%95-Future"><span class="nav-text">3.6.2 æ‰©å±• - Future</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F-%E4%B9%8B-%E7%94%9F%E4%BA%A7%E8%80%85-x2F-%E6%B6%88%E8%B4%B9%E8%80%85"><span class="nav-text">3.7 å¼‚æ­¥æ¨¡å¼ ä¹‹ ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-7-1-%E8%A6%81%E7%82%B9"><span class="nav-text">3.7.1 è¦ç‚¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-7-2-%E5%AE%9E%E7%8E%B0"><span class="nav-text">3.7.2 å®ç°</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-Park-amp-Unpark"><span class="nav-text">3.8 Park &amp; Unpark</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-text">3.8.1 åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-2-%E7%89%B9%E7%82%B9"><span class="nav-text">3.8.2 ç‰¹ç‚¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-3-%E5%8E%9F%E7%90%86"><span class="nav-text">3.8.3 åŸç†</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2"><span class="nav-text">3.9 çº¿ç¨‹çŠ¶æ€è½¬æ¢</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%B8%80%EF%BC%9ANEW-%E2%80%93-gt-RUNNABLE"><span class="nav-text">æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%BA%8C%EF%BC%9A-RUNNABLE-lt-%E2%80%93-gt-WAITING"><span class="nav-text">æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%B8%89%EF%BC%9ARUNNABLE-lt-%E2%80%93-gt-WAITING"><span class="nav-text">æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E5%9B%9B%EF%BC%9A-RUNNABLE-lt-%E2%80%93-gt-WAITING"><span class="nav-text">æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%BA%94%EF%BC%9A-RUNNABLE-lt-%E2%80%93-gt-TIMED-WAITING"><span class="nav-text">æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E5%85%AD%EF%BC%9ARUNNABLE-lt-%E2%80%93-gt-TIMED-WAITING"><span class="nav-text">æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%B8%83%EF%BC%9ARUNNABLE-lt-%E2%80%93-gt-TIMED-WAITING"><span class="nav-text">æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E5%85%AB%EF%BC%9ARUNNABLE-lt-%E2%80%93-gt-TIMED-WAITING"><span class="nav-text">æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E4%B9%9D%EF%BC%9ARUNNABLE-lt-%E2%80%93-gt-BLOCKED"><span class="nav-text">æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%83%85%E5%86%B5%E5%8D%81%EF%BC%9A-RUNNABLE-lt-%E2%80%93-gt-TERMINATED"><span class="nav-text">æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-10-%E5%A4%9A%E6%8A%8A%E9%94%81"><span class="nav-text">3.10 å¤šæŠŠé”</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guohao</p>
  <div class="site-description" itemprop="description">é—´æ­‡æ€§è¸Œèº‡æ»¡å¿—, æŒç»­æ€§åˆ’æ°´æ‘¸é±¼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guohao</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">48k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">44 åˆ†é’Ÿ</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
